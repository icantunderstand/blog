{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/transfer",
    "result": {"data":{"markdownRemark":{"html":"<h2>简介</h2>\n<p>运输层提供了运行在不同主机上的应用进程之间的逻辑通信，应用程序通过逻辑通信，运行在不同进程的主机好像直连一样(例如输出一个URI 就能找到对应主机的资源)。 运输层是直接与应用层打交道的网络层级。通过对运输层协议(TCP/UDP)的了解和传输机制的学习，能更好的帮助我们理解应用程序的行为。在阅读计算机网络自顶向下方法的运输层时整理了如下的笔记。</p>\n<h2>运输层基础</h2>\n<p>运输层通过多路复用与多路分解来实现将主机间的数据交付服务扩展成主机的进程间的交付服务。它对应用层提供了两种服务类型:</p>\n<ul>\n<li>基于连接的，可靠地服务(TCP)</li>\n<li>不基于连接的，不可靠的服务(UDP)</li>\n</ul>\n<h2>TCP</h2>\n<h3>TCP报文段结构</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 454px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/d6b45274cec3b46224cba1930bc6b66d/b3c1d/fragment.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABu0lEQVQoz22R646rIBRGff9XapM2fYEaTZpevBQUBKEgKBdltCdTck4mJ7N+7nxkf6ydVFU1jqMxZpqm8S9KqWEYmqa53+9SSmttnP/LTNNEKU0opeu6lmUJIeSc0w9a623blFKc82EYiqKglBJCMMaEEEqpEMJam3DOvfcIoThijAkh2rYFAFBKMcaU0izLuq4TQvR9zxjjnAshnHPfm733zjlrrfswjiMAoKoqAEBZlk3T1HVNCNFaG2NizHxI5AdrbQghtoAQXq9XQkhd1xDC2LmqKozxsixxk/d+nufkcrns9/s8zzHGp9Ppdrulabrb7Y7H4+FwiL2893VdAwAej0fbttZapZTWOun7PoTgnBNCZFn2fD4BAEVRCCGmadJaT9N0Pp/zPG+a5vF4RBfbti3LkjDGrLXxVIQQKeXr9YraIIRRct/3SikpZfxRNMIY+348z3PUMM9zLBlCkFKmaRqdjeMYM8MwMMaklAghKWUSpdsfGGO898aYuq4551LKZVmi5+jJex/NJV+/Mc8zQghCiBACAGit13UNP1iWJYSQvH9jXVfOedd1fd9jjJ1z7/d727b/Yn8AH0+bq1J7Cv0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"TCP\"\n        title=\"TCP\"\n        src=\"/blog/static/d6b45274cec3b46224cba1930bc6b66d/b3c1d/fragment.png\"\n        srcset=\"/blog/static/d6b45274cec3b46224cba1930bc6b66d/63868/fragment.png 250w,\n/blog/static/d6b45274cec3b46224cba1930bc6b66d/b3c1d/fragment.png 454w\"\n        sizes=\"(max-width: 454px) 100vw, 454px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>端口和目的端口用于TCP数据的多路复用和多路分解</li>\n<li>序号和确认号用于实现可靠数据传输</li>\n<li>TCP的连接状态保存在端系统中，这种链接的状态对网络层是不可见的。网络层只看到的数据报</li>\n<li>确认号可以理解成发送方期待接受方发送的下一段序列的初始字节编号。例如当A收到B发送的数据是500-600（不包括600）并且在累计确认下(前500的数据都得到确认) B在发送的报文中确认号就是600,A接收到报文后就会发送600之后的数据给B</li>\n<li>接收窗口用于实现拥塞控制(TCP慢启动)</li>\n<li>在6个标志字段中 ACK用于确认上一个已成功报文的确认 RST，SYN,FIN 用于连接的建立和拆除 PSH被设置的时候标志接受方应立即将数据交付给上层</li>\n</ul>\n<h3>流量控制</h3>\n<p>流量控制是发送方与接收方的一种速度匹配服务。在发送方与接收方都维持一个接收窗口的变量。假设该变量的值为rwnd，发送方必须保证LastByteSent - LastByteAcked &#x3C;= rwnd.假设接收方的缓存空间是RcvBuffer,必须保证 rwnd = RcvBuffer - [LastByteRcvd - LastByteRead].该窗口字段在接收端发送报文的时候会写到TCP报文的窗口字段。当接收端的窗口是0的时候，发送方接收到对应的报文将发送只有一个字节的数据报文段，此时接收端将接收这个报文并且清空自己的缓存空间(数据传送给上层)并且回复一个rwnd大于0的报文段</p>\n<h3>TCP连接的建立与中断</h3>\n<h4>TCP连接的建立</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 745px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/450ef929b273efe5395a856db3581d99/7e509/connect.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsTAAALEwEAmpwYAAACPElEQVQ4y21Ty07jMBSN+CF2iK/gQ/gdliyQumEkxKpUHakwmpRFxDNNUlJFQigPMrRJWgfHaRLH8R3BRaYwc1b29X2dc681AJBSAsBqtTo8PDw4OCCEKOMmbm9vj46OTNNUFk1KKYRo2xYAtre3d3Z2AKBtW7mBrusAIMuy3d3d8XisHDSsgM/7+/t7e3tFUaBFAVPbtr21taXrOgAIId4qA0BZloQQzvl8PnccJ89zQsi/bQshxuPx6+urIvUW7Pu+bduEEMbYYrFwHKff75v397913TTNNE2rqsLWOOcq11vbm7mbpqmqCs+r5fLx8XHqur90fTgcep6XJEkcx0j4g7MiJqWs67osSyVBJ2WZ56HjZL4/dd2zfv/6+poxZlnWdDrlnGuoR9u2Xdet12tKaVVVrCiuLi6GvV6/17MNw314iOM/nHNKKYqPxTQhBM4DJUmSZDQaDQeDn6enV4bhh2FZfxJWan0EA0CapsvlkjFGKR2NRufn51EUBVGE/HERmqbhnOd5jhaEhrtFCFmv13meB0Hw9PQ0dZwfx8eXl5e2bSdJ0jQNeuMKqCl+UZtzXtc1Tn4+nxuGMRgMTk5OdF2PojBN06Kgm/6a4oCjQrVV7rqugyC4ubmxLOvu7g5H9SnYt8rYIb5hRrUCcRy/vLxg8AfnzTUsy5JS+u1LoSsesiz7D2e8h2HoeR7OTH4FAFBKXddtmka843vbQghK6Ww2WywWz8/Pvu9PJpM4jr13WJbFGNv8sH8BdCuyVQ0e+JcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"三次握手\"\n        title=\"三次握手\"\n        src=\"/blog/static/450ef929b273efe5395a856db3581d99/7e509/connect.png\"\n        srcset=\"/blog/static/450ef929b273efe5395a856db3581d99/63868/connect.png 250w,\n/blog/static/450ef929b273efe5395a856db3581d99/0b533/connect.png 500w,\n/blog/static/450ef929b273efe5395a856db3581d99/7e509/connect.png 745w\"\n        sizes=\"(max-width: 745px) 100vw, 745px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>客户端在向服务端请求连接的时候，会向服务端发送一个SYN报文段。会随机选取一个client_isn作为序号字段放置在该SYN报文中。</li>\n<li>服务端在收到该报文后，会发送给客户端一个报文并且设置TCP的缓存和变量。该报文的ack字段是client_isn + 1,序号字段为server_isn,SYN比特为设置成1.代表当前服务器已经准备接收数据</li>\n<li>客户端在接收服务端的确认报文后会创建TCP的缓存和变量并且向服务端继续发送报文(此时的报文可以携带上上层的数据),其中ack字段是server_isn + 1,序号字段是client_isn + 1,SYN字段为0(此后的报文中SYN字段都为0).至此TCP连接建立成功。(三次握手是为了确定双方的序号)</li>\n</ol>\n<h4>TCP连接的中断</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 340px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/bfcc2547154c5a74172a41af7cbca7a1/9f933/close.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 129.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAA7EAAAOxAGVKw4bAAACnUlEQVRIx4WVS2pyQRCF7+qyCFcgCK7AUYYhOnfgyEAgDl2BRIMKOjAPiCGaGI3vtyY+ovXzNZS0915/G5qr3V2nTlWdrnZERLbbrfz+/pr59/cn+/2e5cPXHqzp+m63k9lsJtPpVJbLpVl32Oj1elKr1eTj4+PI0A/M/gL49PQkLy8v0m63zZoDO4Cen5+lXC7L29ubrFYrDxs/wE6nI4+Pj5LP58232+2Ks9lsjIdMJiORSEQuLy8PTGHgN3Qd57lcTq6uriQcDsvd3Z04xWJREomExGIxSaVSZhK+bahMbcbNZlOSyaREo1G5vr6Wm5sbSafT4tze3kogEJBgMCj39/fy8PAgk8nEF4ipTkqlkoRCIbm4uJB4PC7ZbNakzcG4UCiYSg2HQ5nP53JquEFRRaVSOVpzKMB6vTZ/+v2+DAYDc3CxWJgvB1utlkm4eyAVdzSOfWA0GhkQNigWzgCGPY5+fn7MRBmcYQ/JHQHaiQYQA/cAkCIgYvYBYb6+vkqj0TgU0AM4Ho8PtwV2ypCQv7+/TX4JU3WKA1+GmlDU/vn5aUAxVPBTgzPk3Rb7EUPyBKNzVdbzhI8y7H0PIF7d1w4VEK4NCHNyXq/XTTo0DY5NlxyqhDQVGCIZDCkOwOSOdCCZ9/d3c1W1mI6CIRM2McQIcK2qtifN59mQVRp0DMIGiAkI4NxtioX+7IYBS9+iaCtCa3ZVMYY5QBQLcDtknGPnkQ2Di03IAJxqsLqOA5XZ19eXPyC5Y9pF8Zv2oLKaQw8gOaT8hOLuzu6urf/dwj4ChBkh24CnGJ4FBIRK8jb87z1xA9qyOWpfhFqtVs0L5s4hldZO4n6sqLz2SU/IDLqvPlCnQraZclP0/fF0G76wRMDnAN2ysn//Aw2QzK7dGbfNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"TCP close\"\n        title=\"TCP close\"\n        src=\"/blog/static/bfcc2547154c5a74172a41af7cbca7a1/9f933/close.png\"\n        srcset=\"/blog/static/bfcc2547154c5a74172a41af7cbca7a1/63868/close.png 250w,\n/blog/static/bfcc2547154c5a74172a41af7cbca7a1/9f933/close.png 340w\"\n        sizes=\"(max-width: 340px) 100vw, 340px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span><br>\n(发送方和接受方都可以中断TCP连接)</p>\n<ol>\n<li>终止方向另一端发送一个TCP报文，其FIN比特位被设置成1</li>\n<li>接收方回复一个ACK报文并且发送一个FIN报文</li>\n<li>终止端回复一个ACK报文，至此两方为了维持TCP连接的缓存和变量都将清除(接受FIN端需要把自己剩余的信息发送完 才能发送FIN报文)</li>\n</ol>\n<h4>TCP客户端和服务端的状态转变</h4>\n<h5>TCP客户端客户端状态的改变</h5>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 492px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/28dcf09f263ca815ac261f70aa5afffb/5c6e9/client-status.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB4klEQVQ4y42U144CMQxF5/8/CF54gDckiui9I3rvHa+OV4YwO0hrKcokE19fXzvxxLF2uy2ZTEaWy6Wuj8ejbDYbGQ6HMhgMZLfbyfV61X/M8XhcstmspNNpCYfD0mq1xHs+n2IDu1wuslqtFIQDs9lMarWaNBoNmU6nMh6PNeBisdAAj8dDwff7vc6eC3Y4HGS9Xr/WFoBxPp91NmMNaLValXq9rmvMc1OGmZkbyDV/Ntvt9uOfd7vdpNvtqhZEIiIsXWe/LMxkMxqNJJlMynw+V71fgFCnIKVSScVHK7QxZ5cBhg/aQoKRSqVU8/v9/k4ZkHK5/Ce9oDWAFIQBEPqx99KQqoVCIcnlcnI6nT6cgxhyHlaJREJisZj0+/23hnYYPYz2N0D/PkDNZvPDR9uGDRoY/aD+DcxfZc7Sn65pUahsPp+XSqWiTQywn6n7TcHoDDSnysw0PPvKEN0AAYy+oh/dKge1DekCVCwWtTsmk8kb0OgT9VuFg1K2m0UL0XofRbHOp4IuE+6nXb2gs0gDkV6v98sQ3SKRiD4EnU5HtSAag6qjbaFQUAfWFIF/3A4YIhfgprnHK8GTRQ8CaMyIxnWyFwbNACI9cwY8Go3q04WOfx6H/7SKewaGsCaYPRI/rcIZxDx6n2wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"客户端状态变化\"\n        title=\"客户端状态变化\"\n        src=\"/blog/static/28dcf09f263ca815ac261f70aa5afffb/5c6e9/client-status.png\"\n        srcset=\"/blog/static/28dcf09f263ca815ac261f70aa5afffb/63868/client-status.png 250w,\n/blog/static/28dcf09f263ca815ac261f70aa5afffb/5c6e9/client-status.png 492w\"\n        sizes=\"(max-width: 492px) 100vw, 492px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>连接的建立 初始的时候TCP客户端处于CLOSED，当它需要与服务端建立TCP连接的时候，发送SYN字段，进入SYN_SENT状态. 当收到服务端对SYN报文的确认后，就进入ESTABLISHED状态，此刻TCP客户已经能发送和接收数据了</li>\n<li>连接的中断 客户端发送TCP报文(FIN字段被设置为1),进入FIN_WAIT_1,等待服务端的确认报文然后进入FIN_WAIT_2.等到服务端的FIN报文并且发送确认报文后，进入TIME_WAIT.最后进入CLOSED状态</li>\n</ol>\n<h5>TCP服务端状态的改变</h5>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 522px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/884026a29f246f33aa0a88780176d2d5/29492/server-status.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.80000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABxklEQVQ4y42Ux47DMAxE9f+flFOQ5JKDL+k9SO+9Vy4eASqCsIssAcGWRI9myLHc7XYTxuVykdPpJMfjUZ/MebdxOBzkfr9Lu92WdDotmUxGUqmUZLNZGQwGmk+Oq1ar0u12ZTabyfV6FeL5fHrw4XAo4/HYgz4eD1kul9JqtaRYLMp0OpUwXKPRkHK5LJVKRdbrtWe2WCxkv98r4Gg0UpDVaqV7rIfxfr/9cOEGySxavF4vncOYdwvmHGj7BqoMLdHkhCfGEa7vdjsvNwR1sEJ2s9nUuiCb4sdS7CMO3W63UqvVJEkS2Ww2OocYQxkCSqcmk4k2w1iHLO0dubCjppaPS3xT6C5dZJAcA8SSLVABMERo6Hw+FxzjWIQ2nUNOKO83hvYEEGXIxT44pd/vf7psgP9liBrA4j2HmZENdWTjtbDb8QfUF69SPxoJkfP5/Kkhk06no/rr9bomxvYJy2AeRGapVNJuw9QzNGRY2h8QA/1lH5jGJXFhovnpW5CDbcyvgFM6BaR2uVxOXW+mpXt0nxLQvUKhIL1eT+uL8dnHJvl8XnPssqAcDgD+FC4BYwcwtQWAmnI5kEdJ7EbCzBwCofDX+wGhXtIqR2SqKQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"服务端变化\"\n        title=\"服务端变化\"\n        src=\"/blog/static/884026a29f246f33aa0a88780176d2d5/29492/server-status.png\"\n        srcset=\"/blog/static/884026a29f246f33aa0a88780176d2d5/63868/server-status.png 250w,\n/blog/static/884026a29f246f33aa0a88780176d2d5/0b533/server-status.png 500w,\n/blog/static/884026a29f246f33aa0a88780176d2d5/29492/server-status.png 522w\"\n        sizes=\"(max-width: 522px) 100vw, 522px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h5>理解TIME_WAIT状态</h5>\n<ol>\n<li>可靠的实现TCP全双工连接的终止 主要close的一端 需要维持状态以防止最后一次的ACK对方收不到来进行网络重传</li>\n<li>TIME_WAIT阶段设置的超时时间会导致网络中迷失的分组丢失,这样在同样的端口创建新的TCP连接时候,不需要判断之前的数据.</li>\n</ol>\n<h3>拥塞控制</h3>\n<p>TCP使用的是端到端的拥塞控制，来防止网络拥塞时发生的各种问题(多余的分组,丢包等)。相比流量控制，拥塞控制是对网络拥塞的一种感知来控制发送的速度。流量控制是对接受方处理速度的一种速度调整。\r\n在TCP发送方维护一个拥塞窗口的变量来实现拥塞控制<br>\nLastByteSent - LastByteAcked &#x3C;= min { cwnd(接收窗口) , rwnd(拥塞窗口)}</p>\n<ul>\n<li>当发送方正确的收到确认报文的时候，他认为网络中无拥塞，不断的调整 cwnd</li>\n<li>当发送方超时未收到ack或者收到接收方三次冗余,需要降低发送速度</li>\n</ul>\n<h2>基础词汇解释</h2>\n<p>MSS 最大报文段长度<br>\n在不同的链路层协议上，其最大的传输单元(最大链路层帧长度)不同，这就导致了在封装到IP数据报的时候，需要适应底层的链路层长度。</p>\n<h2>TCP UDP 区别</h2>\n<ol>\n<li>TCP提供差错校验,重传等功能 UDP不提供对应的功能,UDP需要在应用程序中添加对应的逻辑来完成相应的功能</li>\n<li>UDP的数据报长度字段会随着数据发送给接收端,TCP是一种字节流协议,没有记录标记的长度(content-length) 主要是两者实现方式上的不同UDP是不面向连接的 也就是可以从一个套接字接受多个数据源 如果没有长度加以区分数据就会混乱.一个TCP套接字只对应着一个数据源,可以由应用层来决定数据的读取.</li>\n</ol>","frontmatter":{"date":"2018-02-21","path":"/transfer","title":"计算机基础之运输层"}}},"pageContext":{"readingTime":"10 min read"}},
    "staticQueryHashes": []}