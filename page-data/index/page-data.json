{
    "componentChunkName": "component---src-templates-index-js",
    "path": "/",
    "result": {"pageContext":{"pageAllCount":89,"group":[{"node":{"id":"6b14bd4d-1cc8-57ef-b81a-bdbe405e6d96","html":"<h2>1.0 - 2017-02-25</h2>\n<blockquote>\n<p>在这里记录下学习前端的过程。最近在博客园写自己之前的博客的时候，发现自己不是很善于描述东西，也发现博客园的书写体验没那么好，之前一直想弄一个这样的博客，这就算成型了。<br>\n希望通过这个博客来锻炼自己表达的能力同时起到督促自己目的。</p>\n</blockquote>\n<h2>2.0 - 2021-04-08</h2>\n<p>看到这个文档上次的修改记录已经是三年之前了,个人的博客在三年中有一直保持更新(虽然频率上😢不高).应该在去年建了一个公众号-前端小板凳和掘金账号.\n小板凳的初衷是我能跟大家一起坐在板凳上一起学习进步(我要是在胖下去 小板凳要变成大板凳了➳♥゛扎心),最近重新理了下思路以后小板凳和这个博客会主要以如下的内容进行更新(虽然搞不好哪天就不更了).\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/23113f1a1ccecdfec79664828aa645e9/ad1ae/road.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.39999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzUlEQVQ4y4WTW27bMBBFvfkC/elG0gL96Bby0zU0sRtbUiQ/JFKkxJfEU4iObSmNWwIEyBnO697LFW8rxpj2tNpWUdc1LoDqHFVVkRcFzrnr2/cxl/vqYjw7IsbB/nAiz3M6C6I1PK/XlGVFCOFuosv9lvDNaf3s4dStNuz3e6x1DMNACMMiwbIhWL2v0jvIipL1ek3bR6qjZrPZIISkrhuU1peARZezkWEYIQyRYTwn9D7gncMH6I1HqXYRNHU6xsg4jmnPu12dB7tVcn5ZWXeGXZahdYcNUJZ7mkYyRJCtQgix7FCbyLfHyMNj5MfPiOwhL0q2ux2diXQmIKXAOo/1E2EHXssDjdDkecHLy5bT6cQwjmcMawWfHuDz18iX75FGwzAEvPcJiq63STbWj3Q2opRCa40xPcbYhOkks/GSkAWnERfmcoBWTSwfkmTOmC2J+ICUmACegqfzpL3itSLLdigDeSkTy00jrlqdS+Uv2dwM5yrGRYx1WGsSZrXoF8D/V9hz45R1+inGWpzzyS6k4tfTE1LKNLa19orX3a83d04jZ3nJ8+Y3ou2RsuV4PNI0TQK/ESIRdjfh0hETs3Uj2G53lFX1TwI+GvkP6qVFIVq+nLwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"技术路线\"\n        title=\"技术路线\"\n        src=\"/blog/static/23113f1a1ccecdfec79664828aa645e9/00d43/road.png\"\n        srcset=\"/blog/static/23113f1a1ccecdfec79664828aa645e9/63868/road.png 250w,\n/blog/static/23113f1a1ccecdfec79664828aa645e9/0b533/road.png 500w,\n/blog/static/23113f1a1ccecdfec79664828aa645e9/00d43/road.png 1000w,\n/blog/static/23113f1a1ccecdfec79664828aa645e9/aa440/road.png 1500w,\n/blog/static/23113f1a1ccecdfec79664828aa645e9/e8950/road.png 2000w,\n/blog/static/23113f1a1ccecdfec79664828aa645e9/ad1ae/road.png 2270w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>前端基础</h3>\n<ol>\n<li><a href=\"https://html.spec.whatwg.org/#toc-browsers\">HTML Standard</a> html标准</li>\n<li><a href=\"https://tc39.es/ecma262/\">javascript标准</a></li>\n<li>网络基础知识</li>\n</ol>\n<h3>前端框架</h3>\n<ol>\n<li>react</li>\n<li>前端状态管理(redux, hook, Mobx)</li>\n<li>next.js</li>\n<li>webpack</li>\n</ol>\n<h3>横向技术</h3>\n<ol>\n<li>跨端(端)技术</li>\n</ol>\n<ul>\n<li>跨端技术 flutter taro</li>\n<li>端技术 Android/ IOS</li>\n</ul>\n<ol start=\"2\">\n<li>服务端技术</li>\n</ol>\n<ul>\n<li>node.js egg.js(如何构建一个高可用的服务端系统)</li>\n<li>go</li>\n</ul>\n<h3>解决方案</h3>\n<ol>\n<li>微前端方案</li>\n<li>离线化(预加载)</li>\n<li>拆包</li>\n<li>骨架</li>\n<li>服务端渲染</li>\n</ol>\n<h3>工程化</h3>\n<ol>\n<li>服务部署运维(docker Kubernetes)</li>\n</ol>\n<h3>思考(做事方式)</h3>\n<p>这里会记录一些思考,会随着自己的认知定期修改这部分内容.一些内容会沉淀成记录\n要从把事做完到做好到做广.</p>\n<ol>\n<li>数据 => 业务</li>\n<li>做好监控(用户行为 异常监控)</li>\n<li>如何能做到业务技术两手抓</li>\n<li>探索推进业务的方式(往前看 多聊, 视角的切换(长期短期 用户视角))</li>\n<li>先想好在做 别急 这点不容易</li>\n</ol>\n<p>希望2.0版本能把我们的知识串成一个网,一起把事做好.希望事情会因你不同.</p>\n<h2>3.0-2022-04-12</h2>\n<p>距离上次更新这个文档差不多刚好一年的时间，博客的内容也大致按照之前2.0版本的内容在更新(万幸没有断更)。3.0版本的内容会在2.0的基础上更加<strong>系统化</strong>。这里对3.0版本的内容做下diff:</p>\n<ul>\n<li>形式上会结合做过的事或者看过的内容，结合自己的想法总结和输出(虽然有些想法比较基础和简单)，也是想在自己这边能把一些东西揉碎想明白的一种尝试，现在主要有以下两种方式:\n<ol>\n<li><a href=\"https://icantunderstand.github.io/blog/%E5%89%8D%E7%AB%AF%E5%BF%AB%E6%8A%A5/\"><strong>前端快报</strong></a>收录近期阅读的前端技术类文章，月维度更新</li>\n<li><a href=\"https://icantunderstand.github.io/blog/%E8%AF%BB%E4%B9%A6%E7%9B%AE%E5%BD%95/\"><strong>读书目录</strong></a>收录自己读过的书和阅读过程中的一些想法，采取了打分推荐的方式(有个人喜好)，根据读书进度实时更新。</li>\n</ol>\n</li>\n</ul>","fields":{"readingTime":{"text":"4 min read"}},"frontmatter":{"title":"初心","date":"2019-07-10","tags":"思考","path":"/my-heart","top":true,"summary":null}}},{"node":{"id":"efb8a435-cea5-59e6-bc37-3b2058087a28","html":"<ul>\n<li>要有刨根问底的精神</li>\n<li>多思考这件事为什么是这样</li>\n<li>提取事物相同的模式 从更上层或者多角度去看相似的问题</li>\n<li>有深度的刻意练习才能产生提高</li>\n<li>做技术 可以从技术角度去产生技术方案也可以从用户产品视角去思考技术 不要把这两个孤立开来</li>\n</ul>\n<h2>跨端的本质</h2>\n<p>一句话概括: 如何技术手段以较低成本和较高的稳定性实现端业务的快速发展\n在讨论具体的跨端方案时，先看几个在选择跨端方案的场景</p>\n<table>\n<thead>\n<tr>\n<th>目标</th>\n<th>考量点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>动态化</td>\n<td>1. 包体积问题是一个app发展到一定阶段必定要考量的问题，也是一些大厂在内部推动跨端方案的一个核心诉求 2. 业务动态化诉求(快速迭代/动态更新)</td>\n</tr>\n<tr>\n<td>人效</td>\n<td>跨端方案可以实现一次开发多端使用，提升人效 1. 原生能力需要端接入或者端技术能力，长期需要多端技术能力 2. 多端展现存在差异，需要开发中磨平 3. 通常说跨端都从h5(动态化技术)的视角切入，h5和native不是非此即彼的关系，事是大家的</td>\n</tr>\n<tr>\n<td>性能</td>\n<td>技术方案存在性能瓶颈，通过其他技术方案可以解决性能问题，优化业务体验</td>\n</tr>\n<tr>\n<td>技术基建能力</td>\n<td>1. 技术储备 2. 业务在不同技术方案下探索(小程序)</td>\n</tr>\n</tbody>\n</table>\n<h2>react理念(特点)</h2>\n<ul>\n<li>\n<p>数据驱动视图，MVVM框架</p>\n</li>\n<li>\n<p>虚拟Dom，可以实现多平台renderer和渲染优化</p>\n</li>\n<li>\n<p>组件化思维，更好的抽象/组合/代码复用</p>\n</li>\n<li>\n<p>函数式编程</p>\n</li>\n</ul>","fields":{"readingTime":{"text":"3 min read"}},"frontmatter":{"title":"想法片段总结","date":"2020-12-21","tags":"思考","path":"/idea","top":true,"summary":null}}},{"node":{"id":"45baa9fe-a31b-5ed0-a3b1-e94d5fe8548d","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/9b9b17f33335a1c09d1474fc11606434/8f8c6/custom.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3wQH/8QAFhAAAwAAAAAAAAAAAAAAAAAAABAh/9oACAEBAAEFAlT/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAYEAACAwAAAAAAAAAAAAAAAAAAARAhcf/aAAgBAQABPyG4wj//2gAMAwEAAgADAAAAEHPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGRAAAwEBAQAAAAAAAAAAAAAAABEhAUFx/9oACAEBAAE/EMiplXDdaI9P/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"web资源加载\"\n        title=\"web资源加载\"\n        src=\"/blog/static/9b9b17f33335a1c09d1474fc11606434/a2510/custom.jpg\"\n        srcset=\"/blog/static/9b9b17f33335a1c09d1474fc11606434/0479a/custom.jpg 250w,\n/blog/static/9b9b17f33335a1c09d1474fc11606434/41099/custom.jpg 500w,\n/blog/static/9b9b17f33335a1c09d1474fc11606434/a2510/custom.jpg 1000w,\n/blog/static/9b9b17f33335a1c09d1474fc11606434/c58a3/custom.jpg 1500w,\n/blog/static/9b9b17f33335a1c09d1474fc11606434/8f8c6/custom.jpg 1946w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n在加载web资源的时候，资源(数据/js/css/图片等)会主要经历三个阶段:</p>\n<ul>\n<li>服务端组装阶段</li>\n<li>传输阶段</li>\n<li>客户端处理阶段</li>\n</ul>\n<p>在讨论资源加载优化的时候其实在讨论如何能快速的把用户需要的资源尽快的给到用户，这个过程就很像货车运输货物的过程。下面我们就以卡车司机的视角去看货物如何能更好的运输。</p>\n<p>--- 以下是故事视角叙述 ---</p>\n<p>作为一个资深老司机，我驾驶着我的货车已经在这个熟悉的路线上跑了20多年了，虽然货物运输的活一直有，但是运输方对我拉货的要求确越来越多。车多货少，以前是货找车，现在是车找货。在年前去时常合作的老板家拜访(送礼不是)的时候，老板语重心长的跟我说: 跟你合作了这么久，还是你最靠谱，不过我听老王说他家拉货的好像降价了而且还换了大车。咱们合作这么久我是信得过你的，年后咱们在聚聚，聊聊今年咱们怎么干。我拿起来酒倒满了一杯敬了老板，老板笑了笑喝了一口，说: 最近开始养生了。我苦笑。\n开车回家的路上，我就在思考今年的活我应该怎么干。我以往的干活方式可以简化成下面所示:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/a184fd97b7fb059365e8cbd74d7e7b1c/57a9c/transfer.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAG+AD//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAEFAn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAYEAACAwAAAAAAAAAAAAAAAAARIQABEP/aAAgBAQABPyF5RDn/2gAMAwEAAgADAAAAEHAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGBAAAwEBAAAAAAAAAAAAAAAAAAERUSH/2gAIAQEAAT8QSjr7sI9JaH//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"送货流程\"\n        title=\"送货流程\"\n        src=\"/blog/static/a184fd97b7fb059365e8cbd74d7e7b1c/a2510/transfer.jpg\"\n        srcset=\"/blog/static/a184fd97b7fb059365e8cbd74d7e7b1c/0479a/transfer.jpg 250w,\n/blog/static/a184fd97b7fb059365e8cbd74d7e7b1c/41099/transfer.jpg 500w,\n/blog/static/a184fd97b7fb059365e8cbd74d7e7b1c/a2510/transfer.jpg 1000w,\n/blog/static/a184fd97b7fb059365e8cbd74d7e7b1c/c58a3/transfer.jpg 1500w,\n/blog/static/a184fd97b7fb059365e8cbd74d7e7b1c/3acf0/transfer.jpg 2000w,\n/blog/static/a184fd97b7fb059365e8cbd74d7e7b1c/57a9c/transfer.jpg 2094w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>在配货站等待不同的货物装上车 这个阶段我偶尔也会参与搬货，因为我想快点能出发</li>\n<li>跑长途 是个比较无聊的过程</li>\n<li>卸货站卸货</li>\n</ul>\n<p>想起我在开货车之前干过两年前端工程师，所以我把我想到的今年拉货的方式跟大家求求建议，我会用一些之前还记着的一些词汇来描述我的一些想法，等大家给我出主意，希望过完年我跟老板的聚餐能让老板喝一杯。</p>\n<h2>资源(货物)运输方式</h2>\n<p>说到货物的运输方式，我首先想到的是换掉我的老伙计-陪伴我20多年的老卡车，换一个你们熟悉的说法应该切换下传输协议。比如</p>\n<ul>\n<li>http2 有了多路复用 报头压缩 二进制帧的结构 传输数据上更加高效</li>\n<li>websocket 对二级制支持更好在双向链路上能更好的传输数据</li>\n<li>服务段预渲染技术<a href=\"https://www.patterns.dev/posts/server-side-rendering\">SSR</a>(server-side rendering)/<a href=\"https://www.patterns.dev/posts/static-rendering\">SSG</a>(static site generation)/<a href=\"https://www.patterns.dev/posts/incremental-static-rendering\">ISR</a>（Incremental Static Generation)</li>\n<li>api网关聚合服务 利用内网优势去拼接请求返回给用户</li>\n<li>资源可选下发 对不同浏览器环境下发不同的资源，减少不必要的传输资源</li>\n<li>资源优先级区分 动态加载/图片懒加载/非首屏资源懒(异步)加载等</li>\n</ul>\n<p>上面说的感觉好拗口，还是换成我拉货的话来说，这样跟我一起拉货的车友也能听懂我的意思</p>\n<ul>\n<li>我想在买一辆车，这样能两辆车跑拉货如果每趟我都能赚钱，那么老板也满意，我的钱包也越来越鼓，我需要考虑好这个成本问题</li>\n<li>我是不是可以在开发出一条新的路线，说不定这条路线上回来的时候也能配到货，那么我至少不会空跑，肯定是多赚的</li>\n<li>以前一些货物需要到卸货站进行打包，可以跟老板商量在发车的时候就提前打包好，方便我装货和卸货，也能提高我拉货的效率</li>\n<li>有时候会存在运输方对目的地要货需求的理解不一致的情况，结果拉过去好多货都堆积了，老板钱赚少了，也不愿意给我货款。我可以多跟朋友打听好哪些是紧俏货，把这个信息给老板让老板给我配货</li>\n<li>想要做到区分优先级我就要做到更加详细的要货需求，车里面只拉需要的货，到了那边都卖出来，老板高兴，我也高兴(钱包鼓了当然高兴)</li>\n</ul>\n<h2>资源缓存(货物存储)</h2>\n<p>说到资源缓存，其实在上面的预渲染技术中就可以用到。可以有如下的思路</p>\n<ul>\n<li>服务段资源缓存 服务端动态生成的资源缓存/计算数据缓存</li>\n<li>资源缓存设置 区分不同资源做不同的缓存时间设置</li>\n<li>CDN 多点部署资源/CDN资源预热</li>\n<li>客户端缓存\n<ul>\n<li>通过缓存协商来实现</li>\n<li>客户端动态做数据资源拉取,比如WebView的复用/Webview预加载/<a href=\"https://icantunderstand.github.io/blog/cross-platform-offline\">离线包</a>/<a href=\"https://icantunderstand.github.io/blog/cross-platform-prefetch\">数据预取</a></li>\n<li>api数据资源缓存 非频繁变动且拉取频次高的资源可以做页面周期内的更细粒度的缓存实现</li>\n</ul>\n</li>\n</ul>\n<p>换成我拉货的视角就是:</p>\n<ul>\n<li>提前备货 我车到装货站就装货走人，不用等一天等待货品的进货组装</li>\n<li>紧俏的货就多备一些，多拉一些。要货就有</li>\n<li>跟老板商量在目的地附近在建几个存货处，我先往存货处拉，这样要货的时候也快</li>\n<li>卸货站要是没货的时候，那边有车的话，就跑来这边拉一下货或者进行一些存货，到时候卖库存就行</li>\n</ul>\n<h2>资源体积(货物体积)</h2>\n<p>说到资源体积，思考的是在一次的资源展示中怎么能尽可能少尽可能快的展示给用户信息。这个少和快是一个综合取舍的过程。有的时候我们会放弃文件的大小的考量，只为了达到更好的效果。因为给用户一个频繁抖动的页面不如让用户稍微等待那200 300ms.这里其实也有一些可以想到的点:</p>\n<ul>\n<li>资源加载方式的改变 图片相关资源的内联/webp的使用/react的server component</li>\n<li>兼容性 不在兼容低老版本，减少兼容代码</li>\n<li>tree shaking 防止无用代码的打包</li>\n<li>split chunk 公用代码的提取</li>\n</ul>\n<p>换成我拉货的视角就是:</p>\n<ul>\n<li>一次能多拉货就多拉一些/更换更好的卸货或者装货方式</li>\n<li>人家不要的货咱不拉</li>\n<li>都要的货，咱标记出来，保证都要的货在卸货的时候够用</li>\n</ul>\n<p>--- 结束号---\n之前在<a href=\"https://icantunderstand.github.io/blog/h5-performance\">web性能优化总结</a>中对一些性能优化相关的点做了一次总结，当前文章是在之前的基础上新增了一些最近的思考，在想这个事情的时候刚好想到拉货这件事，所以就通过这种方式做了一次尝试，跟之前<a href=\"https://icantunderstand.github.io/blog/react-render-interpretation\">图说React渲染流程</a>的风格有些像，算是一种尝试，希望通过风趣的方式能把事情讲明白，在尝试风趣化的过程中也加深了自己的理解和思考，不失为一种尝试。</p>","fields":{"readingTime":{"text":"10 min read"}},"frontmatter":{"title":"趣说web资源加载","date":"2024-02-29","tags":"工程化","path":"/load-resource","top":null,"summary":null}}},{"node":{"id":"833ae7d8-40bb-5f61-a2f6-8fd380669c5e","html":"<p>之前看过一篇文章讲代码封装的过程，下面从简述文章的内容开始梳理下自己对代码封装的一点思考.</p>\n<p>--- 以下是之前文章内容简述 ---</p>\n<p>在业务迭代的初期，代码中有一段业务逻辑A,由于A逻辑在项目中使用比较广泛，于是对A逻辑进行了代码逻辑的封装，包括参数的预设等<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 622px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/38aa583bb84ab61a13973cfefd93f77b/5e4ef/initSeal.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAd8BAsAD/8QAFBABAAAAAAAAAAAAAAAAAAAAMP/aAAgBAQABBQIf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFBABAAAAAAAAAAAAAAAAAAAAMP/aAAgBAQAGPwIf/8QAGxAAAgEFAAAAAAAAAAAAAAAAAAERECAxQYH/2gAIAQEAAT8h3mnSEQiFZ//aAAwDAQACAAMAAAAQQMAA/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHBABAAICAwEAAAAAAAAAAAAAAQARITEgQWHB/9oACAEBAAE/ELPhHW6gldvZmuosZCBFBw//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"初始化封装\"\n        title=\"初始化封装\"\n        src=\"/blog/static/38aa583bb84ab61a13973cfefd93f77b/5e4ef/initSeal.jpg\"\n        srcset=\"/blog/static/38aa583bb84ab61a13973cfefd93f77b/0479a/initSeal.jpg 250w,\n/blog/static/38aa583bb84ab61a13973cfefd93f77b/41099/initSeal.jpg 500w,\n/blog/static/38aa583bb84ab61a13973cfefd93f77b/5e4ef/initSeal.jpg 622w\"\n        sizes=\"(max-width: 622px) 100vw, 622px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span><br>\n随着业务的发展，又出现了B模块，B模块中几乎可以直接使用A逻辑，但是需要对A逻辑进行一些小小的改动，比如入参的调整、逻辑分支的增加<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 622px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/9661321a8ff56f28c58646f077725bf3/5e4ef/moreSeal.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 115.19999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAXABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe+kUkUDAf/EABgQAAIDAAAAAAAAAAAAAAAAAAAQESAh/9oACAEBAAEFAntYP//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABQQAQAAAAAAAAAAAAAAAAAAADD/2gAIAQEABj8CH//EABwQAAICAgMAAAAAAAAAAAAAAAAxAREQIUFxgf/aAAgBAQABPyHl49GWieiEiiokof/aAAwDAQACAAMAAAAQUAA8/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHBABAAICAwEAAAAAAAAAAAAAAQARMVEhQWHB/9oACAEBAAE/ELPhHGagldvYPDTVvuBRsPO4dB5cpHMIAUE//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"再次封装\"\n        title=\"再次封装\"\n        src=\"/blog/static/9661321a8ff56f28c58646f077725bf3/5e4ef/moreSeal.jpg\"\n        srcset=\"/blog/static/9661321a8ff56f28c58646f077725bf3/0479a/moreSeal.jpg 250w,\n/blog/static/9661321a8ff56f28c58646f077725bf3/41099/moreSeal.jpg 500w,\n/blog/static/9661321a8ff56f28c58646f077725bf3/5e4ef/moreSeal.jpg 622w\"\n        sizes=\"(max-width: 622px) 100vw, 622px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span><br>\n这种通过修改较小范围代码就能实现功能的方式在实际开发中是很常规的操作，它并没有不好，只是当这种修改变的次数多的时候，最开始封装的逻辑A就变成了‘四不像’，它似乎可以服务于A模块，但是确有些冗余，出现了‘我好像看不懂这段代码’，‘这段代码还是别改了’，‘你改吧 我是改不了’的场景。在多次封装之后，逻辑A容易出现以下的问题</p>\n<ul>\n<li>入参不可控</li>\n<li>逻辑分支复杂，不清晰，修改范围不确定，容易对其他模块产生影响</li>\n<li>复用度逐渐下降，解决方法\n<ol>\n<li>将就不再继续新增逻辑，变成'老大难'问题，总有爆发的一天</li>\n<li>重写相关逻辑，功能回测范围大，影响范围不可控，容易出现漏测等</li>\n</ol>\n</li>\n</ul>\n<p>--- 以下是正文 ---</p>\n<p>提前封装或者过度封装对实际业务的编写都有很大影响，最实际的感受就是这段代码不好写，这个逻辑看不懂。封装的代码逻辑是结果，封装的出发点是因，从出发点去看而不是面向结果的封装似乎更能编写出可维护性的代码。以下是自己对封装的一点思考。</p>\n<h2>降低复杂度</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/3337b53e30bfbce66b906898a0921e4f/0470c/difficulty.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 97.60000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3wAWBQf/xAAUEAEAAAAAAAAAAAAAAAAAAAAw/9oACAEBAAEFAh//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAUEAEAAAAAAAAAAAAAAAAAAAAw/9oACAEBAAY/Ah//xAAXEAADAQAAAAAAAAAAAAAAAAAAAREg/9oACAEBAAE/IU6ilEoTP//aAAwDAQACAAMAAAAQAMcA/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAGRABAQEBAQEAAAAAAAAAAAAAAREAUSAh/9oACAEBAAE/EPsZAzA6ZhFuQtmhzx//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"复杂度\"\n        title=\"复杂度\"\n        src=\"/blog/static/3337b53e30bfbce66b906898a0921e4f/a2510/difficulty.jpg\"\n        srcset=\"/blog/static/3337b53e30bfbce66b906898a0921e4f/0479a/difficulty.jpg 250w,\n/blog/static/3337b53e30bfbce66b906898a0921e4f/41099/difficulty.jpg 500w,\n/blog/static/3337b53e30bfbce66b906898a0921e4f/a2510/difficulty.jpg 1000w,\n/blog/static/3337b53e30bfbce66b906898a0921e4f/0470c/difficulty.jpg 1140w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span><br>\n通过对业务中分散的相似逻辑提取，就能一定程度上降低项目的复杂度和重复度的问题。在修改相应的业务逻辑时候就相对集中和可控。新增逻辑的修改也能做到应用范围的同步。</p>\n<h2>解耦逻辑</h2>\n<p>在设计模式中需要设计的模块尽量遵循单一职责，但是在实际编写代码的过程中很容易出现模块功能的耦合，比如常见的:</p>\n<ul>\n<li>视图层逻辑与数据层逻辑耦合</li>\n<li>非相关逻辑的入侵 比如视图的逻辑需要感知请求状态的改变做相应的逻辑处理</li>\n</ul>\n<p>通过将相关的逻辑都聚合到模块封装的内部，就能较低其他模块对不相关逻辑的感知，也就做到了解耦。在下面的例子中，通过将A逻辑的关联逻辑都封装进A模块中，降低了功能模块对封装逻辑的感知。\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/fcc5771e10b64ca837688f37c6238fe5/a66e6/innerSeal.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.60000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3qEUf//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEAAQUCX//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABcQAAMBAAAAAAAAAAAAAAAAAAAQEQH/2gAIAQEAAT8hquEf/9oADAMBAAIAAwAAABCTz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAQACAwEBAAAAAAAAAAAAAAEAESExUUFx/9oACAEBAAE/ENwLb9i0d+QzZiFF2RBMlyjhP//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"内部封装\"\n        title=\"内部封装\"\n        src=\"/blog/static/fcc5771e10b64ca837688f37c6238fe5/a2510/innerSeal.jpg\"\n        srcset=\"/blog/static/fcc5771e10b64ca837688f37c6238fe5/0479a/innerSeal.jpg 250w,\n/blog/static/fcc5771e10b64ca837688f37c6238fe5/41099/innerSeal.jpg 500w,\n/blog/static/fcc5771e10b64ca837688f37c6238fe5/a2510/innerSeal.jpg 1000w,\n/blog/static/fcc5771e10b64ca837688f37c6238fe5/a66e6/innerSeal.jpg 1356w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span><br>\n相关例子:</p>\n<ul>\n<li>在<a href=\"https://ahooks.js.org/hooks/use-request/index\">ahooks</a>中的useRequest中，就通过对请求状态和数据的操作进行封装，将数据相关操作做到了内聚，减轻了视图层的负担</li>\n<li><a href=\"https://procomponents.ant.design/components/table#protable\">Antd pro components</a>的table</li>\n</ul>\n<h2>分层</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/94914fee415032516c72bd410946a383/a6b65/levleSeal.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3qAH/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAFhABAQEAAAAAAAAAAAAAAAAAEQAg/9oACAEBAAE/IWc//9oADAMBAAIAAwAAABCwz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABkQAQEBAAMAAAAAAAAAAAAAAAERACBBYf/aAAgBAQABPxApk6yhmHx4f//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"分层封装\"\n        title=\"分层封装\"\n        src=\"/blog/static/94914fee415032516c72bd410946a383/a2510/levleSeal.jpg\"\n        srcset=\"/blog/static/94914fee415032516c72bd410946a383/0479a/levleSeal.jpg 250w,\n/blog/static/94914fee415032516c72bd410946a383/41099/levleSeal.jpg 500w,\n/blog/static/94914fee415032516c72bd410946a383/a2510/levleSeal.jpg 1000w,\n/blog/static/94914fee415032516c72bd410946a383/c58a3/levleSeal.jpg 1500w,\n/blog/static/94914fee415032516c72bd410946a383/a6b65/levleSeal.jpg 1603w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span><br>\n在例子中，通过将逻辑A中的相关逻辑提取到上层，分层的方式实现了模块功能的内聚与解耦。在前端的MVC中就通过将相关操作封装成Controller,来完成逻辑的解耦</p>\n<h2>复用(一致性，可控性)</h2>\n<p>从降低复杂度、逻辑结构、分层设计最终的目标是达到封装代码的复用。通过复用能控制代码的一致性，实现修改代码行为的可控。</p>\n<ul>\n<li>在封装的实现上 可以逐渐的从项目内共享 -> 跨项目共享等</li>\n<li>在分发共享逻辑上，有<a href=\"https://zh.wikipedia.org/wiki/Monorepo\">monorepo</a>、<a href=\"https://webpack.js.org/concepts/module-federation/\">模块联邦</a>、<a href=\"https://www.npmjs.com/\">npm包</a>、<a href=\"https://www.amazonaws.cn/knowledge/what-is-micro-frontends/\">微前端</a>等方式.</li>\n</ul>\n<p>-- 写在最后 --</p>\n<p>代码的优化或者设计是应该在理解业务的基础上，从相对大的视角出发来看的。在实际做的时候容易出现缺少全局视角的设计缺失和不完善，也容易出现过度设计，需要仔细去把握这个度量。</p>","fields":{"readingTime":{"text":"6 min read"}},"frontmatter":{"title":"对代码封装的一点思考","date":"2024-02-19","tags":"工程化","path":"/seal-code","top":null,"summary":null}}},{"node":{"id":"33a16de5-5c3b-5ecb-9e17-c8782a7f6d22","html":"<p>本文通过图解的方式尝试生动的叙述React渲染组件的过程.</p>\n<h2>前置知识</h2>\n<h3>react渲染模式</h3>\n<ol>\n<li>Concurrent 模式  异步渲染模式,实现了基于任务的时间切片等特性</li>\n<li>legacy 模式 同步渲染模式,现在主要的渲染模式</li>\n</ol>\n<h3>react渲染阶段</h3>\n<ol>\n<li>render阶段  基于已有的Fiber树(current)构建workInprogress树 在workInprogress记录了需要进行更新的操作(effectList)</li>\n<li>commit阶段  commit分为以下三个阶段:</li>\n</ol>\n<ul>\n<li>before mutation  此时dom节点还没有渲染到页面中,执行getSnapshotBeforeUpdate周期函数和useEffect钩子函数</li>\n<li>mutation  渲染DOM 根据effectList的tag标注进行dom元素的更新,删除,替换等</li>\n<li>layout 执行useLayoutEffect等相关逻辑  进行current和workInprogress的替换</li>\n</ul>\n<h2>图解渲染</h2>\n<p>我们先假设我们的身份是React的好友,React是前端世界里面的一个一流的画师,我们希望他给我们画这样一幅画.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 370px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/bec0882c7e73e61b2e37a87e8db17ca0/1efb2/draft.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABX0lEQVQoz4WS7Y7aMBBFeQsg+DOJnQQiCA3kQ93AgirBj+5WVd//WU6F0dK0u21/XNme0YzH53qSZTlKLCi6M/70g3xdo5TCGIPR+iGpFErKkPuXJmmaIqTEKIHf9khfstp37J+OdGXGabehWhUorT9sIKX8TRPnXNgYa4mTBL874KqWxBqiKEKKBfPbKmU4R9EixOTiHns3ofc+JKyNiWOLL1b43YBdVrRtwzAMQUVR0DQtz88D2aYm3z+xWpehVmv90KihJY7jMJnbNOw/H3l5+cr1eqXvey6XC6+v3+iPJ9yyJC23uNwHrnqEY5Ikyf3JxmCNwXmP2/a0XUdd1zRNEy46n88MhwMmX6OVRERzhBDvOAZT3hjemhfVjuTTgE098/nswW86nTKbze785IjbHxx/uawVebHEbHrSLA+FY2ffGI3d/fDb3FxWUlBWNe74nbz/QhLbvxb87x/+BPj+AExOixcKAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"画的模板\"\n        title=\"画的模板\"\n        src=\"/blog/static/bec0882c7e73e61b2e37a87e8db17ca0/1efb2/draft.png\"\n        srcset=\"/blog/static/bec0882c7e73e61b2e37a87e8db17ca0/63868/draft.png 250w,\n/blog/static/bec0882c7e73e61b2e37a87e8db17ca0/1efb2/draft.png 370w\"\n        sizes=\"(max-width: 370px) 100vw, 370px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span><br>\nReact大师稍加思索(babel)就把画的模板构想出下面的两张蓝图:<br>\n元素的语言表达\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 703px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/15014ea5ae1e57d91a06216d3982962b/242e2/structDraft.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJklEQVQoz5WS4W6CMBRGfY3RFiilBaRUpsLEOZ3b+z/TWVozf22J/vhymzQ5Od/NXemyRDuLnWc2m55lPzCOPet1i1I5eZ6jlErzkax0VVHmOcPhTD8dca4lE5KXLEugX9ij0JUxhmhZWUd3uRCOC4dpYJ4Du12gqqrnDMuyJCZXEtO09PM7wXtqUyGkRMYIgZQigeNbSYmQKv1n8S3Evc2qrutkURQFxjma7yvj6cjneeL69cb5PBHmBT8f2dgKv93jlwtbv+Y09ny8euYx4FxzA1pr0VonS2tritZhnMH7lhA6hqGj9QN111PrEtcP1G3H2ho6axi7hjEMSShVbprmZmcMzjlyKVGxjpD3PFU5QmLlaBr39ejy/z8brRMwzmdP5C/gD6QJ/B4bz1bsAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"语言表达\"\n        title=\"语言表达\"\n        src=\"/blog/static/15014ea5ae1e57d91a06216d3982962b/242e2/structDraft.png\"\n        srcset=\"/blog/static/15014ea5ae1e57d91a06216d3982962b/63868/structDraft.png 250w,\n/blog/static/15014ea5ae1e57d91a06216d3982962b/0b533/structDraft.png 500w,\n/blog/static/15014ea5ae1e57d91a06216d3982962b/242e2/structDraft.png 703w\"\n        sizes=\"(max-width: 703px) 100vw, 703px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n元素结构\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 868px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/9f629706c2e341539b8d92bc7a0db691/748b0/draw.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 102%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlklEQVQ4y5WU6Y7CMAyE+/4vyB8kJG5oOXogrrZBn3cn65Z2d4lkJXGd8dhjSJqmCXVdB/am/jmz+3P/u/f72ESXvvnA5/P55otxdQ+ww+D7zMrzPKxWq3A4HMx2u51Z27ZvDD3zN4aw4dHxeAy32818l8vFkuz3+zBWkdiOMgQQIBKw8w2Gihvt4RhgkRdhs9kYyHa7NXZjJf9bFFZVVaEoCjsDJoE+Ktlnhd18PjefV/vjklFZ5aJ2lmWxh/35/LVkqXw6ncL9fjfwx+MxqvLgHOLsMxQg4NfrNQIOqewt8RnEUGIAkKapGcOdpVkU588eemOgy7I0W6/XYblcxjuJNJ9DkxEBySpms9nMRuV8PtuAw44WYPhgvFgsOmxjyUKuysqUJHA6ndpDAPSIBXNiaMVkMomt8OUnEoGPNB8nquqnRmnqKwkYJ7HCzzv2DkMByqk/AwUrBtZSXKMEQxGIgPp3wdR8egjDqHz7Newkoc/EcKd8L1DiZwoQgrTTM5L58fAxMCam00N/6a+hAZZAWkoowBehpBywowW5SAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"元素结构\"\n        title=\"元素结构\"\n        src=\"/blog/static/9f629706c2e341539b8d92bc7a0db691/748b0/draw.png\"\n        srcset=\"/blog/static/9f629706c2e341539b8d92bc7a0db691/63868/draw.png 250w,\n/blog/static/9f629706c2e341539b8d92bc7a0db691/0b533/draw.png 500w,\n/blog/static/9f629706c2e341539b8d92bc7a0db691/748b0/draw.png 868w\"\n        sizes=\"(max-width: 868px) 100vw, 868px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\nReact真的是一个画术大师,他有两个最出色的技能:</p>\n<ol>\n<li>在脑海里面构想画图(workInprogress)然后一次画到画板上,画出的画大家都称赞道奇(首次渲染)</li>\n<li>在已有的画上修改(current => workInprogress) 画出的画既有原来画的痕迹又有新的神韵(触发更新)</li>\n</ol>\n<p>React欣然接受了这次的绘画任务,因为他很喜欢每次作画后大家对他的称赞,于是他开始作画了.</p>\n<h3>构思(<a href=\"https://github.com/facebook/react/blob/148f8e497c7d37a3c7ab99f01dec2692427272b1/packages/react-reconciler/src/ReactFiberWorkLoop.new.js#L991\">render阶段</a>)</h3>\n<p>React大师看了下自己空白的画布,决定先在脑海里面构造画的样子.React看到画的模板的时候第一时间是看到了各个节点之间的联系于是他对画的模板有了重新的构想.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 598px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/7d569de679597cd68a5ef34fc2a3c0cb/0c69d/fiberStruct.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAABtklEQVQ4y5WUSa+CQBCE+f8/igN3Ew8ejYILsrjhAi5Am6+TNgPoi2+SzgDTXVNdNYP3eDyEuN/v8nw+5XA4SBzHkuf5O9brtZxOJ10nz2o+hecCNk0jaZrK7XYTBt8Z5/NZdrud1HX9P0AKsix7A+73+4+Af4EOALfbrRbTIkDH41FZI8XPDN1dq6rS4vl8LqvVSnzf101g3c/9CTBJEjVlPB7L9XrVZ4AxxnLc/P4GXt9lWgRkMpnoHIahLJdLKctSTSOXPKtx5wFDc5m2GWjGKIpCgQG9XC4argRfWzaXeW7bVrVjwDoIApWD2Gw2yhpQq7UYnEMOMkBmEME3WDFolzyAjUSn5b7AOBxFkYxGI5lOp3oWYU27rFurMMQo5HC7fAOaIWjFkaEAdzmTLgMYIQeG0QkbuVeyw5C2aAV2gMLAbY1iO/iz2UxnOkAWY9kBtJ8A75xBNsAAnIcRMyC2xmzfTEvP1Y9FBs9mgp1FdOXWsGY5DFh/BYQhorOz/a4Wi4UKz3faxDTyueesIwHRATRQ9EAz+w/CmKCQAjZiHddZZ0YSujFjBlePwn64m35ad2/MCzzXa7RrdkvIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fiber结构\"\n        title=\"fiber结构\"\n        src=\"/blog/static/7d569de679597cd68a5ef34fc2a3c0cb/0c69d/fiberStruct.png\"\n        srcset=\"/blog/static/7d569de679597cd68a5ef34fc2a3c0cb/63868/fiberStruct.png 250w,\n/blog/static/7d569de679597cd68a5ef34fc2a3c0cb/0b533/fiberStruct.png 500w,\n/blog/static/7d569de679597cd68a5ef34fc2a3c0cb/0c69d/fiberStruct.png 598w\"\n        sizes=\"(max-width: 598px) 100vw, 598px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n这个是React画师特有的作画方式,还是我上次跟他一起喝醉他说漏的,哈哈我就这样把他的秘密告诉大家了,大家还是装作不知道让React来给大家讲他作画的过程把.<br>\nReact: 我在作画的时候主要思考了两件事:</p>\n<ul>\n<li>怎么把画的模板对应成更好解读的结构(<a href=\"https://github.com/facebook/react/blob/148f8e497c7d37a3c7ab99f01dec2692427272b1/packages/react-reconciler/src/ReactFiber.new.js#L110\">Fiber结构</a> <a href=\"https://github.com/facebook/react/blob/148f8e497c7d37a3c7ab99f01dec2692427272b1/packages/react-reconciler/src/ReactFiberWorkLoop.new.js#L1543\">performUnitOfWork</a> <a href=\"https://github.com/facebook/react/blob/148f8e497c7d37a3c7ab99f01dec2692427272b1/packages/react-reconciler/src/ReactFiberCompleteWork.new.js#L782\">completeWork</a>)</li>\n<li>如何在构思的过程中把绘画的思路记录下来在画的过程一蹴而就(effectList 创建节点)</li>\n</ul>\n<p>经过一番构思,React想好了绘画的思路\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 885px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/6e618ddaea0eda1a9a47096488fb6ba9/efc66/renderPhase.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 103.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/0lEQVQ4y52U2W7CMBBF8/+fhQRIUF54YhGITewBwpaExJnqTDup24aqraWRrVmu7yx2kCSJOOdU8jyXx+Mht9tN0CP3+13SJC3tiH/2BX1ggCiKopDz+Sz7/V7CMJTdbieHw0EFW579EZD9er0qw+l0KqPxSBlyyb8YsgA8Ho+6A3S5XOR0Oqkty7JKoG+ApMOCTRRFEu7DN4ajkaYOIDYC8LXd4rQcBkgTACXN5XKpAJwBYI/jWGu4WCyUMb7EcMYOAcQuCtI01RS3260GrddrBfFv5qLJZKJCw7BTCpoGe7/GCgiD1Wolw+FQU7X0bIwAJP3xeKwXowNos9mUoDZ6CogCllCHgQG63GmwZYAfPugh0O/3pdfrfYwVDKmJpQcIyx8jdjpu6dpl/vrUFH9sqsbAasxu5akaH1iXKRs7U5qgNxCYAWSAvp8vPzPMnQZTO9Ltdru6W4pV/srQ/xy+PjEAo1Mk8/lcBoOBglcB/o7hew0BsadJPel8VUxZw2cMC/dRQzqN8JKshpUMnwFqU1yhbGq1mtYuiROdv09Nyd3PgPYv2tNikBlezvE91gEnbfs0fAIKaOOQPTJlg+CAM/W1C2ezmTSbzdKODlCLQcAJ5MnCCCDBfAYWYIBm/7qCVqslnU7nTV465bndbkuj0VBW9Xpd8KvSlbHv8got71ieyO6scwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"render阶段\"\n        title=\"render阶段\"\n        src=\"/blog/static/6e618ddaea0eda1a9a47096488fb6ba9/efc66/renderPhase.png\"\n        srcset=\"/blog/static/6e618ddaea0eda1a9a47096488fb6ba9/63868/renderPhase.png 250w,\n/blog/static/6e618ddaea0eda1a9a47096488fb6ba9/0b533/renderPhase.png 500w,\n/blog/static/6e618ddaea0eda1a9a47096488fb6ba9/efc66/renderPhase.png 885w\"\n        sizes=\"(max-width: 885px) 100vw, 885px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>挥墨(<a href=\"https://github.com/facebook/react/blob/148f8e497c7d37a3c7ab99f01dec2692427272b1/packages/react-reconciler/src/ReactFiberWorkLoop.new.js#L1008\">commit阶段</a>)</h3>\n<p>在挥墨这个阶段对于React大师其实是小菜一碟了,因为费心的事情已经在构思阶段解决了,他主要根据之前的构思思路(effectList等)去作画就好,不过大师的作画方式还是不同于一般画师的</p>\n<ul>\n<li>在开始作画之前他要喝一杯酒,他私下跟我说这杯酒会影响之后的作画(<a href=\"https://github.com/facebook/react/blob/148f8e497c7d37a3c7ab99f01dec2692427272b1/packages/react-reconciler/src/ReactFiberWorkLoop.new.js#L1800\">before mutation</a>阶段 周期函数钩子),我心想也是喝多了肯定不能画了吧</li>\n<li>在作画中,他又老能搞出一些新花样(<a href=\"https://github.com/facebook/react/blob/148f8e497c7d37a3c7ab99f01dec2692427272b1/packages/react-reconciler/src/ReactFiberWorkLoop.new.js#L1818\">mutation</a> <a href=\"https://github.com/facebook/react/blob/148f8e497c7d37a3c7ab99f01dec2692427272b1/packages/react-reconciler/src/ReactFiberWorkLoop.new.js#L1842\">layout</a> 组件添加到视图 生命周期函数执行),正是这些每次不同的新奇花样让他成为一个出色的画师</li>\n<li>在绘画后脑海中那个构思图成为了真实的画(<a href=\"https://github.com/facebook/react/blob/148f8e497c7d37a3c7ab99f01dec2692427272b1/packages/react-reconciler/src/ReactFiberWorkLoop.new.js#L1829\">workInprogress => current</a>)</li>\n</ul>\n<h2>fiber链表结构</h2>\n<p>fiber单链表结构的一些优点:</p>\n<ul>\n<li>可中断和恢复的任务 单链表结构允许React在多个帧中中断和恢复渲染任务，通过将任务切分小的单元，这样有助于提高用户界面响应性和避免出现卡顿</li>\n<li>优先级控制 可以通过链表实现高优先级任务的优先执行</li>\n<li>轻量化和内存管理 单链表对比双链表相对轻量，降低内存的占用</li>\n</ul>\n<h2>参考</h2>\n<p><a href=\"https://juejin.cn/post/7159118990999191582\">React Fiber不就是个链表么</a></p>","fields":{"readingTime":{"text":"6 min read"}},"frontmatter":{"title":"图说React渲染流程","date":"2024-02-05","tags":"React","path":"/react-render-interpretation","top":null,"summary":null}}},{"node":{"id":"1ba2a148-c3ca-5c80-b86f-ba5af48c9143","html":"<p>埋点在产品功能迭代和排查问题等场景能提供数据基础，以下梳理项目中使用的埋点方式</p>\n<h2>手动埋点</h2>\n<p>手动埋点是显示的在代码中插入代码，这种方式在精准性和定制化能力上更优，过多的手动埋点会增加项目的维护成本和影响系统的性能等。</p>\n<h2>自动化埋点</h2>\n<p>自动化相比手动埋点方式</p>\n<ul>\n<li>减少了人工的工作、数据收集方便也更加全面。适用于快速迭代中获取产品的相关用户数据。</li>\n<li>缺少灵活性 一些高阶数据诉求的埋点仍然需要手动添加实现</li>\n</ul>\n<h3>自动化埋点的一些实现方式</h3>\n<p>自动化埋点在于通过程序的方式去减少手动埋点的代码量，实现一些基础埋点比如PV/点击/停留时间的打点等，替代一部分自动化埋点的能力来降低整体项目埋点的压力，为项目卸压。</p>\n<h4>代码注入</h4>\n<p>通过babel插件的方式，对已有的元素的Click事件进行拼接，添加埋点逻辑，这样在出现点击行为的时候就自动实现了埋点的上报。</p>\n<pre><code>    // 简单示例\n    module.exports = function ({ types: t }) {\n        return {\n            visitor: {\n            FunctionDeclaration(path) {\n                // 在这里你可以添加逻辑来判断是否需要修改这个特定的函数\n                // 这里简单地选择所有函数，并添加一个新的 console.log 语句\n\n                const originalBody = path.node.body;\n                // 插图新的语句\n                const newStatement = t.expressionStatement(\n                    t.callExpression(t.memberExpression(t.identifier('console'), t.identifier('log')), [t.stringLiteral('New logic added!')])\n                );\n\n                path.node.body = t.blockStatement([newStatement, ...originalBody]);\n            },\n            },\n        };\n    };\n</code></pre>\n<h4>监听(观察者模式)</h4>\n<p>观察者模式能实现模块间的解耦，在实现自动化埋点的时候，可以在被观察者出现数据变更的时候，做对应的通过埋点逻辑</p>\n<pre><code>    import { observable, reaction } from 'mobx'\n\n    const searchParam = observable({\n        name: '',\n        age: '',\n    })\n    reaction(\n        () => ({ ...searchParam }),\n        (newValue, oldValue) => { \n            //发送埋点逻辑\n            sendEvent('搜索参数变更', {\n                newValue, \n                oldValue,\n            })\n        }\n    )\n</code></pre>\n<h4>提取范式</h4>\n<p>在人工埋点的基础上，通过抽象去减少人工埋点的代码，比如</p>\n<ul>\n<li>页面的PV可以在路由切换的时候去自动的打点</li>\n<li>项目通用参数可以在埋点函数中统一加入通用参数</li>\n<li>类似页面加载时长埋点可以提取通用的hook实现</li>\n</ul>\n<h2>埋点上的一些注意和思考</h2>\n<p>埋点主要是为了从数据侧拿到一些数据信息辅助后面的迭代规划。埋点能实现以下的功能</p>\n<ul>\n<li>用户行为分析</li>\n<li>业务决策支持</li>\n<li>性能监控</li>\n<li>异常监控</li>\n</ul>\n<p>需要注意的是埋点也需要进行治理</p>\n<ul>\n<li>维护性 开发一个项目通篇都是埋点代码那这个项目的可读性就很差了。</li>\n<li>性能\n<ul>\n<li>缓存队列 可以通过缓存队列 一次完成多个埋点的发送</li>\n<li>设置采样率</li>\n<li>减少触发频次  比如在端内场景通过bridge埋点涉及跟客户端通信，有可能会阻塞当前的UI操作，可以等待用户空闲的时候再进行埋点，例如react native中可以通过InteractionManager的runAfterInteractions来执行埋点逻辑</li>\n</ul>\n</li>\n</ul>","fields":{"readingTime":{"text":"5 min read"}},"frontmatter":{"title":"埋点方案梳理","date":"2023-12-28","tags":"工程化","path":"/track-event","top":null,"summary":""}}}],"pathPrefix":"","first":true,"last":false,"index":1,"pageCount":15,"additionalContext":{"pageAllCount":89}}},
    "staticQueryHashes": []}