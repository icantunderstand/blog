{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/cross-platform-prefetch",
    "result": {"data":{"markdownRemark":{"html":"<p>使用<a href=\"https://icantunderstand.github.io/blog/webview-store\">缓存</a>和<a href=\"https://icantunderstand.github.io/blog/cross-platform-offline\">离线包</a>可以一定程度上提前页面展示的时间，但是页面的展示依赖具体的数据加载，Webview在加载h5的时间线可以做如下简化:<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAa0lEQVQY05WPSwrAIAxEvf9RjSL4w7hJmcAUkW66eEw+JhmDqtrJ3tvGGJZztlqr03u3UoqTUvKaiFhrzXXO6XOYDwhu1lq+FA9O5bG7TiMgfDnEQrhCDmWOHlyhTmX/dUjb+OJJjPGXMn4AApw0UHe2ZIsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"时间线\"\n        title=\"时间线\"\n        src=\"/blog/static/0ce30849a4870d72a825560fed237688/00d43/timeLine.png\"\n        srcset=\"/blog/static/0ce30849a4870d72a825560fed237688/63868/timeLine.png 250w,\n/blog/static/0ce30849a4870d72a825560fed237688/0b533/timeLine.png 500w,\n/blog/static/0ce30849a4870d72a825560fed237688/00d43/timeLine.png 1000w,\n/blog/static/0ce30849a4870d72a825560fed237688/aa440/timeLine.png 1500w,\n/blog/static/0ce30849a4870d72a825560fed237688/fd8a5/timeLine.png 1659w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>Webview初始化 Webview在首次初始化会占用相对长的时间进行初始化(可以通过Webview池的方式来优化)</li>\n<li>DNS TCP TLS 建立与服务器的连接，可以通过html的预加载标签来优化(dns-prefetch, preconnect)</li>\n<li>数据请求响应阶段 在解析响应的html的时候会解析到js代码下载并执行发起数据请求(可以通过服务端渲染方案优化但是也增加了服务端成本需要考量)</li>\n</ul>\n<p>从上面的分析可以看出在发起数据请求之前通过Native并行提前完成数据的读取就能换取页面提前展示给用户的时间，下面介绍一种可能的预取方案。</p>\n<h2>实现方案</h2>\n<p>本方案通过配置维护了对应url下需要预取的配置，在初始Webview的时候客户端并行完成数据获取，最后通过jsbridge获取数据。</p>\n<h3>预取配置</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 775px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/441b33eb2b2d3c8a3def8721c4aa2d2a/0098c/config.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA60lEQVQoz3WRx6rFMAxE8/8/l1VIyCINQnrvVZcjMOQt3mKwNZJmBts6jkPAdV1ynqfeOQ1M/4v/eGAhtO+7FEUh8zzLfd9/lujDGXxNvzxzKrhtm4zjKHVdyzAMKvpNOE2TdF0nfd8rMIdnz3AADXiL4SiKJMsyieNYkiSRdV3VETGMlmVRIwzLstRE8OzCA3jmLNR93xfXdcXzPHEcR+8MB0Ggok3TSBiG8jyP2LYtaZqqMTV30hGCWattW8nzXIVIiBNNUuBcVZUKmkTU7/tq/eX5A01o3hARBHD5/qbhOJlj3rwhtembvR/OZxjL3yVM2QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"时间线\"\n        title=\"时间线\"\n        src=\"/blog/static/441b33eb2b2d3c8a3def8721c4aa2d2a/0098c/config.png\"\n        srcset=\"/blog/static/441b33eb2b2d3c8a3def8721c4aa2d2a/63868/config.png 250w,\n/blog/static/441b33eb2b2d3c8a3def8721c4aa2d2a/0b533/config.png 500w,\n/blog/static/441b33eb2b2d3c8a3def8721c4aa2d2a/0098c/config.png 775w\"\n        sizes=\"(max-width: 775px) 100vw, 775px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>配置侧 提供配置能力，需要对配置有准入审核，管理(下线，上线)</li>\n<li>服务侧 根据配置提供获取配置服务</li>\n<li>Native 动态拉取配置更新本地数据</li>\n</ul>\n<h3>加载流程</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 923px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/b70892349e045d91bae6d4a918265e42/23266/prefetch.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 115.19999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/0lEQVQ4y42VV47DMAxEff/T5Su9996c3hg8AmPIJWUBQo5EDodDShvdbjcL7Xq9Jutms7HdbudrHMd2v9+T808WZcEUcDqdbL1e236/dwM0m7AIPCpi9ng87HK5OBAMD4eDf79er5xvDrAoIyCLxcKGw6F1Oh3r9Xo2m81sPp/b+Xz+WnqUzcQfAJSr0o/Hoy2XS2s2mw4M20+gCUNK3G63zqrRaHgwbCifFQ1hiA/2E5AgAgaDgYPV63X/DSAsp9OpJ+r3+w7+FZBDhF+tVg4MS8oMk6EpySaTyW+GHNIIldRutxOtxJBvZhHD9y8NYQi7VqvloLASIAnYH41Gv0sOy6KbdBlgAkNAtO12uynArEXhzZCGBAHMHoHscYaGJPu7y4AgOkwomd9iCEi5XLbxeOw6sq84WYqhACm7Vqu5Xgy3mLAPczRkItQcpIC9GporGSfAYMI3TFgrlYpVq1VnSdn44ocMpVLJ9/BLdZnssIQZAWKoc5Jwzh6JYIoP7NhntCJ1Byc9Agx1eMWQg2B0pft86w0gEYBIkHscyBo+qhpggjSf2bEhBpYkLXy+cAxNDdPQMwXhTWEFkB7kGBYNavgSUTKPBJJobMQwBfjJwpECCK0wWOqd1A1LSv4HUBrSZZrGM4YEaAk7JCj8J/UNkJLpLivsns9nTmtuyhvVnukgKd1z8gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"加载流程\"\n        title=\"加载流程\"\n        src=\"/blog/static/b70892349e045d91bae6d4a918265e42/23266/prefetch.png\"\n        srcset=\"/blog/static/b70892349e045d91bae6d4a918265e42/63868/prefetch.png 250w,\n/blog/static/b70892349e045d91bae6d4a918265e42/0b533/prefetch.png 500w,\n/blog/static/b70892349e045d91bae6d4a918265e42/23266/prefetch.png 923w\"\n        sizes=\"(max-width: 923px) 100vw, 923px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span><br>\n在加载h5的时候</p>\n<ul>\n<li>Native会在初始化Webview的时候并行的根据配置加载数据(动态参数根据页面url和配置完成映射)</li>\n<li>Webview展示的时候触发jsbridge请求，普通请求jsb与prefetch jsb的区别在于prefetch有一层从本地获取数据的步骤和数据的重置操作。</li>\n</ul>","frontmatter":{"date":"2021-07-23","path":"/cross-platform-prefetch","title":"一起学跨端技术-数据预取"}}},"pageContext":{"readingTime":"3 min read"}},
    "staticQueryHashes": []}