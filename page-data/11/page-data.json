{"componentChunkName":"component---src-templates-index-js","path":"/11","result":{"pageContext":{"pageAllCount":88,"group":[{"node":{"id":"dbb428a4-60cc-51c9-bbb6-74a94c623175","html":"<h2>前言</h2>\n<p>在react native开发中通常会使用Touchable<em>组件来实现对用户手势的处理.本篇文章从Touchable</em>组件的基本使用出发,逐步深入到react native中手势处理的原理.</p>\n<h2>Touchable*组件</h2>\n<h3>基本使用</h3>\n<p>在react native中通常使用一下几种组件来实现点击的处理</p>\n<ol>\n<li>TouchableOpacity</li>\n<li>TouchableHighlight</li>\n<li>TouchableWithoutFeedback</li>\n</ol>\n<p>对于TouchableOpacity的基本使用如下,通过绑定onPress事件就能获取到用户的点击行为进行处理</p>\n<pre><code>    &#x3C;TouchableOpacity\n      style={styles.button}\n      onPress={(evt => { this.onPressEvt(evt)  })}\n    >\n      &#x3C;Text>Press Here&#x3C;/Text>\n    &#x3C;/TouchableOpacity>\n</code></pre>\n<p>在开发中不禁会有这样的疑问,为什么TouchableOpacity能响应用户的手势点击而普通的View组件却不行.这就引出了React Native中的手势处理流程</p>\n<h2>手势处理流程</h2>\n<p>React Native中组件对手势的响应是通过如下的阶段来实现:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 862px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/ce81bc10b7f8954188997bc88c7eef3f/b4708/gesturelifecycle.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.400000000000002%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAG6AD//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAEFAn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAWEAADAAAAAAAAAAAAAAAAAAAAEWH/2gAIAQEAAT8hVFRU/9oADAMBAAIAAwAAABAAD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABgQAQEBAQEAAAAAAAAAAAAAABEAASFR/9oACAEBAAE/EH3VNXZv1f/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"react native 手势\"\n        title=\"react native 手势\"\n        src=\"/blog/static/ce81bc10b7f8954188997bc88c7eef3f/b4708/gesturelifecycle.jpg\"\n        srcset=\"/blog/static/ce81bc10b7f8954188997bc88c7eef3f/0479a/gesturelifecycle.jpg 250w,\n/blog/static/ce81bc10b7f8954188997bc88c7eef3f/41099/gesturelifecycle.jpg 500w,\n/blog/static/ce81bc10b7f8954188997bc88c7eef3f/b4708/gesturelifecycle.jpg 862w\"\n        sizes=\"(max-width: 862px) 100vw, 862px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>在每个阶段会有相应的处理函数来处理当前阶段的行为</p>\n<h3>手势响应的阶段</h3>\n<h4>申请阶段</h4>\n<ol>\n<li>View.props.onStartShouldSetResponder: (evt) => bool(返回true 代表当前组件申请在触摸手势的时候成为响应者)</li>\n<li>View.props.onMoveShouldSetResponder: (evt) => true(返回true 代表当前组件申请在移动手势的时候成为响应者)</li>\n</ol>\n<h4>通知阶段</h4>\n<ol>\n<li>View.props.onResponderGrant: (evt) => {}(获取手势处理回调)</li>\n<li>View.props.onResponderReject: (evt) => {}(获取手势处理失败回调)</li>\n</ol>\n<h4>响应阶段</h4>\n<ol>\n<li>View.props.onResponderMove: (evt) => { }(手势移动回调)</li>\n<li>View.props.onResponderRelease: (evt) => { }(手势行为结束(touchUp)回调)</li>\n</ol>\n<h4>释放阶段</h4>\n<ol>\n<li>View.props.onResponderTerminationRequest: (evt) => bool (当其他组件想成为当前手势的处理者时会触发,返回true表示释放)</li>\n<li>View.props.onResponderTerminate: (evt) => {} (当前组件失去响应者身份触发）</li>\n</ol>\n<h3>手势拦截</h3>\n<p>手势的响应是冒泡的,父元素可以使用如下的方法来实现对手势的拦截处理.</p>\n<ol>\n<li>View.props.onStartShouldSetResponderCapture: (evt)=> bool (返回true成为手势的处理者, 子元素不响应)</li>\n<li>View.props.onMoveShouldSetResponderCapture: (evt)=> bool ((返回true成为手势的处理者, 子元素不响应))</li>\n</ol>\n<h3>自定义响应组件实现</h3>\n<p>通过对手势处理阶段的了解,在定义响应组件的时候可以通过添加相应的函数来实现,react native定义了PanResponder.create()方法来快速的实现组件的定义.PanResponder响应回调函数中封装了事件和手势的状态信息,能更细致的实现对手势的处理.</p>\n<pre><code>class App extends Component {\n  constructor(props) {\n    super(props)\n    this.PanResponder = PanResponder.create({\n      onStartShouldSetPanResponder: (evt, gestureState) => true, // 触摸的时候成为手势响应者\n      onPanResponderStart: (evt, gestureState) => { console.log('someone touch me') }, // 触摸时间回调\n    })\n  }\n  render() {\n    return (\n      &#x3C;View style={styles.container} {...this.PanResponder.panHandlers} >&#x3C;/View>\n    )\n  }\n}\n</code></pre>\n<h2>后记</h2>\n<p>后面会按照下面的思路逐步的梳理下React Native相关入门与实践的一些知识.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/098f83ac1e178157d52feb66022c929c/5c263/reactNativeBasic.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABmklEQVQ4y5VTW0rDQBTtOlyAPyJuxA24C/8E0TX46ToEERTRUv8UaUMihUKCsa9kkraTJs17cmSupLZNH3Tg5P5Mzj3n3Ds1bDhFUczrIsqT5zmyLK/cre0iWj1CCAyHFrrdHjzPq9ytbVK3SJxlGSmSiKII36YJXTcwnkwwm82WFcqPEAXyNQijmFQYhgFFUaBpGhhjcEcjIuv1+5hwviSitilDiATIE2oWxzEpkwjDkEg598i6zRjyXCxn+G5wPCgMT5qDR1WC4e6ji6Y5rfSRtoMgIOI0TcmBtD0nFEWB05sPHF7UcXTZwMn1G46vGjg4f8HZbfOPRIjKpC3bhmXZlWGSwqbp4fnLRb09wmvbJdx/dqH2/LVpyCExx0G/PwBjzva1+W+ZoMjieYZljrJKu3IYvu9Tjo7jUBNSuGvKnHPouo5OpwNVVdFqtTAYDGDbDJZlEXkYRpTtXntYQv4oVbruCH4QYDqdwvcDpKXCfV9KOWlJNB5PqMoll/Y3Ktz2lktEUUzrIolM8wdJkmwn3NVoNZ5ybX4B7cM55EqQKNkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"react native 入门\"\n        title=\"react native 入门\"\n        src=\"/blog/static/098f83ac1e178157d52feb66022c929c/00d43/reactNativeBasic.png\"\n        srcset=\"/blog/static/098f83ac1e178157d52feb66022c929c/63868/reactNativeBasic.png 250w,\n/blog/static/098f83ac1e178157d52feb66022c929c/0b533/reactNativeBasic.png 500w,\n/blog/static/098f83ac1e178157d52feb66022c929c/00d43/reactNativeBasic.png 1000w,\n/blog/static/098f83ac1e178157d52feb66022c929c/aa440/reactNativeBasic.png 1500w,\n/blog/static/098f83ac1e178157d52feb66022c929c/5c263/reactNativeBasic.png 1636w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>","fields":{"readingTime":{"text":"4 min read"}},"frontmatter":{"title":"react-native中的手势处理","date":"2020-04-15","tags":"跨端技术","path":"/rn-gesture","top":null,"summary":null}}},{"node":{"id":"8376f00f-727a-5a04-bb7e-2e8e1c1c9067","html":"<h2>前言</h2>\n<p>长列表优化是一个老生常谈问题,优化的方案也是相似的(减少内存占用,复用渲染结果,可视区域渲染,预渲染),在跨端开发的React Native中列表主要有FlatList和SectionList两种,以下主要通过对FlatList的介绍来了解React Native中的长列表.</p>\n<h2>FlatList</h2>\n<p>FlatList通过预渲染和可视区域渲染的方案,来降低列表渲染时候的内存占用从而提升页面的性能.下面从FlatList的基础使用来逐渐展开.</p>\n<h3>基本使用</h3>\n<pre><code>renderItem = ({ item, index }) => {\n  return &#x3C;View>&#x3C;Text style={{ color: 'white' }}>{item.name}&#x3C;/Text>&#x3C;/View>\n}\nrender() {\n  return (\n    &#x3C;FlatList\n      data={[{ name: 'a' }, { name: 'b' }, { name: 'c' }, { name: 'd' }]}\n      renderItem={this.renderItem}\n      keyExtractor={item => `${item.name}`}\n    />\n  )\n}\n</code></pre>\n<p>在上面的例子中通过设置data, renderItem(条目渲染函数)就完成了列表的渲染功能</p>\n<h3>结构</h3>\n<p>FlatList数据渲染的原理是通过数据项和底层容器ScrollView的布局事件计算出需要渲染的条目,在滚动过程中动态的更新渲染条目来完成列表的绘制.FlatList渲染的内部结构如下:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 523px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/537a1f30ce767d4c75b99f25fe28c847/3e286/flatList.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 157.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAAAsTAAALEwEAmpwYAAADeElEQVRIx6VWS4/TZhS1xKhQsUfqhkUXlUCCUhYUqZVaCQmVAv+jSEjdTIuEkKpu2k2X7T9ohbqoVAQbEBKLMu9h3knITDJ24vgR5+XxK4kd56BzwenAamJs3Xyfbfn43nPPd74ocRwjDEP0ej0cHBxIuK4r1/1+H3w+HA5lPEoofEnXdTQaDezt7WF/fx+1Wg31eh22bWM0Gk0HGAQBLMtCs9nE7u6uAJZKJZimKfdyATITZrm1tSVZbmxsCHir1UKSJNMBkj+WR2BmtrCwIOUzO8Mwps8wiiIpk80gCMHZEM7JZZqm+UrmwRdZImMwGAi3uThkNr7vo1gsolqtTjLOBUgOydV4PJaXGZyTitwcMivKJJMKM9M0TficmkNmSKBMLmzE+vr6pNPTlxyEMEwDcRqj8LKA+aV56JaOcBCiYTQmgEcJAfQDHx2zg9iJ4Rs+AjOA1/AQ2REcy0E6TpHEiZTO7mc8Z0GQTBkEVRABv1f+wJf2V7hu3cQ31re4Zt/AFfUqnqnPkIQJ3AMX7XZblECNZkZCE6G8OOczgioIgNv2d1AOn66Cr9cv4f7cX3ix+AJaTRN+V1ZWsLS0hLW1NSwvL2N1dVWkVigUZJkyY8nwzv5vUNyzONn9Ase7l3HCvYwZ+yIe1Z8iDRMM4oFkUC6XJ86kqqoogWBUyqGSQ/xY0aH4wAc+MOMBygBQemM81HRZQYM3HPKgRhnZnAcz+x8wDDGra1AwwgzIQYqPWgY+L23iz+f/QS3vouk42N7eFmnRQFgm3YjBe1y6XAT8qIIwwA81C8oYmEkh4ykPuGCGeLBdhKPr8IJAyqM+yeHc3JzwSF4XFxdRqVTE9UU26AN3yn9DMWdx0vwJH5r3cKz1M5TGXTzSVl6bRvJatFz35JJdJQCvOSeHmV6ly983b73dZZ4jBf9a/wAjIBpGb+nt3Ti870iXf1F/xengY3zqXcTZ3jmcDz7DJ60zeFx/AqRAf9g/0iqRDMMoRF2rQ91ToVZUtO02quUqtIoG0zDzb1JOy8Hm1iZ2Cjsoloroub332/W4nbJb7BxNwfM9caHcewplQfXTAzkSnKtiaj8kIMEycrnY+YAGkAuQJTuOg2w7pasw+KFcewqFSkACEJBzOkduQL5I26fiPc+bjLR/usrUJfOHWXY6nUl0u10Jfmzaf1+vACaDAH8XnMbBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"listSection\"\n        title=\"listSection\"\n        src=\"/blog/static/537a1f30ce767d4c75b99f25fe28c847/3e286/flatList.png\"\n        srcset=\"/blog/static/537a1f30ce767d4c75b99f25fe28c847/63868/flatList.png 250w,\n/blog/static/537a1f30ce767d4c75b99f25fe28c847/0b533/flatList.png 500w,\n/blog/static/537a1f30ce767d4c75b99f25fe28c847/3e286/flatList.png 523w\"\n        sizes=\"(max-width: 523px) 100vw, 523px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>FlatList性能优化</h3>\n<h4>减少更新时列表项总体数目和条目的重渲染,</h4>\n<ol>\n<li>列表条目使用PureComponent或者shouldComponentUpdate来减少条目的更新.</li>\n<li>调整windowSize大小(默认是21)</li>\n<li>调整maxToRenderPerBatch的大小,控制每次更新的最大条目</li>\n</ol>\n<h4>减少内存的占用</h4>\n<ol>\n<li>减少匿名函数的使用</li>\n<li>列表条目的渲染逻辑尽量简单</li>\n</ol>\n<h4>减少渲染过程中的计算</h4>\n<ol>\n<li>使用getItemLayout减少列表条目的计算过程</li>\n<li>调整滚动事件的触发频次(scrollEventThrottle)</li>\n<li>在列表项中合理的使用缓存</li>\n<li>渲染过程中减少与Native通信过程,可以使用InteractionManager优化</li>\n</ol>","fields":{"readingTime":{"text":"3 min read"}},"frontmatter":{"title":"聊聊React Native中的长列表","date":"2020-03-22","tags":"跨端技术","path":"/rn-list","top":null,"summary":null}}},{"node":{"id":"0c99cf00-4347-5d99-b7b8-9d89fd0054d1","html":"<h2>前言</h2>\n<p>最近这半年从原来的PC转到了移动端开发(主要使用React Native),在跨端开发的时候需要与端上进行交互(jsBridge,使用端上的组件等).通过对端上知识的学习能在业务开发中知其所以然,也能更好的把一个方案落地.这篇简单梳理了第一行代码-Android的总体大纲.</p>\n<h2>读书导图</h2>\n<h3>笔记图片</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/03da0e420e87d88d88c51f3b533002d2/6f464/android.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 124.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsTAAALEwEAmpwYAAACt0lEQVQ4y41Vy5KbMBDk//MT+Yoccs8hx1Tl6N31Az+wAYEkQBhwp3rYYbGNq6IqWbI06ul5Et1uN3AMw4Dr9Sqz63ro0HuunH3fo65rNCGgLEs45zAfEX8IYq1DHO9xOBwRQhBBPp6DKpi1FpdLijzP5b8q4hqpYNM0uKQp0ixD27YoikJWBeN9VVWyJ0iSnJGcz0Li7f1d2NLKiA/40JgcqSlQ1Q26rpvcoJq99zL1XBUYYxDH8aQsorb1ZoPNZismUFjNVEBVwH1ZWgFRAHFZ102WRKO5QfxGM2n23FSCcZIdgQ7HI3ZxjCRJJsbzAEb6h4+OxyNWq9VdQAhOZbxXpfQXA1PXzV0GCEPd0AQKn04nZFku5tNPCqjgPGcglN0c7A6QK5lx5rn5NBsorUUI7QS4P10EsG6apzyd8nCuwXkv5tAs3AYMgUzGoARf4pLFTyCLDMcIljifzzCmgHcWcerw888ev99ytD3QtQGuSBeBngA1edM0Q1GU8LbA322Obz9W+P4rxikrUXmHqjRw1k3l+eTDz1MpPzrfOifBIctb3wEdfXUTGSosyhKr1RtMUSyyFEBGbLvdSXKnaTqrFAbKS+JqzefG4P3jY/TxK4ZkxmQlKItemForjLjXnCQgFZLhfn+YwO7yUNOBJtB/WZYJmArwTgEJzqbwsV5L6lDBU5S1e1RVLaWlbUmFx/741SyodH84SPIvJXf02AikjV2+6llrWbIgBHELWZLtvJEsVMp4cCkbFK7GMPTo+1GJdvOxDybSILT8Hptw9EjZFB5t2wnDtr1OLFjr9C2bKtOKvmZVPfrxCTA1O9TBwvtKQOfCVuo8n2r78buzCJikG1iXv/xIaXAe0+WO4fzA+1qmBuLx4StmLxmWhzWulcVww2JXecXsCVAjHSqHaxswLJj6P+MfteqgdEuoDakAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"安卓基础知识\"\n        title=\"安卓基础知识\"\n        src=\"/blog/static/03da0e420e87d88d88c51f3b533002d2/00d43/android.png\"\n        srcset=\"/blog/static/03da0e420e87d88d88c51f3b533002d2/63868/android.png 250w,\n/blog/static/03da0e420e87d88d88c51f3b533002d2/0b533/android.png 500w,\n/blog/static/03da0e420e87d88d88c51f3b533002d2/00d43/android.png 1000w,\n/blog/static/03da0e420e87d88d88c51f3b533002d2/6f464/android.png 1464w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>笔记导图</h3>\n<p><a href=\"https://github.com/icantunderstand/learnStuff/blob/master/androidBase.xmind\">第一行代码笔记</a></p>\n<h2>后记</h2>\n<p>后续会逐步更新react native和跨端开发的基础知识,希望能坚持下来.</p>","fields":{"readingTime":{"text":"1 min read"}},"frontmatter":{"title":"第一行代码-Android读书笔记","date":"2020-02-01","tags":"跨端技术","path":"/android-basic","top":null,"summary":null}}},{"node":{"id":"30a870e5-267a-5478-80ae-3d922926fb74","html":"<p>本文主要对EcmaScript规范中函数对象解读。</p>\n<h2>函数对象</h2>\n<p>函数对象是对外部的词法环境和有一定入参的代码进行封装后的对象.函数对象的调用支持动态的绑定执行环境.在javascript函数执行的时候,实际上是调用当前函数对象的一些内置方法来实现的.下面是函数对象的一些内部实现:</p>\n<table>\n<thead>\n<tr>\n<th>内部实现</th>\n<th>类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>[[Environment]]</td>\n<td>Lexical Environment(词法环境)</td>\n<td>词法环境定义当前函数对象生成时候的外部环境,例如引用的外部变量等</td>\n</tr>\n<tr>\n<td>[[FormalParameters]]</td>\n<td>Parse Node</td>\n<td>定义函数的参数列表</td>\n</tr>\n<tr>\n<td>[[FunctionKind]]</td>\n<td>String</td>\n<td>函数类型(normal, classConstructor, generator, async, async generator)</td>\n</tr>\n<tr>\n<td>[[ECMAScriptCode]]</td>\n<td>Parse Node</td>\n<td>代码体</td>\n</tr>\n<tr>\n<td>[[ConstructorKind]]</td>\n<td>String</td>\n<td>构造类型,当函数通过new操作符进行调用的时候,会用到这个属性.(base derived)</td>\n</tr>\n<tr>\n<td>[[Realm]]</td>\n<td>Realm Record</td>\n<td>当前函数对象的Realm记录,在函数执行的时候需要将函数与Realm进行绑定,由Realm提供全局的环境对象等</td>\n</tr>\n<tr>\n<td>[[ScriptOrModule]]</td>\n<td>Script Record or Module Record</td>\n<td>记录当前函数对象不同创建方式的记录</td>\n</tr>\n<tr>\n<td>[[ThisMode]]</td>\n<td>(lexical, strict, global)</td>\n<td>this会在进入函数的执行环境时进行绑定.lexical代表着this的确定规则是由外部的词法环境决定的(箭头函数),strict代表this是由函数的调用者提供的,global代表着this由外部的全局对象指定(需要区分严格和非严格模式).</td>\n</tr>\n<tr>\n<td>[[Strict]]</td>\n<td>Boolean</td>\n<td>确定当前函数是否是一个在严格模式下执行的函数</td>\n</tr>\n<tr>\n<td>[[IsClassConstructor]]</td>\n<td>Boolean</td>\n<td>是否是构造函数，如果是构造函数通过[[Call]]方式会报类型错误</td>\n</tr>\n</tbody>\n</table>\n<h2>规范详细解读</h2>\n<h3>[[Call]]</h3>\n<p>当通过指定this调用函数对象的时候，实际上会执行内部定义的[[Call]]方法。<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/8dd9d06f57c8cce4f5daf449ce67ade9/da952/Call.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.39999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACJUlEQVQ4y42SC4+tKBCE/f9/cHfmzpnjG48KKiIgoN9GZ242+7ib7aRIA6Horq6s719UVUn+fFJ1glpJKiVplaSUI41eEXrF7gG/71hrcc7hY8SnhN8Dbk+4kDjOk6wUA3nT0/aSVggaOdIpieh66qqmrBrK5kVeC4qiuD/O85xCCIpOkFcVz6rlWQs268jmZcG4nZgOnPd3FXsIhHTi48F5nnAenMfBX+I+P7/z6+5rn3nv6aeFblkQQ09ZljTDRKs2WmWQqyOk45vj/BNfFJw/+b+RGWNohpHKrLSrpnqNFK+JYtCU0lKOmkdRk1cNKaV/Ev8N2SXwpc97UfCjKvl4PHh/e+O3t3c+niWjmpn0hg+J/xPZtax6oShLummiapo7z9uGZyco64au75FS0Q2SfjaMq2VPiRgjIaZb/wvpOL8IQ4jU4sViLWvcWTeD1prVxRvaBqbVotSEVAplLcvuWbRmWS3TtjMZj9sj2XEc9P3A74+Cclip5UY+GGo1M7sNnyI2BmyKpJ9T/a+Wr0o+i5yi7/l4TfwQirey50MoHv1EriY+p5l8HNDriosBl+JtMef8bWi7R/b4pXF26dDLmdVa/BFxu2dbNZsPbD5iXMC4iDEbyzyjncXEgLEbZrNoF9B2v9u9CZdl4dFJ3quOz6KmaMU9ADktSO1Qxt9enJ1lGMeb9Fdx2+ZquREvhFqplaGdDXI21HWFlPKXD/8NV4V/AHQW58QcFWiNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Call步骤\"\n        title=\"Call步骤\"\n        src=\"/blog/static/8dd9d06f57c8cce4f5daf449ce67ade9/00d43/Call.png\"\n        srcset=\"/blog/static/8dd9d06f57c8cce4f5daf449ce67ade9/63868/Call.png 250w,\n/blog/static/8dd9d06f57c8cce4f5daf449ce67ade9/0b533/Call.png 500w,\n/blog/static/8dd9d06f57c8cce4f5daf449ce67ade9/00d43/Call.png 1000w,\n/blog/static/8dd9d06f57c8cce4f5daf449ce67ade9/aa440/Call.png 1500w,\n/blog/static/8dd9d06f57c8cce4f5daf449ce67ade9/da952/Call.png 1872w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>将执行上下文切换到当前的执行上下文并对当前的执行上下文做基础的设置</li>\n<li>如果当前函数是类构造函数报错并退出</li>\n<li>在执行上下文上绑定this</li>\n<li>执行函数</li>\n<li>恢复执行上下文，如果有返回值返回结果</li>\n</ol>\n<h3>[[Construct]]</h3>\n<p>当通过new操作符调用一个函数对象的时候,实际上会执行内部定义的[[Construct]]方法,下面从规范上理解[[Construct]]方法从而理解调用构造函数的实际行为.<br>\n在通过new调用构造函数的时候会进行一些参数的修正然后调用构造函数的[[Construct]]\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/a8aaa81fd5db1aa5cda7b93d497f662b/5068c/newBefore.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABlklEQVQoz42Su27cMBBF9f9t+nxG6sCt26RJvGuJEiW+RFLUY7VriSeQErsL4AEOwEvM3JkBWUgpEULw+lpifY8eBsQQkWlAx4j2jtJ1SN0xpkTOmW3b2Pf8l5zZD71t5H2nkI1EdR1N02CtRWlNpxRKK3QYaH58p3v6ivz5hAkDSim01tg4YdOKiQsuBFqtSdNEIQ4za88pGymRbUdVVVRCIFR3UoqSsqkpmwZR12fzqpaUdUvVKoT3VKEnLQvF78vlTKrKksv1SlW3XF5esMYweI+PETtN9N5jtcaHcOKspXcO73uMtYQY2Y+VjwIzJlwMWKMxWtPHiFtm0u3Gtu+w7+S885kotA80Q6IbbnRmoq47tFL4ZaFfZoZpIqWE73timnjb9vNh/kchtacxA7X+RdU9I+wV4Xpc71gfD7acPzVZ/pdXaGOIw0hrvlG3X2jtM2a8YWLApYQbE/f7ncfjcXKcj29zX1fWdf3Q76bFcXHE9IDpDR73zDJPrLeVZZ5P5mVhHEfmeT7XP2pijIQQPvS74R+Y/K4/ae/U/QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"newBefore\"\n        title=\"newBefore\"\n        src=\"/blog/static/a8aaa81fd5db1aa5cda7b93d497f662b/00d43/newBefore.png\"\n        srcset=\"/blog/static/a8aaa81fd5db1aa5cda7b93d497f662b/63868/newBefore.png 250w,\n/blog/static/a8aaa81fd5db1aa5cda7b93d497f662b/0b533/newBefore.png 500w,\n/blog/static/a8aaa81fd5db1aa5cda7b93d497f662b/00d43/newBefore.png 1000w,\n/blog/static/a8aaa81fd5db1aa5cda7b93d497f662b/aa440/newBefore.png 1500w,\n/blog/static/a8aaa81fd5db1aa5cda7b93d497f662b/5068c/newBefore.png 1917w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span><br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/86392e3bf6a558e63d48d3af4d524b6b/9efb3/new.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACIklEQVQ4y42T2Y7bMBRD8/+/VxQoWkydWNa+Wd5i2UlO4Uy36cxDBRDSiwjykveUc0Z2EqUUnRBIrZExYnJ+RYrInEnjwlJ31roxzzPLsjBPM8v1yrJvXPf9+T7lcUDlhCsZ02d8SqhOouUBhVQG0Qo65bh0GtFJRNvSdR3n85lWCIS1CGNIOXPat400LLh+xsWIdPap0oRMnipLvfF6HvzPOdW6YqznHBJtSjRKcu40L60ijVfytDIslcfj8V841VqJOeNK/7RhteaYaykD9/v9nbjnxw+U/SbctkouBeEsX7Xiu7Eol1BxQoYRGQZ0HpFpJA4Tpa44759ztNbS/rx/kT4VGh8RMXOJAeE9rTQ0KnC2I40ttKHQxp65Vrb7jXq7sd1ub6z+IVxXYt8TxwFpLSEGnDHYkLAho13C50JY5iemulLWlWldD4b3oRydUkcQKdA4T+MT343jpbN8bS3fWk3jEnGeqfv+4dz+Vnm6LgttJ2mNxZSCGSa0C+hQUGnB9jO6zJiYSSGQx5G+rvTzRN8X8rg+21Dm+kq4Xq/kccKm8kx3GAopRa7L/K5/h4j748G27xz9ffxj+WfKG/tWMSFysY6mvXBpGkSnEMrRaY/wBRELIhTCMNIPAzHG37V6Y/lIuT8KrS3fpObT5y80QtCcW17OAmUDnTK8tBeUs3jv36l6E8qx5FJKrI+4cUZaj9CaEDw87h+u10d1+UX4A21fMqcRX5VbAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"new\"\n        title=\"new\"\n        src=\"/blog/static/86392e3bf6a558e63d48d3af4d524b6b/00d43/new.png\"\n        srcset=\"/blog/static/86392e3bf6a558e63d48d3af4d524b6b/63868/new.png 250w,\n/blog/static/86392e3bf6a558e63d48d3af4d524b6b/0b533/new.png 500w,\n/blog/static/86392e3bf6a558e63d48d3af4d524b6b/00d43/new.png 1000w,\n/blog/static/86392e3bf6a558e63d48d3af4d524b6b/aa440/new.png 1500w,\n/blog/static/86392e3bf6a558e63d48d3af4d524b6b/9efb3/new.png 1894w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/80ebd86d02879f771e89df0c9c2b0c60/161ec/createObj.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABcklEQVQoz3WS646kIBBGff/368kmCiLSAord4/3aezYwmZ9byUlRX6Coj5BJY3jkOX+kJBcCXWmMMdR1nei6Dj9PuGWmW2bcHJkw00gzTzTjwHEe/EZWhQ4dOqrWY71jnibWdWVZFuZ5Zt02tuNg3Xf242DZtrT+JdXryr7vnOdJJqREx2kaj7YBqTRfXw8ejwdCiISuKkqlkJGypCxVQhQFpZR47wkhpCEy5R3Ke+ouYBr3c1AIpJQoVaUcNWVtclHZJu3TpkGVJZWuecZaa8ZxJHNNg7cNMbfO4Z3DWUfbtolo575vrvPkvi6O4+A8D67r+tHvD+f9SXoka/sB17/x32+efaAdvulCoHmaRB8CXWzufSLWfegTzvlkN178er24rpusfloKrSlKRVFbRG1RxiGUoVCGsjbkukJoTfwRea3JtaY2T5y1OOfS+8WmwzCQNdHqe8C/V/x7wY8zYVnxy0o7LeznxQcSN3Dxl4v/xz9Dj1l5z6jTKAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"objCreate\"\n        title=\"objCreate\"\n        src=\"/blog/static/80ebd86d02879f771e89df0c9c2b0c60/00d43/createObj.png\"\n        srcset=\"/blog/static/80ebd86d02879f771e89df0c9c2b0c60/63868/createObj.png 250w,\n/blog/static/80ebd86d02879f771e89df0c9c2b0c60/0b533/createObj.png 500w,\n/blog/static/80ebd86d02879f771e89df0c9c2b0c60/00d43/createObj.png 1000w,\n/blog/static/80ebd86d02879f771e89df0c9c2b0c60/aa440/createObj.png 1500w,\n/blog/static/80ebd86d02879f771e89df0c9c2b0c60/161ec/createObj.png 1840w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n[[Construct]]主要分为一下几个步骤:</p>\n<ol>\n<li>将执行上下文定义为当前的执行上下文</li>\n<li>获取当前函数对象的[[ConstructorKind]], 如果是base类型, 将当前的执行环境的this设置为以构造函数为原型创建的对象</li>\n<li>创建新的执行上下文将2中的this绑定到当前的执行上下文</li>\n<li>在当前的词法环境和环境记录上执行构造函数</li>\n<li>退出当前的执行上下文,返回到上次的执行上下文</li>\n<li>如果执行构造函数的结果是有返回值的,当返回一个对象的时候直接将执行结果返回.当有返回结果但是不是对象的时候返回之前创建的this</li>\n<li>没有返回值的时候,返回之前创建的this.</li>\n</ol>\n<h4>简单实现一个new的调用过程</h4>\n<pre><code>function myNew(Con, ...args) {\n  const obj = Object.create(Con.prototype);\n  const ret = Con.call(obj, args);\n  if(ret instanceof Object &#x26;&#x26; ret !== null) {\n    return ret;\n  }\n  return obj;\n}\n</code></pre>\n<h3>Object.create</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/6cf0fab11d6071570431a07fe120598e/019a6/ObjectCreate.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA+klEQVQY032QW26DMBBF2f93V9Bt9Ct7aKUooQ8IoRA/iAUo4NepbLVRko9auhpd2XfmeAohJX3bUG2eaV6e6F43qNXSjoZhnoghEGO8KoRwp9u7pEJKyaGuqD92HKuSrm0YjEFojVQKYwxaa4ZhuCr5lOv7Pvvz+Zz9PM8UKdD1J3qhSLRaKZxdcdayXC4sy8I0Tfnx5dffEnrv72ph15VDd6KWmqrt2X81bN8ryqqh7TqmccxDhBDoYcjE/50ikZy0Yn885IbbzyNvZU1ZfyPMxOwso7WEGK+hx73d7dB5h5IKoRTWe1wAH8l1sZ7Fuaz0pb/QbeNHwh/2uc30ZuRRvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Object.create\"\n        title=\"Object.create\"\n        src=\"/blog/static/6cf0fab11d6071570431a07fe120598e/00d43/ObjectCreate.png\"\n        srcset=\"/blog/static/6cf0fab11d6071570431a07fe120598e/63868/ObjectCreate.png 250w,\n/blog/static/6cf0fab11d6071570431a07fe120598e/0b533/ObjectCreate.png 500w,\n/blog/static/6cf0fab11d6071570431a07fe120598e/00d43/ObjectCreate.png 1000w,\n/blog/static/6cf0fab11d6071570431a07fe120598e/aa440/ObjectCreate.png 1500w,\n/blog/static/6cf0fab11d6071570431a07fe120598e/019a6/ObjectCreate.png 1818w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>判断传入的原型是否是Object/Null，不是的话抛出异常</li>\n<li>根据传入的原型创建对象(如果传入的原型参数是空那么创建的对象没有原型)</li>\n<li>在创建的对象上定义属性并返回结果</li>\n</ol>\n<h3>规范示例</h3>\n<p>[[Environment]]定义函数对象创建时候的外部词法环境.实际上在javascript中函数就是闭包的概念.函数在创建的时候就已经跟外部的词法环境进行了绑定,在调用的时候并不会改变函数的外部的词法环境.</p>\n<pre><code>const a = 100;\nfunction test() {\n  console.log(a);\n}\nfunction test2() {\n  const a = 200;\n  test();\n}\nconst obj = {\n  a: function() {\n    test();\n  }\n}\ntest2() // 100\nobj.a(); // 100\n</code></pre>\n<p>在一个构造函数中返回一个非对象:</p>\n<pre><code>function Person(name) {\n  this.name = name;\n  return 1;\n}\nconst person = new Person('ss'); // { name: 'ss' }\n</code></pre>\n<p>对于this的确定,可以参考下面的确定规则:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 955px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/460681b8e463e26d3a1b7f288f0aaf8e/a0b80/this.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 94.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB2klEQVQ4y32UyaoCQQxF+/9/RlDUhbhR3KiI4oiI4DzP85jHCUTqdbcWhC4rqVvJzY3e7XaTx+Px1Z7PpxAzm81kPp/r93A4yOv1CsSdTifxcHxb7/f78x2Px9JsNmUymcj5fA6Nv16v4oFsl1zjIYw9MZvNRm29XsvlcgncYXEeAPy1n06nmoU/+6+A7pflpwP+4POb/2eGZAJvAEB2pVKRVqsltVpNgfEPBgO53+9qPwEJ2O12CkQD4K7X6ylYv99XQC4fj0f1b7dbvfOvKe7a7/eyWCz+nSENLlpD3MXDgFGNR6C1nFe4gDQwA7BG4HcrAYAM0SfdpyrNEBsOh7JcLqXdbkuxWJRyuSz1ev1Tottdt6uj0Ug6nY7GYZ41wM3C9GZnPMh0+AHx53I5iUQiEovFlOMPoKt+/29ooQFhGRJLZeyhKADo6tD2AIZlyLmpAQPYM4cJ1j+CVrL7oOtzH1bZALRarZR4gMMAAcPvn47QWYbIeDwuyWRSut2umIzsT4EyaBDSQJsul/4MFZC2JxIJSafTypNfHugxk8lIoVCQarX6k2sFLJVKks1m9VKj0fjMpXFHEJkjDybI/28TAMzn85JKpSQajerwW8nGl00AX8ztdhjgHySBv0iaXn0uAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"this\"\n        title=\"this\"\n        src=\"/blog/static/460681b8e463e26d3a1b7f288f0aaf8e/a0b80/this.png\"\n        srcset=\"/blog/static/460681b8e463e26d3a1b7f288f0aaf8e/63868/this.png 250w,\n/blog/static/460681b8e463e26d3a1b7f288f0aaf8e/0b533/this.png 500w,\n/blog/static/460681b8e463e26d3a1b7f288f0aaf8e/a0b80/this.png 955w\"\n        sizes=\"(max-width: 955px) 100vw, 955px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>参考</h2>\n<p><a href=\"https://tc39.github.io/ecma262/#sec-ecmascript-function-objects\">ECMAScript2020</a><br>\n<a href=\"http://ldllidonglin.github.io/blog/2019/04/26/2019-04-26-ECMAScript2016%E8%A7%84%E8%8C%83%E7%90%86%E8%A7%A3%EF%BC%888%EF%BC%89-new%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B/\">ECMAScript2016规范理解（8）-new表达式的执行过程</a><br>\n<a href=\"https://icantunderstand.github.io/blog/javascript-call\">深入理解javascript系列之执行环境</a></p>","fields":{"readingTime":{"text":"7 min read"}},"frontmatter":{"title":"ECMAScript规范-函数对象","date":"2019-05-29","tags":"JavaScript","path":"/ecmascript-function","top":null,"summary":null}}},{"node":{"id":"c2ea6440-912f-5b29-8371-f61ee1bcc935","html":"<h2>前言</h2>\n<pre><code>import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nReactDOM.render(&#x3C;App />, document.getElementById('root'));\n</code></pre>\n<p>当通过create-react-app初始化一个项目的时候,上面这段代码就在浏览器中绘制出了内容.ReactDOM.render(ReactElement, Container, callback)是怎么将React组件绘制到浏览器中的呢?本文是React源码阅读系列的起始篇,在这篇文章中主要围绕以下两个方面进行介绍:</p>\n<ol>\n<li>render()方法调用中相关函数的调用</li>\n<li>render()方法调用中产生的数据结构的梳理</li>\n</ol>\n<p>阅读源码是一个知其然知其所以然的过程.通过源码阅读的过程中我们能学习到一些设计,代码优化,解决方案等,通过这些来反哺实际工作的遇到的问题.这个也是这个系列想要获得并且与大家分享的内容.</p>\n<h2>如何阅读React源码</h2>\n<p>React仓库是一个包含多个package的仓库.在阅读源码之前需要对独立的仓库有个简单的认识.比如react通过react-reconciler和renderer(react-dom, react-native)来完成页面的渲染.</p>\n<ol>\n<li>\n<p>下载<a href=\"https://github.com/facebook/react\">react源码</a>, 打包本地文件</p>\n<p>yarn build react/index,react-dom/index,scheduler --type=NODE</p>\n</li>\n<li>\n<p>通过yarn link声明包的指向</p>\n<p>cd build/node_modules/react\n// 声明react指向<br>\nyarn link<br>\ncd build/node_modules/react-dom<br>\n// 声明react-dom指向<br>\nyarn link</p>\n</li>\n<li>\n<p>把项目中的依赖指向设定的包</p>\n<p>yarn link react react-dom</p>\n</li>\n<li>\n<p>增加断点调试</p>\n</li>\n</ol>\n<h2>ReactDOM.render()调用过程中的函数调用</h2>\n<p>以下所有代码基于React 16.8.6</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 218px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/548b054e096b5dbdd8ab61b79d1b93ba/5c416/renderFunc.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 241.28440366972478%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"reactRenderFunc\"\n        title=\"reactRenderFunc\"\n        src=\"/blog/static/548b054e096b5dbdd8ab61b79d1b93ba/5c416/renderFunc.png\"\n        srcset=\"/blog/static/548b054e096b5dbdd8ab61b79d1b93ba/5c416/renderFunc.png 218w\"\n        sizes=\"(max-width: 218px) 100vw, 218px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>走入ReactDOM.render()源码</h3>\n<p>首先定位到packages/react-dom/src/client/ReactDOM.js\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 698px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/ccc403ac7ab7468246c5721e902cf82e/487bb/domRender.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 98.39999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC+ElEQVQ4y52U226jVhSG8xSpOR+92YABY2OM8RHHsevJTNJeVDMv0Mve9P2lr2LbsWamSaXmYmn/WoKP9e/1i7tCuPz1lPL384h1HjDQDUxDR9cGGLqOaRhog3t0XVM9bTDAtCxs28a6nt/X3dBz6NoJz89n2v2RaFRQ1EvKdke53FMuO6abI+O6ZbJYU7UbQt+/Qf8FdBwHNxpR7r8we3yh2p+ZTmecn77y+9c/OTx84dPnb3x++cZ6vqTKCnzPe3M6BXQdmzAeKdDs8MTi199IkpSm27E6HZlv1tTLlkmaE3geA027wd607PseSVYg0gJfZgRxRuB6FGlMmkqyUUwcR5imqQC9o/dgCuh5Hkkimc8yUukxHUsSGTK4v0cf/II+GKBrGqauqWVdTuNN2MWy6+L7Lov1gqbbsz4eaPaPiKIiKmuicYUc5cSTOSKfIssamWZouoFhWuimiW6YGFcHasLeThSPWKx2tKst9apjsdqy7Q6sNlumVUW93NKstjTrjrqascgTkmFILocUckgyDHBd5zphEBB6LsXQo0kChGNQCJ9p5DOLh0jfJfYd8qFPGrgkoU9bJArW5AmLPGYkQoIg4M62HeJYUo5zTNslzKb4UYzjenhBiGFZKnOmZX+nLbSrzd7uRVsXy/3W4liQZxKR5pTro7onEUmiKMLqQf0Lhqmu5mdtXvXr1hVQiIgkjvF9H8+xiESAEAFShupjURSSxOLaG6rqezK6aCFC+vhdJ3QRUcSu65gvlhTjjNOpZbetOZ2WPDw0rFYVh8OCpinpujm7Xa16m81M6badqGszTbVlH8s0iIqK8fqAzMbomo6uG2iarupVX84fdX/21du+BduxbeJxRf34QvvpD/KqwbJMHMdW9V6If65bDm3LIi5nTHZHxqsHZvszkUywrl/9GHA8Y9qdKdsttm398ND/gd6Aspgy2R6pjy9Um0f6wP/XX+Vd4Gts0jRVge0D7Xr+h6ZTQCEERVGoJfSAS5kfmq4H/gP/FkIGbbuk8gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"domRender\"\n        title=\"domRender\"\n        src=\"/blog/static/ccc403ac7ab7468246c5721e902cf82e/487bb/domRender.png\"\n        srcset=\"/blog/static/ccc403ac7ab7468246c5721e902cf82e/63868/domRender.png 250w,\n/blog/static/ccc403ac7ab7468246c5721e902cf82e/0b533/domRender.png 500w,\n/blog/static/ccc403ac7ab7468246c5721e902cf82e/487bb/domRender.png 698w\"\n        sizes=\"(max-width: 698px) 100vw, 698px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n可以看到ReactDOM.render()方法将当前的ReactElement和Container信息传递给了legacyRenderSubtreeIntoContainer.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/b5582cb16e1290c05326982304c8019a/fe9e8/containerRender.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 98%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC7UlEQVQ4y4WU627bRhCF+RrlbS+8L6+iSNOUFCVV7LS1oaBFgwJtUPRX3/8RvmJXieE0sPzjYHbJmd2ZOWfWy7sZs/uZD3dv+fePO/5+XPl8vuHP8w2ff1v563zDPx9vOJ82ZHVNHEXEcfwivLSo2BxOtMuRat3R7ncM+1vaaUTnOTpN0UlKmiQUeeaCoiuHemnVsD58Yv/4iel0Yno4MT+8p+lbQt93wVEUOhuGIVH8WoZ5Sbe8oZlW6q5j2A70fUMcRkT/c74cfh1emqYorYlFjJQxSgqEEMQW9qCvayEQ8lvYGPEMdu/FIiIzkqJVZLWFJq0kaSXc3q6zWl6+lQKdCVQmSEpFUijS0vprZ3Wu8FSSUU8zm8OedhkxvaGdt/T7A808Uk8Tm+OR8d0b2mVHWXfU/UhRlERh+H0PE5ViTEO/rjRDjU4FUmuE1MSxLV8hVHKBTomFQn75FwQBQRA6svwgcNazuir7ATN0NDcL7e1CXtdUw0Q93TprNjNJXjJ0FduxYRgM89yx2dSs64ZpatluW4wp8UQckdcdy0+/sv7yO2aYEUIikxTbDqETtxZSkSSaNNXPrPrGKiXxpJQUWU5SGNKqJats2ZljWsYRWsQox6IgDC9afMk62SilaApDUvXIsiNvB8x2obJl5ylDldObgjzPrwr6iRR7c14lVI2mbjWllU4u0IVC55JYR0grk0o5nX0du5fGz7OCHfuG0/sfuf/4yP35gcPdB4ZlR9MNFE2PqQq0lmitXp9lIaXTU9FNjOuB5bBjOR7ZH3eM247tNDBPHePYMI4tyvo/y/L70UskF6Zbx/Jyf6a2MimqS6O/NP150NUedrV0t2ZlST3v6eadYzcMfIRzip7eQNvv1+DFscRKZx4WTFGiVeRko7McqbTTols/K/VqhtbRZlgPM90wMG1bqm7AjAt5VVN2I832ljTLnmb36vNl0zTGuOfH9318PyC0c+n7hGHgSg/8H1w/X2PYZvgf6TQ+Dh0+uR0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"containerRender\"\n        title=\"containerRender\"\n        src=\"/blog/static/b5582cb16e1290c05326982304c8019a/00d43/containerRender.png\"\n        srcset=\"/blog/static/b5582cb16e1290c05326982304c8019a/63868/containerRender.png 250w,\n/blog/static/b5582cb16e1290c05326982304c8019a/0b533/containerRender.png 500w,\n/blog/static/b5582cb16e1290c05326982304c8019a/00d43/containerRender.png 1000w,\n/blog/static/b5582cb16e1290c05326982304c8019a/fe9e8/containerRender.png 1146w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n由于是首次mount,这个时候还没有root节点并且是应用的根节点这里直接进行root节点的创建.最后调用root的render方法就开始进行页面的绘制.在legacyCreateRootFromDOMContainer方法中会对当前容器的内容进行清理.这里调用创建了ReactRoot节点.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 972px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/91680b2c143842cd0cbd5fb4f5cc6eca/7ae9c/createReactRoot.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABu0lEQVQoz22S3U7cMBCF9y0qNrFj52eT2InjkGQ37MLC0iJVAgoUbtqC+v5P8VUJVEUqF58851wcz2hmkZWOZneF333h9umJ+98v3Dw/8+3lF7c/f3Dz8MDd0yPXd/fcfH9ktz9Ha02SJB+y0HGCP/vM5usD/vQSvz2h3Y90hy3W14TLgCD4RxiGSCk/RAjBIs8L7G6L7ToK68hyQ2ksRWmQoeBoDgxZvnsn768OgiXB8mhm+mwRRQrbbmk25/SX1wxXtzQnF3TjiG8sTWNwrqRxhrouZz1RVQXWrChsRV635LUnzbIpUJKZgnocqNdrqnVHWZf4Y8N627DZeYbRMe5bfGvnYO/ta6DNKWxN7o4pXPsWqCKiKEDpACE+EakjIhUgY4FUIXKuJdFEEhHK8L+Rw/cjK61J64ayd7hxTb3uqfp+7nLlagrvSHNNvFJkJp5rKcW8ACHCN171tJiF1jGdP8VVA2ZzwOzPMYcD5WbAbS7mkzK+Jy0stjuhaHpMO7AyNbbf4sYzqmFH5TtUJFlkWUYcKZSMCIVEKInQEVIrdBwznZVOUlQcE2eruZ68WaerVy/NiJN07vAPulILAw+TO9QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"createReactRoot\"\n        title=\"createReactRoot\"\n        src=\"/blog/static/91680b2c143842cd0cbd5fb4f5cc6eca/7ae9c/createReactRoot.png\"\n        srcset=\"/blog/static/91680b2c143842cd0cbd5fb4f5cc6eca/63868/createReactRoot.png 250w,\n/blog/static/91680b2c143842cd0cbd5fb4f5cc6eca/0b533/createReactRoot.png 500w,\n/blog/static/91680b2c143842cd0cbd5fb4f5cc6eca/7ae9c/createReactRoot.png 972w\"\n        sizes=\"(max-width: 972px) 100vw, 972px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/c5e79bbf934850f9fe4c7198d42ec888/46e51/ReactRoot.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABFUlEQVQY052Qy1KDQBBF+QxlhsDAPCBAIA9CHkQqhIVa7nSvW///A44F2bi0XJyqvnfRt297WXtj2V75fDvw/bHn6/2CSS2RTgjDkCAIWCwWf8ZbX0Z2wwur00CxP1JeDuyer6y7FhVF/1jY3ajPA/l2R3U+sjk0ZM4RhSG+EEgpkVIghSCQckbO/p3fegr37LJEGUdiLdrEOJdgTIzWCqMV2mgSm5K4DJVolDbzHBtLrO3sTVpbN7/IM5seu2pohlfq9kw3jvRDx/npRD/2VFVJvj1S7jvSosKVNUVzIls3LOsdrqgo9h3ltiVWCi+MDcl04ZSS5ui8Ioo1odIokyJ8H+E/zszVxF1L378jBMJ/mL2p8g9NYa5liRgmAQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"reactRoot\"\n        title=\"reactRoot\"\n        src=\"/blog/static/c5e79bbf934850f9fe4c7198d42ec888/00d43/ReactRoot.png\"\n        srcset=\"/blog/static/c5e79bbf934850f9fe4c7198d42ec888/63868/ReactRoot.png 250w,\n/blog/static/c5e79bbf934850f9fe4c7198d42ec888/0b533/ReactRoot.png 500w,\n/blog/static/c5e79bbf934850f9fe4c7198d42ec888/00d43/ReactRoot.png 1000w,\n/blog/static/c5e79bbf934850f9fe4c7198d42ec888/46e51/ReactRoot.png 1003w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\ncreateContainer根据当前的container信息来创建根容器.\n定位到packages/react-reconciler/src/ReactFiberReconciler.js\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 983px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/d744dcb576c159192651c4712d527cc4/91b29/createContainer.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA+ElEQVQY04WNSU7DQAAE/Y3EM94nnsXbTOIosYMUCCCxiAMP4AT8/weFSCQOHOBQUnUfuqM8y5n6mdaNKH9FEa6Zxp7P54GPlw3vT56325a6KoiFJEmSP4mkWFI2geH0Sjvf0x0eqEOgPx0YjjOVUiwWS6RM/h07DyZSYMOIv3vETTNuv8VPW5zVFGmKiJdIESPiC1KIi4tf+dulJEqThLb37G5OjMcD++OO9brHuhprVihtUab5IS8VyraUtaHSlqJanfvaNmRZRpRmKXalaXONLSt8Z+g7QwgNfnCYzmP8iO7X1O1wPjDDBt2FM0o7zDDi/IaiKPkCswmTgkGvCxoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"createContainer\"\n        title=\"createContainer\"\n        src=\"/blog/static/d744dcb576c159192651c4712d527cc4/91b29/createContainer.png\"\n        srcset=\"/blog/static/d744dcb576c159192651c4712d527cc4/63868/createContainer.png 250w,\n/blog/static/d744dcb576c159192651c4712d527cc4/0b533/createContainer.png 500w,\n/blog/static/d744dcb576c159192651c4712d527cc4/91b29/createContainer.png 983w\"\n        sizes=\"(max-width: 983px) 100vw, 983px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n定位到packages/react-reconciler/src/ReactFiberRoot.js(Fiber !!!!!!)\n在createFiberRoot方法中,创建了根据当前的容器信息创建了FiberRoot并且创建了一个HostRootFiber进行相互引用.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/52525f7a291707863825ad97e39b8ba5/05fb0/createFiberRoot.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.400000000000006%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABr0lEQVQoz42S2WobQRRE5zeiWXvvHs2u0UhCXmMldggB61H//yEnjBYTCAY/FNW36S6KqhutlyNl6NDtFlONrH4d2byf2B5P7I4nlHUkSUKWZV9CVE13bF7fGb//pr17pnl5IEwjWSFIs+LLQh+Cy9XE8HSgmiaa7UjdVhgpSNOUNF6QxjHp4oIknrEgWSwuPM+Lb9f7mCSJiXwz0OwfGB8fqboWO7SoqsRYh/QNoq2QfYNctdiuo+wmQj8x/3PLlnLY4MqaUHf4UBLlhSAXkpmlEoRgcU4htUQYg/CawmkKr5HeoJxDeYtyFmU12nuMMxhrkEISSSMJg6OaPMsxEHpH6D1CC5TJcaXElQrnFb7SmKAwQV9QGpQt0EFQqPxcXqRDi2vX1NOOZrOnWu/o7w/4dqTuenZ3W1ZDxWqoz1w3DaGbcPVA2a3PruI4IU1vpYw7+oefdPcHxqc3Vk+vdPtnNm9Hph9/GO5fWPbrc+jnomZk6cf534bnOVJSY5VDWY9y/pxllucUc655TpamFEJ8uiY30RtHwQaC8tiyvixxHF8fJFcX2X9OPhOdBf8CLMQh8QdqEjAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"createFiberRoot\"\n        title=\"createFiberRoot\"\n        src=\"/blog/static/52525f7a291707863825ad97e39b8ba5/00d43/createFiberRoot.png\"\n        srcset=\"/blog/static/52525f7a291707863825ad97e39b8ba5/63868/createFiberRoot.png 250w,\n/blog/static/52525f7a291707863825ad97e39b8ba5/0b533/createFiberRoot.png 500w,\n/blog/static/52525f7a291707863825ad97e39b8ba5/00d43/createFiberRoot.png 1000w,\n/blog/static/52525f7a291707863825ad97e39b8ba5/05fb0/createFiberRoot.png 1138w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>ReactDOM.render()调用过程中的数据结构</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/14dbf1020c707361e3ce32d83f6c0dd5/f058b/renderStruct.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.999999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABIUlEQVQY032RXUvCcBjF95WDboIKyVCq267Eu6CQzMILTSovhLoLUpmpaep82XTa3KZD5/b/RYkVIh04nIcDzwvnkYQQrNMXPl+w50NS3RDJ1gHxyv633mphekaNXldF10bk9RTxcoBLOUBhmEbiH9jukIx2RLIVJCbvkWwuB+oThYXr4S+gbGZJd45Jt08oje+QPOb8UMzxhYdhGKiqSqfbRhlUsRZ9bG+A6fYZz1Q83/1dak7RtQ9MY8LUmiFdVw5JvAa5qYSIybtUjScc28W0xjiOgzvzNl6/iqeu5SkqOWr6M03jBemhEeH+PUK2GSVTP0Wx8hua/TWKpe8LHkdRLt62OC9tE2/sbM5w/Ul/vVW90lzzjFghwFUxREIO8wk517n0JFsJLQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"reactStruct\"\n        title=\"reactStruct\"\n        src=\"/blog/static/14dbf1020c707361e3ce32d83f6c0dd5/f058b/renderStruct.png\"\n        srcset=\"/blog/static/14dbf1020c707361e3ce32d83f6c0dd5/63868/renderStruct.png 250w,\n/blog/static/14dbf1020c707361e3ce32d83f6c0dd5/0b533/renderStruct.png 500w,\n/blog/static/14dbf1020c707361e3ce32d83f6c0dd5/f058b/renderStruct.png 630w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n通过启动最开始create-react-app创建的项目,可以看到以下的输出.<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/8bea5b913ac20f4f3d728869ac3041fd/2c0d3/showRenderStruct.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAmElEQVQY05XQywqDMBCFYd//HVvwUk3UxFzEadTmL0oXxVV74IMzMKtT6EYzjJFlEebZ4Zxlmgx2Moi37Gkh55382sj547tfFF3T4l0gycYqK9fkQ/5dcb/dUaqnqhrKskIpzTMlUkrs235+5T8UbdcxjCN13aD7HqU1xhi6h8HaQAiBGCMicjq6954QjpkSMYbznucFkZU3QZw2325BZlsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"showRenderStruct\"\n        title=\"showRenderStruct\"\n        src=\"/blog/static/8bea5b913ac20f4f3d728869ac3041fd/00d43/showRenderStruct.png\"\n        srcset=\"/blog/static/8bea5b913ac20f4f3d728869ac3041fd/63868/showRenderStruct.png 250w,\n/blog/static/8bea5b913ac20f4f3d728869ac3041fd/0b533/showRenderStruct.png 500w,\n/blog/static/8bea5b913ac20f4f3d728869ac3041fd/00d43/showRenderStruct.png 1000w,\n/blog/static/8bea5b913ac20f4f3d728869ac3041fd/aa440/showRenderStruct.png 1500w,\n/blog/static/8bea5b913ac20f4f3d728869ac3041fd/2c0d3/showRenderStruct.png 1849w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>后记</h2>\n<p>这篇文章只梳理了React在实际调用渲染函数之前的函数调用和数据结构.在这个过程中终于盼来了千呼万唤的fiber.之后的文章会继续深入react的渲染流程和fiber的实现来对react进行学习.</p>","fields":{"readingTime":{"text":"4 min read"}},"frontmatter":{"title":"React render流程梳理","date":"2019-05-10","tags":"React","path":"/react-render","top":null,"summary":null}}},{"node":{"id":"912d5b0a-962a-594b-b556-032a8ee38a39","html":"<h2>前言</h2>\n<p>在react最新的reconciliation使用的是Fiber架构.Fiber使用的增量渲染的模式,具体的实现是渲染的任务可以被拆分,在页面更新的时候具体的任务可以被打断,复用.这些特性无疑对页面交互是有很大的提升.下面通过React Fiber Architecture这篇文章来对Fiber有个大体的认识.之后的系列我会深入react的源码来仔细学习Fiber的具体实现.</p>\n<h2>基础知识</h2>\n<h3>What is reconciliation?</h3>\n<h4>reconciliation</h4>\n<p>react通过Virtual Dom和真实Dom之间建立缓冲,通过diff出变化前后virtual Dom的差异来将差异更新到真实Dom上.reconciliation正是对比Virtual Dom差异的实现.</p>\n<h4>update(更新)</h4>\n<p>渲染页面的数据发生变化导致页面更新</p>\n<p>在没有reconciliation(调和)的情况下,数据的变动将会导致整个页面重新绘制.通过Virtual Dom来代表将要渲染的页面,将Virtual Dom交给对应的renderer(react-dom, react native)来进行页面的绘制.在页面更新的时候通过调和来生成前后Virtual Dom树的差异来进行页面的更新.这样一定程度上提高了页面的性能.React的更新策略是在下面的假设下进行的:</p>\n<ol>\n<li>组件很少进行跨层级的移动</li>\n<li>不同类型的组件生成的结构是不同的</li>\n<li>相同类型的列表元素可以通过唯一的标识来进行复用</li>\n</ol>\n<h3>Scheduling(调度)</h3>\n<h4>scheduling</h4>\n<p>确定哪些更新的任务需要执行</p>\n<h4>work(更新任务)</h4>\n<p>需要执行的任务,通常是页面的更新\nReact的构建UI的库,它采取pull(拉)的模式来处理页面的更新交互.在push(推)的模式中数据(更新)推动整个页面的更新.React对更新的任务进行了一定的调度,来达到更好的页面交互.React采用这种策略主要有以下的原因:</p>\n<ol>\n<li>在处理UI界面的时候,通常上不是所有的更新都需要立刻被执行的.(可以类比图片的懒加载)</li>\n<li>不同的类型更新应该有优先级.为了更好的交互体验,通过优先级可以提供更好的页面交互.(比如动画的优先级更高,页面会更加流畅)</li>\n<li>push的模式需要开发者组织页面的更新,pull的模式使得React可以帮助开发者实现更好的页面交互.</li>\n</ol>\n<h2>what is Fiber?</h2>\n<p>通过Fiber使得React可以更好的调度任务.主要有以下的功能:</p>\n<ol>\n<li>暂停任务并且在之后继续执行</li>\n<li>对不同的任务设置优先级</li>\n<li>复用之前完成的任务的结果</li>\n<li>丢弃不需要的任务</li>\n</ol>\n<p>在这里可以简单的将fiber理解为需要做的任务.在进行页面绘制的时候组件更新和函数执行的任务都会被推进执行的栈结构.这种模式当太多任务需要执行的时候会导致页面的交互变的卡顿.浏览器提供了两个api来处理上面的问题.</p>\n<ol>\n<li>requestIdleCallback 通过requestIdleCallback可以在空闲的时候执行一个低优先级的任务</li>\n<li>requestAnimationFrame 可以在浏览器下次重绘之前执行一个较高优先级的任务</li>\n</ol>\n<p>为了利用上面的函数来实现页面的更新,就需要将渲染的任务拆分成多个任务.Fiber架构可以理解为重新实现的栈而fiber节点是一个虚拟的栈帧.Fiber架构通过调度帧的执行逻辑来完成页面的更新.</p>\n<h3>fiber结构</h3>\n<p>一个fiber节点代表一个栈帧,也代表一个组件的实例.下面是fiber结构一些重要的属性:</p>\n<h4>type  key</h4>\n<p>type和key对于fiber节点的作用跟type和key对React element的作用一致. type可以判断fiber节点对应的是React组件还是宿主环境的组件(div).key用于调和的时候复用fiber.</p>\n<h4>child sibling  return</h4>\n<p>fiber是通过单链表进行关联的.fiber节点的return指向它的parent.child指向fiber第一个子节点.sibling指向当前fiber节点的兄弟节点.</p>\n<pre><code>function Parent() {\n  return [&#x3C;Child1 />, &#x3C;Child2 />]\n}\n</code></pre>\n<p>上面的结构Child1是Parent的child,Child2是Child1的sibling,Parent是Child1和Child2的return.</p>\n<h4>pendingWorkPriority</h4>\n<p>优先级</p>\n<h3>alternate</h3>\n<p>一个组件至多有两个fiber结构与它对应: 当前的fiber(正在处理的fiber),flushed fiber(处理完毕,准备渲染(commit)的fiber), alternate(当前fiber的替身).</p>\n<h2>参考</h2>\n<p><a href=\"https://github.com/acdlite/react-fiber-architecture\">React Fiber Architecture</a>\n<a href=\"http://www.ayqy.net/blog/dive-into-react-fiber/\">完全理解React Fiber</a></p>","fields":{"readingTime":{"text":"6 min read"}},"frontmatter":{"title":"React Fiber Architecture(译)","date":"2019-05-09","tags":"React","path":"/react-fiber","top":null,"summary":null}}}],"pathPrefix":"","first":false,"last":false,"index":11,"pageCount":15,"additionalContext":{"pageAllCount":88}}},"staticQueryHashes":[]}