{"componentChunkName":"component---src-templates-post-js","path":"/android-broadcast","result":{"data":{"markdownRemark":{"html":"<p>广播是安卓内的消息通知机制，通过接收广播消息应用能收到系统级的消息通知/其他应用的消息通知。</p>\n<h2>接收广播</h2>\n<h3>声明接收器</h3>\n<p>声明接收器是通过在AndroidManifest.xml中声明广播的方式来实现广播的注册。这种方式在应用级别26以上不再支持。实现方式如下:</p>\n<h3>创建broadcast receiver</h3>\n<pre><code>public class MyBroadCast extends BroadcastReceiver {\n// 创建MyBroadCast 实现onReceive \n// 当接收到广播时 会调用onReceive\n    @Override\n    public void onReceive(Context context, Intent intent) {\n        Toast.makeText(context, \"receive broadcast\", Toast.LENGTH_SHORT).show();\n    }\n}\n</code></pre>\n<h4>在Manifest中定义receiver</h4>\n<pre><code>// 定义receiver\n&#x3C;receiver android:name=\".MyBroadCast\" android:exported=\"true\" android:enabled=\"true\" >\n    &#x3C;intent-filter>\n        &#x3C;action android:name=\"android.intent.action.BOOT_COMPLETED\" />\n    &#x3C;/intent-filter>\n&#x3C;/receiver>\n// 权限声明\n&#x3C;uses-permission android:name=\"android.permission.RECEIVE_BOOT_COMPLETED\" />\n</code></pre>\n<h3>上下文注册接收器</h3>\n<h3>创建broadcast receiver</h3>\n<p>同声明接收器创建方式</p>\n<h3>在活动中注册broadcast receiver</h3>\n<pre><code>public class MainActivity extends AppCompatActivity {\n    private MyBroadCast myBroadCast;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        // 创建广播接收器\n        myBroadCast = new MyBroadCast();\n        IntentFilter intentFilter = new IntentFilter();\n        // 监听网络变化\n        intentFilter.addAction(\"android.net.conn.CONNECTIVITY_CHANGE\");\n        // 注册广播接收器\n        registerReceiver(myBroadCast, intentFilter);\n    }\n\n    @Override\n    protected void onDestroy() {\n      //销毁监听\n      super.onDestroy();\n      unregisterReceiver(myBroadCast);\n    }\n}\n</code></pre>\n<p><img src=\"/blog/fa68f00702cb8da7b73fbba300e8fe32/showBroadCast.gif\" alt=\"接收广播\"></p>\n<h2>发送广播</h2>\n<p>Android提供以下三种方式发送广播:</p>\n<ul>\n<li><a href=\"https://developer.android.com/reference/android/content/Context#sendOrderedBroadcast(android.content.Intent,%20java.lang.String)\">sendOrderedBroadcast(Intent, String)</a> 发送顺序广播，接收器顺序执行可以向下传递结果也可以中止广播。具有相同优先级的接收器按随机顺序运行。</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 978px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/ac9f04546701d76768ab99cd9448a116/614df/orderedBroadCast.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3YFB/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAGBAAAwEBAAAAAAAAAAAAAAAAAAERITH/2gAIAQEAAT8hdI700//aAAwDAQACAAMAAAAQ8A//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAEAAgMBAAAAAAAAAAAAAAABABEhUaHh/9oACAEBAAE/EKDDyFl8Qdp//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"顺序广播\"\n        title=\"顺序广播\"\n        src=\"/blog/static/ac9f04546701d76768ab99cd9448a116/614df/orderedBroadCast.jpg\"\n        srcset=\"/blog/static/ac9f04546701d76768ab99cd9448a116/0479a/orderedBroadCast.jpg 250w,\n/blog/static/ac9f04546701d76768ab99cd9448a116/41099/orderedBroadCast.jpg 500w,\n/blog/static/ac9f04546701d76768ab99cd9448a116/614df/orderedBroadCast.jpg 978w\"\n        sizes=\"(max-width: 978px) 100vw, 978px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li><a href=\"https://developer.android.com/reference/android/content/Context#sendBroadcast(android.content.Intent)\">sendBroadcast(Intent)</a> 发送常规广播，会按照随机顺序向所有广播接收器发送广播，无法从其他接收器中获取传递结果和中止广播。</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 766px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/e518738eb7cc766faf4e21990f038705/d8ebd/normalBroadCast.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAd6aQgD/xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAEFAl//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAZEAACAwEAAAAAAAAAAAAAAAAAARAxQXH/2gAIAQEAAT8hHtih9Ef/2gAMAwEAAgADAAAAEHDP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBABAAIBBQAAAAAAAAAAAAAAAQARMRBRYYGR/9oACAEBAAE/EL4fIlMHUTu6BpSksmWf/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"普通广播\"\n        title=\"普通广播\"\n        src=\"/blog/static/e518738eb7cc766faf4e21990f038705/d8ebd/normalBroadCast.jpg\"\n        srcset=\"/blog/static/e518738eb7cc766faf4e21990f038705/0479a/normalBroadCast.jpg 250w,\n/blog/static/e518738eb7cc766faf4e21990f038705/41099/normalBroadCast.jpg 500w,\n/blog/static/e518738eb7cc766faf4e21990f038705/d8ebd/normalBroadCast.jpg 766w\"\n        sizes=\"(max-width: 766px) 100vw, 766px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li><a href=\"https://developer.android.com/reference/androidx/localbroadcastmanager/content/LocalBroadcastManager#sendBroadcast(android.content.Intent)\">LocalBroadcastManager.sendBroadcast</a> 本地广播，在无需跨应用广播时使用。</li>\n</ul>\n<p>下面发送本地广播的实现方式:</p>\n<pre><code>public class MainActivity extends AppCompatActivity {\n    private MyBroadCast myBroadCast;\n    private String actionName = \"com.example.broadcast.MainActivity.SHOW_TOAST\";\n    private LocalBroadcastManager localBroadcastManager;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        // 获取LocalBroadcastManager 实例\n        localBroadcastManager = LocalBroadcastManager.getInstance(this);\n        Button button = (Button) findViewById(R.id.broadcast);\n        button.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                // 发送广播\n                Intent intent = new Intent(actionName);\n                localBroadcastManager.sendBroadcast(intent);\n            }\n        });\n        myBroadCast = new MyBroadCast();\n        IntentFilter intentFilter = new IntentFilter();\n        intentFilter.addAction(actionName);\n        // 注册接收特定类型的广播\n        localBroadcastManager.registerReceiver(myBroadCast, intentFilter);\n    }\n\n    @Override\n    protected void onDestroy() {\n        super.onDestroy();\n        // 销毁广播\n        localBroadcastManager.unregisterReceiver(myBroadCast);\n    }\n}\n</code></pre>","frontmatter":{"date":"2021-06-25","path":"/android-broadcast","title":"一起学Android-广播"}}},"pageContext":{"readingTime":"3 min read"}},"staticQueryHashes":[]}