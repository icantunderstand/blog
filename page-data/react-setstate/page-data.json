{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/react-setstate",
    "result": {"data":{"markdownRemark":{"html":"<p>在使用React进行业务开发的时候setState可以对组件的数据进行更新并且触发页面的渲染.本文从源码角度梳理在调用setState的相关处理逻辑.</p>\n<h2>前置知识</h2>\n<h3>React多平台渲染</h3>\n<p>React在设计上使用了依赖注入的方式,通过注入不同平台的渲染renderer来实现多平台的渲染能力.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/9bca1c5b0e82f7200da7c0c3d9f20d54/5c744/reactRenderer.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 85.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAABg0lEQVQ4y5WUiXKDMAxE+f/fZLivHBBu3HmiSyCFdsrMxrItrVeyHG+aZjdNk2EYhg37ed/3bhhGWxvH8Xv+9tvD42dZFvd8Pl1RFO5+v9tYlqWhqip3u91cnucWwBwbvziOjXSeZ8OBEIfH4+GCILAAwDxNU5ckiZGiTERRFNmeCDeFTCB8vV7mjBMq6ro21aiUcvyaprG1LEttpAQHhTK0qJRQByFqAAegEmL2sed5+VnDvVzZpNZ1nQX5vm/AZo09sBexjz0QrlhLQG1QI3IUY7O3J7pU+Jm6LqBtWwM2xErzLO5C4Tt9LoBLAthXvr8qlI0qLkKE2HQCKf9LIW1AEJdAW1A72Yzs4fOnQp1CAB+K9EoYAW3Eh8+VUk9kfKQEAYHquTAMDdgiZY8D+U4VkgKOPDs9M/UhTwxg00qUgEbHl0NOXwqOWZYZKQEokVrmSp/gtQSl+XL46VtmkaJD0rYrkd72utZuhPoTYY03fvpvA1CBM8DG4WxNTQ4p+KzhFxiCKgcyB0LkAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"react renderer\"\n        title=\"react renderer\"\n        src=\"/blog/static/9bca1c5b0e82f7200da7c0c3d9f20d54/00d43/reactRenderer.png\"\n        srcset=\"/blog/static/9bca1c5b0e82f7200da7c0c3d9f20d54/63868/reactRenderer.png 250w,\n/blog/static/9bca1c5b0e82f7200da7c0c3d9f20d54/0b533/reactRenderer.png 500w,\n/blog/static/9bca1c5b0e82f7200da7c0c3d9f20d54/00d43/reactRenderer.png 1000w,\n/blog/static/9bca1c5b0e82f7200da7c0c3d9f20d54/5c744/reactRenderer.png 1206w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n在创建组件实例的时候,React会注入不同平台renderer最后结合react-reconciler来实现组件的渲染更新.</p>\n<h3>事件循环</h3>\n<p><a href=\"https://icantunderstand.cn/event-loop\">事件循环</a></p>\n<h3>lane</h3>\n<p>在react新的架构中定义了lane的概念.lane用于控制不同任务的更新优先级处理逻辑,具体可以参考<a href=\"https://react.iamkasong.com/concurrent/lane.html\">lane模型</a></p>\n<h2>源码梳理</h2>\n<p>基于React的多平台渲染架构,在梳理setState源码是从以下两个方面进行的:</p>\n<ul>\n<li>注入渲染renderer(setState从哪里来)</li>\n<li>发起调用(setState做了什么)</li>\n</ul>\n<h3>注入渲染renderer</h3>\n<p>在<a href=\"https://icantunderstand.cn/react-render-interpretation\">图说React渲染流程</a>中,React会根据当前的页面结构创建workInProgress树,注入renderer的逻辑就在创建组件实例的过程中.\n在创建<a href=\"https://github.com/facebook/react/blob/a423a01223785a8bc4dcd55f2a0288200b033eee/packages/react-reconciler/src/ReactFiberBeginWork.new.js#L943\">类组件</a>的时候,会执行constructClassInstance创建组件的实例.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 724px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 82.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACeUlEQVQ4y42T247bNhRF/RuxRPFOUferZXuMMdpBmiAPyUOemqekLfr/n7AKyc5MGwRNHjb2JiQungMe7jIpcc1IHE8My8BwHJhOE93cEnNPlmUIITb/Ge0yISjHhf76muZ4oTssNEOLizn7V/vnH38WuhNpSnv5lfOH3xmuT9SPJ6R3rAet1X+74UfgnVGKEAtsHrEh39r0uSdNEtJkf/eEZP8KIdIfQnd6DcYhpEasrh3GOlxR4coamxe4WJK3A9qY/4Wt33ZZJvD1RPnwRPP2I9Nv76mmI7GfyOv2BiyqO9A+A1f/Xt5JKQnaUtQ9+eFC1fX4siXUPVYrkue2999t+VvwBtRao60i1B5fO0LrCN0t+8ZiosGVFl9bXGXw7S2bqHGlIR89tjT/AhqNcpJ8tITeEjpLPjri7MmHFe6Io6dYAnEKFHPYgF8PWGFrESbolwp9WVEtR8pxpDwsxK7F1S3aWZRRKCNRWm6+tZekiESQJinp5uKlQrUCu57q4bKpXBbifKA6n3BNjS4qpFVkViFWaNBIpzatWTmFdur+UjJJNIa+rpkPh01D1zLPM0NbUg3TdutVDESTEbWkcOse+ZztWr29A7XMaNYqjcZ4g3Gr6829TIk2JTerBEHdsxbkKiUYQakzYpKSiK+DbQQHnfLpMeXzk+DLG8Uf7wyfnwxd3+D7kdB2+KrePO8HbFHgm47Q9eTeUayjIyXy9pYF5+j46+3C3+/O/Pl65MsvHZ+uE9fjA+fjI6dx4TguXE5XjsNhy+fDA8dh5tSODN2IzfNtTrdLKaqGUM2E/oQdz6hmQsYWFSJaydtwp8lda05f1iL9z0v5Bw9BzFQeJzKMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"constructClassInstance\"\n        title=\"constructClassInstance\"\n        src=\"/blog/static/497d1ecebae05943263e87a1e98aa231/a242d/constructor.png\"\n        srcset=\"/blog/static/497d1ecebae05943263e87a1e98aa231/63868/constructor.png 250w,\n/blog/static/497d1ecebae05943263e87a1e98aa231/0b533/constructor.png 500w,\n/blog/static/497d1ecebae05943263e87a1e98aa231/a242d/constructor.png 724w\"\n        sizes=\"(max-width: 724px) 100vw, 724px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n在<a href=\"https://github.com/facebook/react/blob/a423a01223785a8bc4dcd55f2a0288200b033eee/packages/react-reconciler/src/ReactFiberClassComponent.new.js#L591\">constructClassInstance</a>中主要做了如下两件事:</p>\n<ol>\n<li>执行构造函数,创建组件实例</li>\n<li>注入组件更新逻辑实现</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 642px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/1432b8761f07738688fa565358af68b7/1bba8/executeConstruct.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.800000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpUlEQVQoz42S7W7bIBhGexmrbcAuBvwBCeQ7Wbt0bZJqSqPe/9WcyY4qdVun7ccR/Do878N7I8qKqkuUbeTb84GXyxvH1wuny4XT6ys/3t6YpkSe50gp/8mNEAK/vid8fWR5OrM9nFk87Nken4mLFSHOqI1BFMX/CYs8x853uLSiWyaElGRfbsmzbCTLbin+kAmE+IuwLEtsSkzuN/QTizaKUiuqWo6phgdHipwiy8ZTfCIaJh2FsqywXUeTeuwq4jYzmnlPs5yimxbbB0zn0dZh/ITaOqQQo+Aj79IbKQp03KH8EjVdU0+X+Pkav30i7k8sD2dm+yPx8cT8cGb+/QXjGpRSSFVe+SWhlNzVNXVao3dHms2e+PBEWm9RztP1ntpPKeMG7RPtfI1rW0wXKP2Cqk/I8u6adBAqJamqikpr9GyLmSSUtlTGXTsbyDPE0N3AeC+uid75+CmyLAixI20Ci8fI7jCj7wzWOayfXukDd8aibEvVTdC1uQqGsaX6TSglIXQE39C3lq51hNDQeI8NEesnuBDRQ2+uo+oj2phxdT5bm59BfiES78o9rwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"执行构造函数\"\n        title=\"执行构造函数\"\n        src=\"/blog/static/1432b8761f07738688fa565358af68b7/1bba8/executeConstruct.png\"\n        srcset=\"/blog/static/1432b8761f07738688fa565358af68b7/63868/executeConstruct.png 250w,\n/blog/static/1432b8761f07738688fa565358af68b7/0b533/executeConstruct.png 500w,\n/blog/static/1432b8761f07738688fa565358af68b7/1bba8/executeConstruct.png 642w\"\n        sizes=\"(max-width: 642px) 100vw, 642px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>在<a href=\"https://github.com/facebook/react/blob/a423a01223785a8bc4dcd55f2a0288200b033eee/packages/react-reconciler/src/ReactFiberClassComponent.new.js#L581\">adoptClassInstance</a>中在实例上注入了updater实现了组件的更新注入能力.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 758px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.800000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABRElEQVQoz1WR0XKbMBBF/R1FQkICIYSREGC3rk3cpk3+/49OB+xk0oczV/tyZnX3UBqLDok29ixLT54C849Imnt8ytRpweUzNgzUsacOnjZO+HGmOQaabZ4idVMjheCgjcLnkeHnzHDOhCVzunT8XQO3qeeaPesycB4ctTHYqkLpB6aqMFrTGINSirIsOWitidcX8u838usbw3VleVn59f7K5XZi/XPndr+QBocyCmXVntsi2j5Qz5RSPoRp9KSpI06Bboy0OWGPAZdHmjHjUkQbidLiM1UlqRq9Y565C1VZEodEvL9z/H6jn057R12a8TsTTddThYRqjw/8gHYdUsj/2L9srcE2DuM8la0xrsW2Htt2O9ust47agHLdk4Bu2l3wlX1DY7dCS0Txbb+SEAWi+IIokFIgiwIpnny8pfwUfUj/AfXDysLcW3bxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"注入updater\"\n        title=\"注入updater\"\n        src=\"/blog/static/0ec8d69c0ef510e14f1fdd507ed5c0af/c8e86/adoptClass.png\"\n        srcset=\"/blog/static/0ec8d69c0ef510e14f1fdd507ed5c0af/63868/adoptClass.png 250w,\n/blog/static/0ec8d69c0ef510e14f1fdd507ed5c0af/0b533/adoptClass.png 500w,\n/blog/static/0ec8d69c0ef510e14f1fdd507ed5c0af/c8e86/adoptClass.png 758w\"\n        sizes=\"(max-width: 758px) 100vw, 758px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3>发起调用</h3>\n<p>在组件的实例化过程中,注入了提供更新能力的updater.调用的逻辑其实就是梳理对应的updater如何触发页面的更新.通常调用setState是如下的方式:</p>\n<pre><code>this.setState({  })\n</code></pre>\n<p>setState是挂载在组件实例上的方法,在创建类组件的时候会调用React<a href=\"https://github.com/facebook/react/blob/a423a01223785a8bc4dcd55f2a0288200b033eee/packages/react/src/ReactBaseClasses.js#L20\">类组件的构造函数</a>来初始化实例.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 723px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.599999999999994%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB70lEQVQoz22S6XLbMAyE/R6WRPDWQdm6bCdO4jTt9P0f6euI8tiTtj92FiAxywXAnU8G7RXaCcYLJghiq4z13ER5xGIl19nWZC7LkqqqvmFnmog4iwoGaRwSLMp5bAz41GLrQOgTfq0zCqW3x1f+WywLSrcQlxv97Yt4vpCuP7FpxoYG1/RYXxP6CesCVVlR7MsHyuKO8sk7XXfU84nxdiPNR/qXF7plRtvVTYnSFUo2Fre1LFahg87xlm+8OQwB23WENuKnAT2fsdOMbTzaKbTfitcHdJ7xXcjLP3kW1NFRzw3dpcOniO1qXKpxjWO9c31AR4uJDhNtdpZFVsE1rvVDfHPoIr470C5njPPEfiB0B4z1qG5C9SfkeEEOJ0yaUEooi+I5t+L7LHc6Bipn0dZhfMyiJkRMCJm182htENkcVKr673afW+47VLu2mIiHCd/2mdfNNtM55946rDEU+z3Fvrhj/+0fZsfZ4ZgwQ0s8JprlRDMODGPNcawxwaHbhD8OtPNEuyy0y0w99PQvr6RholKKongK72zf071dGH9+Mr2feP0xc/2aef81M1xn4jLRX88cP64cP95I55H5943x80qKgaEJtDGg7iPZxbqhLAXRDlGC0Ru0SM4rpVErxGyoJPN6LqrCrrVaHm3/AZ0jV2qMuOQFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"baseComponent\"\n        title=\"baseComponent\"\n        src=\"/blog/static/2ae56cda731fe7c84a8d82990745f055/c67d4/baseComponent.png\"\n        srcset=\"/blog/static/2ae56cda731fe7c84a8d82990745f055/63868/baseComponent.png 250w,\n/blog/static/2ae56cda731fe7c84a8d82990745f055/0b533/baseComponent.png 500w,\n/blog/static/2ae56cda731fe7c84a8d82990745f055/c67d4/baseComponent.png 723w\"\n        sizes=\"(max-width: 723px) 100vw, 723px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span><br>\n在调用setState的时候其实是调用注入的updater(classComponentUpdater)的enqueueSetState逻辑来实现页面的渲染更新.\n在classComponentUpdater中主要做了:</p>\n<ol>\n<li>创建update 形成update的链表结构(updateQueue) 在更新阶段会依次处理链表的update</li>\n<li>通过scheduleUpdateOnFiber触发更新</li>\n</ol>\n<p>在<a href=\"https://github.com/facebook/react/blob/a423a01223785a8bc4dcd55f2a0288200b033eee/packages/react-reconciler/src/ReactFiberWorkLoop.new.js#L456\">scheduleUpdateOnFiber</a>中获取到根节点通过ensureRootIsScheduled发起根节点更新调度.</p>\n<p><a href=\"https://github.com/facebook/react/blob/a423a01223785a8bc4dcd55f2a0288200b033eee/packages/react-reconciler/src/ReactFiberWorkLoop.new.js#L632\">ensureRootIsScheduled</a>的功能是在根节点上调度任务的执行,主要功能如下:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 759px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 125.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD+klEQVQ4y32V2W7cRhRE9RnJDMneSPbG5q7ZR5a8JDYMBHnK///JCUhNZFm281DongFYqMuqW7yTpUWFhBsb5nPL7tJzfNdxOiWGNmBjom4CfmwxtsbUjtIFSudwfcJ6hxCCPM8py4o7qRTaR6phpAiR3Do+7Cv+Piq+ToJKFWSbLWK7Jc8ysmxLtty3W4rbfwtZURTreSeKgjokmvmAdR7fz/huIkx7bOqpfMSNO2w/44Z7/LRfT9dPGB9R3Q5Z+5V4Ib0rhUS7BlEHZDOg2hnZjAiXqKyl7TxDH+m6Z6Q2UlbVi6r/sPzOF0IlBFUcMNMFffiAuXzGnP5A799TT0fSOJGuT7SPn1akyyNxmF4UrUSvR1Y2YJQknhLtx5F46fCHlnBu6Z5a4j5g+kg1J6oxUo0BZfRPFa4jS2MwStNYjykleb4hz7cImaNKgVBiNeA7vCF7jTtVLlEocb3DthbbLXGwGK/INhn5ZkOe3dxcHf025s+wxsb6RHr6RPr4hf7zX8SHpzV7dVxcnFFpRDWL4x6pnlULuaCgEMV6rvdVofVIUSCtRjclJpXoaKiHGjtZ7D5Qzw6789jRop1c1RsvkZXAOPWMoJFacCetR2vJcIpMDw3jNTJeIuO1YbhEpmvD/JiYHhLd3uM6T9Va4j7hR7eSLypfTFnWpi5Ldqc9+w+PzA8Xdo8PzOcTqfU0raNJjhBqQqiwwSPLmirc8ljkb1yWEikkLtR0UyQuBL0nNJZmUdLWpM4RfI3Wmu1qUsZ2s6xg9mMOl5drTMn9MDDdt4RUEzuHjZbQOkLniL2nGQJlXa4PSvlsirxBiDcKlZI0yTLMka539FNEDztUN6LHe9QwI1NH4RqcqxiHQNt6hiEyz4kY3Zt3aD2u6akXdBOq8hTGkmX5OlaWCwqpKJRekQtJIeVKkv3QNkIQm477658MT19JX/7BXz4xvv9Id76yO0w093tEM6LStEKEltI3yKUHfzBFCJZwh8OZ4fE9/fWR8XplPB0Zjgd8ainrmrKqKdaN2VLctubtHt9Mkdi6JpYaq3NqnWFNQaUFlZFIbSiUQVf1bcQbbvfXZDdTBNYuJXpFzVfk/IDoj4g0U/iesirpF5cbS9cHpqmh7+OazSWny/Ovy2IdecnX8l1RsUc3A9I16NoilURptaZgjYl4HZVnvFb34nJZW+LhgXh8t56uG5iOO/oh0XUe758dz4ufN813Iy+ExhjaeWa+nOl2M/1+x/3lxDT3a95i1yIrj2uHdZpfletz22iDMRqpljz9Rp7/TlFsEGLBUqibb7j1YVHkvyzZO2mqtffSeSad98TDTNwNuClR7eb1wyVDh/QJqfT/tvVC+C8D+9HyjMLmcwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ensureRootIsScheduled\"\n        title=\"ensureRootIsScheduled\"\n        src=\"/blog/static/df31f836b5cc428cf2864f9bdd7254d1/ef3e1/ensureRootIsScheduled.png\"\n        srcset=\"/blog/static/df31f836b5cc428cf2864f9bdd7254d1/63868/ensureRootIsScheduled.png 250w,\n/blog/static/df31f836b5cc428cf2864f9bdd7254d1/0b533/ensureRootIsScheduled.png 500w,\n/blog/static/df31f836b5cc428cf2864f9bdd7254d1/ef3e1/ensureRootIsScheduled.png 759w\"\n        sizes=\"(max-width: 759px) 100vw, 759px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>根据当前任务获取优先级通过Scheduler发起不同优先级的任务调度</li>\n<li>同优先级任务合并,不发起新的任务调度</li>\n</ul>\n<p>setState是SyncLanePriority优先级,在调度上就会通过微任务发起调度逻辑等主代码块执行完毕后开启微任务执行(调度更新)</p>\n<h3>图解setState更新逻辑</h3>\n<p>假设我们在这样一个场景中在一个函数中连续调用的两次setState</p>\n<pre><code>this.setState({  })\nthis.setState({  })\n</code></pre>\n<h4>第一次调用</h4>\n<p>在第一次调用setState的时候在fiber的根节点上创建了updateQueue添加此次的更新内容,通过微任务发起调度.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/00a176694c87a68e767f39aea74c21fa/61016/setStateFirst.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/0lEQVQoz41S266EIAz0/3/TC8YLRBBBFLuZrt24J+6efZhAUzqdTin2fadt2xg5ZzqO4wXkBMjdvc3InXmgWJaFjDGktebTe89A3LYtNU3DMYpTSvzGWkvDMJC3lqwxNGlNKYQnYQiBi7uuo3meuQgAyTiO1Pf9G+E0TeScY9I1BPLOMVKMT8IYIxdCDch5jHMcxFAk4wLSkG242CNveGQoxAhQKF6gkVIt1XXNisRTyV/9vaK4Gi1mA+u6sjqoR9NvJG+EQnDtLKcsDI1+IXspvPse1jpegFgRzi1+J8yfCZVSVFUVlWXJd5D+/ZsfFOZbQiwCJADu8fwW/yl8AGbIDaEzSvt9AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"setStateFirst\"\n        title=\"setStateFirst\"\n        src=\"/blog/static/00a176694c87a68e767f39aea74c21fa/00d43/setStateFirst.png\"\n        srcset=\"/blog/static/00a176694c87a68e767f39aea74c21fa/63868/setStateFirst.png 250w,\n/blog/static/00a176694c87a68e767f39aea74c21fa/0b533/setStateFirst.png 500w,\n/blog/static/00a176694c87a68e767f39aea74c21fa/00d43/setStateFirst.png 1000w,\n/blog/static/00a176694c87a68e767f39aea74c21fa/aa440/setStateFirst.png 1500w,\n/blog/static/00a176694c87a68e767f39aea74c21fa/61016/setStateFirst.png 1770w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h4>第二次调用</h4>\n<p>第二次调用setState获取的更新优先级跟之前任务一致,这次只进行updateQueue逻辑增加任务的操作<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/76f16d8aefefa3d39948c2f406cdc6cb/b6e50/setStateSecond.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.39999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABUElEQVQ4y5VTa6+CMAzl//9BEz8J4SWMMQGBjY3enGrRq3gfS5qWPk572hB578laS/M8k3OOQgi0ritrax3Lsiz8DY08iNRAIyYSAdC0LSmlqO97diKx6zrK85yyLKNhGLiJ1ppzLpcLlWVJ1+uV6xCHfxzHG2DbtreEYWBAYwwnAaCua26A6WAjhnzEqqpiIMTADjryIWyAmGqaJu6Mh46IoSkEMfggYsP/TtkY7giNRNlVmqaUJAlPIXsVHcLKtjQTibwPW+JKtBUAFA2wI1n8a/G7BIok0eJ6dwoQPAABFO93sCdAZy1VZUlFlpFWineI/RRFQefzme09ej8CAqhRNRmt+WJN0/AO87xg+5Xy3jcfRQK8wyfBDkEZx4J+BfkIuDc6T+0cnU4nOhwO/6B8v/InwDiO6Xg8MuDfruwflB80wlYMUPkDxPddhzfKX/ab9wsUR/UWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"setStateSecond\"\n        title=\"setStateSecond\"\n        src=\"/blog/static/76f16d8aefefa3d39948c2f406cdc6cb/00d43/setStateSecond.png\"\n        srcset=\"/blog/static/76f16d8aefefa3d39948c2f406cdc6cb/63868/setStateSecond.png 250w,\n/blog/static/76f16d8aefefa3d39948c2f406cdc6cb/0b533/setStateSecond.png 500w,\n/blog/static/76f16d8aefefa3d39948c2f406cdc6cb/00d43/setStateSecond.png 1000w,\n/blog/static/76f16d8aefefa3d39948c2f406cdc6cb/aa440/setStateSecond.png 1500w,\n/blog/static/76f16d8aefefa3d39948c2f406cdc6cb/b6e50/setStateSecond.png 1862w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h4>更新任务执行</h4>\n<p>微任务执行,开启更新逻辑</p>","frontmatter":{"date":"2021-04-01","path":"/react-setstate","title":"setState源码分析"}}},"pageContext":{"readingTime":"5 min read"}},
    "staticQueryHashes": ["256249292"]}