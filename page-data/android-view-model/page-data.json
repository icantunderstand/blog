{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/android-view-model",
    "result": {"data":{"markdownRemark":{"html":"<p>在前端页面开发中，通常会将数据层和UI层进行隔离，这样能更好的做到职责的分离。在安卓开发中ViewModel可以实现UI的数据管理能力，结合LiveData的观察通知能力可以做到页面与数据视图的更新绑定，更有效的组织页面逻辑。</p>\n<h2>ViewModel</h2>\n<p>View能有效的做到视图和数据的分离，数据共享能力。\n<img src=\"./androidStatic/androidViewModel/viewmodel.png\" alt=\"ViewModel作用\"></p>\n<h3>ViewModel生命周期</h3>\n<p>ViewModel对象存在的时间范围是获取ViewModel时传递给ViewModelProvider的生命周期。ViewModel将一直留在内存中，直到限定其存在时间范围的Lifecycle永久消失：对于Activity，是在Activity完成时；而对于 Fragment，是在 Fragment 分离时。\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 522px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/a16d8eb6c5388ad144fb59e3930274eb/29492/cycle.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 104%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACkklEQVQ4y6WU208TQRTG+a99Uh/UGH3VaIgvPvkEGMGAPICXekVDsS3UloJZe9n7dtu9X2Z+ZhdbDdZC4yYnZ2Zy5ttz+b5ZklLmUkpx3sTECymyXIg8F6UXM2J/WREcLxUL/vObYEgpkylglmXSNE05GAxK3x8M5Nh1ZK3ry+WXinz86kQ+evVDtvVIQi6jNJJxFslc5MX9EkMI8RuwKGY8HmPbNqPRCMuyiUOfphpy53mH26tVbm8c0xhEuJHGoXZAU//KKBpOk5wCTjKeVY6XCHYbGk8rh2wf9NDHOXagcjQPsDhJ01SqqoqiKPT7/dLrukaYZHTtgO+qg2J6xBmY/iUAix5aloWmaZimia7r2I6DzGIyt8ew3yZ1FMhjDF+jeRHgv0qWgU3QfEF/b41RbQM8DSMwOFKrNLU5gJNeTk2Isz+MFKLXdxls3sTfuQFGHSOyaZk12lZjAUApygx9R+Pd+iN2Vh7yZu0BTu8Yw9fZa1f4cvIeN3QuByjEWQdOrIRr6wpXV5pcWTlhv5cyDAZsfVjn5f4249hdjDa2n/HsS48nO3VWP/2g56Q4oUbLrM8vuZhyEAQU5HZdF8/ziMKAIBE0ui4fDxWqpxZeDNaENvOGkiSJHA6HdLtd2u12SZ+h65LGIalnEboGiWeCyDB89WLa/Hot/hQ85S4ZE3QqnH7awP22C6GN7uscadVFpXe2laMe4cdltN37jCv3QKtjRQ4tvUbbaODFo9kZFo9DlmVF6aWlSUImQA4VzO1bKBs3MDavk7W2UH2davc9tf4eTmD+W8vFIIredTqdUnq+75PneRFeBE+5+fn0LVv7a2ztr9LS6otJ7y8pznlgL1DKbGP2+WKAk6mfX88C/AlUyUhxrEpdmgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ViewModel生命周期\"\n        title=\"ViewModel生命周期\"\n        src=\"/blog/static/a16d8eb6c5388ad144fb59e3930274eb/29492/cycle.png\"\n        srcset=\"/blog/static/a16d8eb6c5388ad144fb59e3930274eb/63868/cycle.png 250w,\n/blog/static/a16d8eb6c5388ad144fb59e3930274eb/0b533/cycle.png 500w,\n/blog/static/a16d8eb6c5388ad144fb59e3930274eb/29492/cycle.png 522w\"\n        sizes=\"(max-width: 522px) 100vw, 522px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>LiveData</h2>\n<p>LiveData是一种可观察的数据存储类，它具有生命周期感知能力，可以遵循其他应用组件(如Activity、Fragment、Service)的生命周期进行数据的更新通知。使用LiveData有通常有以下的三个步骤:</p>\n<ul>\n<li>在ViewModel中创建LiveData实例保存数据</li>\n<li>创建可以定义OnChange()方法的<a href=\"https://developer.android.com/reference/androidx/lifecycle/Observer?hl=zh-cn\">Observer</a>对象</li>\n<li>在界面控制器中使用<a href=\"https://developer.android.com/reference/androidx/lifecycle/LiveData?hl=zh-cn#observe(android.arch.lifecycle.LifecycleOwner,%0Aandroid.arch.lifecycle.Observer%3CT%3E)\">observe()</a>方法将创建的Observer对象附加到LiveData对象</li>\n</ul>\n<h3>添加依赖</h3>\n<p>使用LiveData需要引入ViewModel</p>\n<pre><code>dependencies {\n    implementation 'androidx.appcompat:appcompat:1.3.0'\n    implementation \"androidx.lifecycle:lifecycle-viewmodel:2.3.1\"\n    implementation 'com.google.android.material:material:1.3.0'\n    implementation 'androidx.constraintlayout:constraintlayout:2.0.4'\n    testImplementation 'junit:junit:4.+'\n    androidTestImplementation 'androidx.test.ext:junit:1.1.2'\n    androidTestImplementation 'androidx.test.espresso:espresso-core:3.3.0'\n}\n</code></pre>\n<h3>在ViewModel中创建LiveData对象</h3>\n<pre><code>public class MyViewModel extends ViewModel {\n    private MutableLiveData&#x3C;String> title;\n    public MutableLiveData&#x3C;String> getTitle() {\n        if (title == null) {\n            // 网络请求、读取文件etc\n            title = new MutableLiveData&#x3C;String>(\"哈哈\");\n        }\n        return title;\n    }\n} \n</code></pre>\n<h3>在界面中使用LiveData数据</h3>\n<pre><code>public class MainActivity extends AppCompatActivity {\n    private MyViewModel myViewModel;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        TextView textView = (TextView) findViewById(R.id.textView);\n        // 获取ViewModel\n        myViewModel = new ViewModelProvider(this).get(MyViewModel.class);\n        // 创建Observer\n        final Observer&#x3C;String> titleObserver = new Observer&#x3C;String>() {\n            @Override\n            public void onChanged(String s) {\n                textView.setText(s);\n            }\n        };\n        myViewModel.getTitle().observe(this, titleObserver);\n        Button button = (Button) findViewById(R.id.button);\n        // 定义button的点击事件 更改ViewModel的数据\n        button.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                myViewModel.getTitle().setValue(\"我变了\");\n            }\n        });\n    }\n}\n</code></pre>\n<p><img src=\"/blog/d9632f4d22fc8dd9b600386ab2ade7dc/showLiveData.gif\" alt=\"使用LiveData\"></p>","frontmatter":{"date":"2021-07-02","path":"/android-view-model","title":"一起学Android-页面数据管理(ViewModel&LiveData)"}}},"pageContext":{"readingTime":"3 min read"}},
    "staticQueryHashes": []}