{"componentChunkName":"component---src-templates-index-js","path":"/12","result":{"pageContext":{"pageAllCount":89,"group":[{"node":{"id":"30a870e5-267a-5478-80ae-3d922926fb74","html":"<p>本文主要对EcmaScript规范中函数对象解读。</p>\n<h2>函数对象</h2>\n<p>函数对象是对外部的词法环境和有一定入参的代码进行封装后的对象.函数对象的调用支持动态的绑定执行环境.在javascript函数执行的时候,实际上是调用当前函数对象的一些内置方法来实现的.下面是函数对象的一些内部实现:</p>\n<table>\n<thead>\n<tr>\n<th>内部实现</th>\n<th>类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>[[Environment]]</td>\n<td>Lexical Environment(词法环境)</td>\n<td>词法环境定义当前函数对象生成时候的外部环境,例如引用的外部变量等</td>\n</tr>\n<tr>\n<td>[[FormalParameters]]</td>\n<td>Parse Node</td>\n<td>定义函数的参数列表</td>\n</tr>\n<tr>\n<td>[[FunctionKind]]</td>\n<td>String</td>\n<td>函数类型(normal, classConstructor, generator, async, async generator)</td>\n</tr>\n<tr>\n<td>[[ECMAScriptCode]]</td>\n<td>Parse Node</td>\n<td>代码体</td>\n</tr>\n<tr>\n<td>[[ConstructorKind]]</td>\n<td>String</td>\n<td>构造类型,当函数通过new操作符进行调用的时候,会用到这个属性.(base derived)</td>\n</tr>\n<tr>\n<td>[[Realm]]</td>\n<td>Realm Record</td>\n<td>当前函数对象的Realm记录,在函数执行的时候需要将函数与Realm进行绑定,由Realm提供全局的环境对象等</td>\n</tr>\n<tr>\n<td>[[ScriptOrModule]]</td>\n<td>Script Record or Module Record</td>\n<td>记录当前函数对象不同创建方式的记录</td>\n</tr>\n<tr>\n<td>[[ThisMode]]</td>\n<td>(lexical, strict, global)</td>\n<td>this会在进入函数的执行环境时进行绑定.lexical代表着this的确定规则是由外部的词法环境决定的(箭头函数),strict代表this是由函数的调用者提供的,global代表着this由外部的全局对象指定(需要区分严格和非严格模式).</td>\n</tr>\n<tr>\n<td>[[Strict]]</td>\n<td>Boolean</td>\n<td>确定当前函数是否是一个在严格模式下执行的函数</td>\n</tr>\n<tr>\n<td>[[IsClassConstructor]]</td>\n<td>Boolean</td>\n<td>是否是构造函数，如果是构造函数通过[[Call]]方式会报类型错误</td>\n</tr>\n</tbody>\n</table>\n<h2>规范详细解读</h2>\n<h3>[[Call]]</h3>\n<p>当通过指定this调用函数对象的时候，实际上会执行内部定义的[[Call]]方法。<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/8dd9d06f57c8cce4f5daf449ce67ade9/da952/Call.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.39999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACJUlEQVQ4y42SC4+tKBCE/f9/cHfmzpnjG48KKiIgoN9GZ242+7ib7aRIA6Horq6s719UVUn+fFJ1glpJKiVplaSUI41eEXrF7gG/71hrcc7hY8SnhN8Dbk+4kDjOk6wUA3nT0/aSVggaOdIpieh66qqmrBrK5kVeC4qiuD/O85xCCIpOkFcVz6rlWQs268jmZcG4nZgOnPd3FXsIhHTi48F5nnAenMfBX+I+P7/z6+5rn3nv6aeFblkQQ09ZljTDRKs2WmWQqyOk45vj/BNfFJw/+b+RGWNohpHKrLSrpnqNFK+JYtCU0lKOmkdRk1cNKaV/Ev8N2SXwpc97UfCjKvl4PHh/e+O3t3c+niWjmpn0hg+J/xPZtax6oShLummiapo7z9uGZyco64au75FS0Q2SfjaMq2VPiRgjIaZb/wvpOL8IQ4jU4sViLWvcWTeD1prVxRvaBqbVotSEVAplLcvuWbRmWS3TtjMZj9sj2XEc9P3A74+Cclip5UY+GGo1M7sNnyI2BmyKpJ9T/a+Wr0o+i5yi7/l4TfwQirey50MoHv1EriY+p5l8HNDriosBl+JtMef8bWi7R/b4pXF26dDLmdVa/BFxu2dbNZsPbD5iXMC4iDEbyzyjncXEgLEbZrNoF9B2v9u9CZdl4dFJ3quOz6KmaMU9ADktSO1Qxt9enJ1lGMeb9Fdx2+ZquREvhFqplaGdDXI21HWFlPKXD/8NV4V/AHQW58QcFWiNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Call步骤\"\n        title=\"Call步骤\"\n        src=\"/blog/static/8dd9d06f57c8cce4f5daf449ce67ade9/00d43/Call.png\"\n        srcset=\"/blog/static/8dd9d06f57c8cce4f5daf449ce67ade9/63868/Call.png 250w,\n/blog/static/8dd9d06f57c8cce4f5daf449ce67ade9/0b533/Call.png 500w,\n/blog/static/8dd9d06f57c8cce4f5daf449ce67ade9/00d43/Call.png 1000w,\n/blog/static/8dd9d06f57c8cce4f5daf449ce67ade9/aa440/Call.png 1500w,\n/blog/static/8dd9d06f57c8cce4f5daf449ce67ade9/da952/Call.png 1872w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>将执行上下文切换到当前的执行上下文并对当前的执行上下文做基础的设置</li>\n<li>如果当前函数是类构造函数报错并退出</li>\n<li>在执行上下文上绑定this</li>\n<li>执行函数</li>\n<li>恢复执行上下文，如果有返回值返回结果</li>\n</ol>\n<h3>[[Construct]]</h3>\n<p>当通过new操作符调用一个函数对象的时候,实际上会执行内部定义的[[Construct]]方法,下面从规范上理解[[Construct]]方法从而理解调用构造函数的实际行为.<br>\n在通过new调用构造函数的时候会进行一些参数的修正然后调用构造函数的[[Construct]]\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/a8aaa81fd5db1aa5cda7b93d497f662b/5068c/newBefore.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABlklEQVQoz42Su27cMBBF9f9t+nxG6sCt26RJvGuJEiW+RFLUY7VriSeQErsL4AEOwEvM3JkBWUgpEULw+lpifY8eBsQQkWlAx4j2jtJ1SN0xpkTOmW3b2Pf8l5zZD71t5H2nkI1EdR1N02CtRWlNpxRKK3QYaH58p3v6ivz5hAkDSim01tg4YdOKiQsuBFqtSdNEIQ4za88pGymRbUdVVVRCIFR3UoqSsqkpmwZR12fzqpaUdUvVKoT3VKEnLQvF78vlTKrKksv1SlW3XF5esMYweI+PETtN9N5jtcaHcOKspXcO73uMtYQY2Y+VjwIzJlwMWKMxWtPHiFtm0u3Gtu+w7+S885kotA80Q6IbbnRmoq47tFL4ZaFfZoZpIqWE73timnjb9vNh/kchtacxA7X+RdU9I+wV4Xpc71gfD7acPzVZ/pdXaGOIw0hrvlG3X2jtM2a8YWLApYQbE/f7ncfjcXKcj29zX1fWdf3Q76bFcXHE9IDpDR73zDJPrLeVZZ5P5mVhHEfmeT7XP2pijIQQPvS74R+Y/K4/ae/U/QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"newBefore\"\n        title=\"newBefore\"\n        src=\"/blog/static/a8aaa81fd5db1aa5cda7b93d497f662b/00d43/newBefore.png\"\n        srcset=\"/blog/static/a8aaa81fd5db1aa5cda7b93d497f662b/63868/newBefore.png 250w,\n/blog/static/a8aaa81fd5db1aa5cda7b93d497f662b/0b533/newBefore.png 500w,\n/blog/static/a8aaa81fd5db1aa5cda7b93d497f662b/00d43/newBefore.png 1000w,\n/blog/static/a8aaa81fd5db1aa5cda7b93d497f662b/aa440/newBefore.png 1500w,\n/blog/static/a8aaa81fd5db1aa5cda7b93d497f662b/5068c/newBefore.png 1917w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span><br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/86392e3bf6a558e63d48d3af4d524b6b/9efb3/new.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACIklEQVQ4y42T2Y7bMBRD8/+/VxQoWkydWNa+Wd5i2UlO4Uy36cxDBRDSiwjykveUc0Z2EqUUnRBIrZExYnJ+RYrInEnjwlJ31roxzzPLsjBPM8v1yrJvXPf9+T7lcUDlhCsZ02d8SqhOouUBhVQG0Qo65bh0GtFJRNvSdR3n85lWCIS1CGNIOXPat400LLh+xsWIdPap0oRMnipLvfF6HvzPOdW6YqznHBJtSjRKcu40L60ijVfytDIslcfj8V841VqJOeNK/7RhteaYaykD9/v9nbjnxw+U/SbctkouBeEsX7Xiu7Eol1BxQoYRGQZ0HpFpJA4Tpa44759ztNbS/rx/kT4VGh8RMXOJAeE9rTQ0KnC2I40ttKHQxp65Vrb7jXq7sd1ub6z+IVxXYt8TxwFpLSEGnDHYkLAho13C50JY5iemulLWlWldD4b3oRydUkcQKdA4T+MT343jpbN8bS3fWk3jEnGeqfv+4dz+Vnm6LgttJ2mNxZSCGSa0C+hQUGnB9jO6zJiYSSGQx5G+rvTzRN8X8rg+21Dm+kq4Xq/kccKm8kx3GAopRa7L/K5/h4j748G27xz9ffxj+WfKG/tWMSFysY6mvXBpGkSnEMrRaY/wBRELIhTCMNIPAzHG37V6Y/lIuT8KrS3fpObT5y80QtCcW17OAmUDnTK8tBeUs3jv36l6E8qx5FJKrI+4cUZaj9CaEDw87h+u10d1+UX4A21fMqcRX5VbAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"new\"\n        title=\"new\"\n        src=\"/blog/static/86392e3bf6a558e63d48d3af4d524b6b/00d43/new.png\"\n        srcset=\"/blog/static/86392e3bf6a558e63d48d3af4d524b6b/63868/new.png 250w,\n/blog/static/86392e3bf6a558e63d48d3af4d524b6b/0b533/new.png 500w,\n/blog/static/86392e3bf6a558e63d48d3af4d524b6b/00d43/new.png 1000w,\n/blog/static/86392e3bf6a558e63d48d3af4d524b6b/aa440/new.png 1500w,\n/blog/static/86392e3bf6a558e63d48d3af4d524b6b/9efb3/new.png 1894w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/80ebd86d02879f771e89df0c9c2b0c60/161ec/createObj.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABcklEQVQoz3WS646kIBBGff/368kmCiLSAord4/3aezYwmZ9byUlRX6Coj5BJY3jkOX+kJBcCXWmMMdR1nei6Dj9PuGWmW2bcHJkw00gzTzTjwHEe/EZWhQ4dOqrWY71jnibWdWVZFuZ5Zt02tuNg3Xf242DZtrT+JdXryr7vnOdJJqREx2kaj7YBqTRfXw8ejwdCiISuKkqlkJGypCxVQhQFpZR47wkhpCEy5R3Ke+ouYBr3c1AIpJQoVaUcNWVtclHZJu3TpkGVJZWuecZaa8ZxJHNNg7cNMbfO4Z3DWUfbtolo575vrvPkvi6O4+A8D67r+tHvD+f9SXoka/sB17/x32+efaAdvulCoHmaRB8CXWzufSLWfegTzvlkN178er24rpusfloKrSlKRVFbRG1RxiGUoVCGsjbkukJoTfwRea3JtaY2T5y1OOfS+8WmwzCQNdHqe8C/V/x7wY8zYVnxy0o7LeznxQcSN3Dxl4v/xz9Dj1l5z6jTKAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"objCreate\"\n        title=\"objCreate\"\n        src=\"/blog/static/80ebd86d02879f771e89df0c9c2b0c60/00d43/createObj.png\"\n        srcset=\"/blog/static/80ebd86d02879f771e89df0c9c2b0c60/63868/createObj.png 250w,\n/blog/static/80ebd86d02879f771e89df0c9c2b0c60/0b533/createObj.png 500w,\n/blog/static/80ebd86d02879f771e89df0c9c2b0c60/00d43/createObj.png 1000w,\n/blog/static/80ebd86d02879f771e89df0c9c2b0c60/aa440/createObj.png 1500w,\n/blog/static/80ebd86d02879f771e89df0c9c2b0c60/161ec/createObj.png 1840w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n[[Construct]]主要分为一下几个步骤:</p>\n<ol>\n<li>将执行上下文定义为当前的执行上下文</li>\n<li>获取当前函数对象的[[ConstructorKind]], 如果是base类型, 将当前的执行环境的this设置为以构造函数为原型创建的对象</li>\n<li>创建新的执行上下文将2中的this绑定到当前的执行上下文</li>\n<li>在当前的词法环境和环境记录上执行构造函数</li>\n<li>退出当前的执行上下文,返回到上次的执行上下文</li>\n<li>如果执行构造函数的结果是有返回值的,当返回一个对象的时候直接将执行结果返回.当有返回结果但是不是对象的时候返回之前创建的this</li>\n<li>没有返回值的时候,返回之前创建的this.</li>\n</ol>\n<h4>简单实现一个new的调用过程</h4>\n<pre><code>function myNew(Con, ...args) {\n  const obj = Object.create(Con.prototype);\n  const ret = Con.call(obj, args);\n  if(ret instanceof Object &#x26;&#x26; ret !== null) {\n    return ret;\n  }\n  return obj;\n}\n</code></pre>\n<h3>Object.create</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/6cf0fab11d6071570431a07fe120598e/019a6/ObjectCreate.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA+klEQVQY032QW26DMBBF2f93V9Bt9Ct7aKUooQ8IoRA/iAUo4NepbLVRko9auhpd2XfmeAohJX3bUG2eaV6e6F43qNXSjoZhnoghEGO8KoRwp9u7pEJKyaGuqD92HKuSrm0YjEFojVQKYwxaa4ZhuCr5lOv7Pvvz+Zz9PM8UKdD1J3qhSLRaKZxdcdayXC4sy8I0Tfnx5dffEnrv72ph15VDd6KWmqrt2X81bN8ryqqh7TqmccxDhBDoYcjE/50ikZy0Yn885IbbzyNvZU1ZfyPMxOwso7WEGK+hx73d7dB5h5IKoRTWe1wAH8l1sZ7Fuaz0pb/QbeNHwh/2uc30ZuRRvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Object.create\"\n        title=\"Object.create\"\n        src=\"/blog/static/6cf0fab11d6071570431a07fe120598e/00d43/ObjectCreate.png\"\n        srcset=\"/blog/static/6cf0fab11d6071570431a07fe120598e/63868/ObjectCreate.png 250w,\n/blog/static/6cf0fab11d6071570431a07fe120598e/0b533/ObjectCreate.png 500w,\n/blog/static/6cf0fab11d6071570431a07fe120598e/00d43/ObjectCreate.png 1000w,\n/blog/static/6cf0fab11d6071570431a07fe120598e/aa440/ObjectCreate.png 1500w,\n/blog/static/6cf0fab11d6071570431a07fe120598e/019a6/ObjectCreate.png 1818w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>判断传入的原型是否是Object/Null，不是的话抛出异常</li>\n<li>根据传入的原型创建对象(如果传入的原型参数是空那么创建的对象没有原型)</li>\n<li>在创建的对象上定义属性并返回结果</li>\n</ol>\n<h3>规范示例</h3>\n<p>[[Environment]]定义函数对象创建时候的外部词法环境.实际上在javascript中函数就是闭包的概念.函数在创建的时候就已经跟外部的词法环境进行了绑定,在调用的时候并不会改变函数的外部的词法环境.</p>\n<pre><code>const a = 100;\nfunction test() {\n  console.log(a);\n}\nfunction test2() {\n  const a = 200;\n  test();\n}\nconst obj = {\n  a: function() {\n    test();\n  }\n}\ntest2() // 100\nobj.a(); // 100\n</code></pre>\n<p>在一个构造函数中返回一个非对象:</p>\n<pre><code>function Person(name) {\n  this.name = name;\n  return 1;\n}\nconst person = new Person('ss'); // { name: 'ss' }\n</code></pre>\n<p>对于this的确定,可以参考下面的确定规则:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 955px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/460681b8e463e26d3a1b7f288f0aaf8e/a0b80/this.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 94.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB2klEQVQ4y32UyaoCQQxF+/9/RlDUhbhR3KiI4oiI4DzP85jHCUTqdbcWhC4rqVvJzY3e7XaTx+Px1Z7PpxAzm81kPp/r93A4yOv1CsSdTifxcHxb7/f78x2Px9JsNmUymcj5fA6Nv16v4oFsl1zjIYw9MZvNRm29XsvlcgncYXEeAPy1n06nmoU/+6+A7pflpwP+4POb/2eGZAJvAEB2pVKRVqsltVpNgfEPBgO53+9qPwEJ2O12CkQD4K7X6ylYv99XQC4fj0f1b7dbvfOvKe7a7/eyWCz+nSENLlpD3MXDgFGNR6C1nFe4gDQwA7BG4HcrAYAM0SfdpyrNEBsOh7JcLqXdbkuxWJRyuSz1ev1Tottdt6uj0Ug6nY7GYZ41wM3C9GZnPMh0+AHx53I5iUQiEovFlOMPoKt+/29ooQFhGRJLZeyhKADo6tD2AIZlyLmpAQPYM4cJ1j+CVrL7oOtzH1bZALRarZR4gMMAAcPvn47QWYbIeDwuyWRSut2umIzsT4EyaBDSQJsul/4MFZC2JxIJSafTypNfHugxk8lIoVCQarX6k2sFLJVKks1m9VKj0fjMpXFHEJkjDybI/28TAMzn85JKpSQajerwW8nGl00AX8ztdhjgHySBv0iaXn0uAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"this\"\n        title=\"this\"\n        src=\"/blog/static/460681b8e463e26d3a1b7f288f0aaf8e/a0b80/this.png\"\n        srcset=\"/blog/static/460681b8e463e26d3a1b7f288f0aaf8e/63868/this.png 250w,\n/blog/static/460681b8e463e26d3a1b7f288f0aaf8e/0b533/this.png 500w,\n/blog/static/460681b8e463e26d3a1b7f288f0aaf8e/a0b80/this.png 955w\"\n        sizes=\"(max-width: 955px) 100vw, 955px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>参考</h2>\n<p><a href=\"https://tc39.github.io/ecma262/#sec-ecmascript-function-objects\">ECMAScript2020</a><br>\n<a href=\"http://ldllidonglin.github.io/blog/2019/04/26/2019-04-26-ECMAScript2016%E8%A7%84%E8%8C%83%E7%90%86%E8%A7%A3%EF%BC%888%EF%BC%89-new%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B/\">ECMAScript2016规范理解（8）-new表达式的执行过程</a><br>\n<a href=\"https://icantunderstand.github.io/blog/javascript-call\">深入理解javascript系列之执行环境</a></p>","fields":{"readingTime":{"text":"7 min read"}},"frontmatter":{"title":"ECMAScript规范-函数对象","date":"2019-05-29","tags":"JavaScript","path":"/ecmascript-function","top":null,"summary":null}}},{"node":{"id":"c2ea6440-912f-5b29-8371-f61ee1bcc935","html":"<h2>前言</h2>\n<pre><code>import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nReactDOM.render(&#x3C;App />, document.getElementById('root'));\n</code></pre>\n<p>当通过create-react-app初始化一个项目的时候,上面这段代码就在浏览器中绘制出了内容.ReactDOM.render(ReactElement, Container, callback)是怎么将React组件绘制到浏览器中的呢?本文是React源码阅读系列的起始篇,在这篇文章中主要围绕以下两个方面进行介绍:</p>\n<ol>\n<li>render()方法调用中相关函数的调用</li>\n<li>render()方法调用中产生的数据结构的梳理</li>\n</ol>\n<p>阅读源码是一个知其然知其所以然的过程.通过源码阅读的过程中我们能学习到一些设计,代码优化,解决方案等,通过这些来反哺实际工作的遇到的问题.这个也是这个系列想要获得并且与大家分享的内容.</p>\n<h2>如何阅读React源码</h2>\n<p>React仓库是一个包含多个package的仓库.在阅读源码之前需要对独立的仓库有个简单的认识.比如react通过react-reconciler和renderer(react-dom, react-native)来完成页面的渲染.</p>\n<ol>\n<li>\n<p>下载<a href=\"https://github.com/facebook/react\">react源码</a>, 打包本地文件</p>\n<p>yarn build react/index,react-dom/index,scheduler --type=NODE</p>\n</li>\n<li>\n<p>通过yarn link声明包的指向</p>\n<p>cd build/node_modules/react\n// 声明react指向<br>\nyarn link<br>\ncd build/node_modules/react-dom<br>\n// 声明react-dom指向<br>\nyarn link</p>\n</li>\n<li>\n<p>把项目中的依赖指向设定的包</p>\n<p>yarn link react react-dom</p>\n</li>\n<li>\n<p>增加断点调试</p>\n</li>\n</ol>\n<h2>ReactDOM.render()调用过程中的函数调用</h2>\n<p>以下所有代码基于React 16.8.6</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 218px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/548b054e096b5dbdd8ab61b79d1b93ba/5c416/renderFunc.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 241.28440366972478%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"reactRenderFunc\"\n        title=\"reactRenderFunc\"\n        src=\"/blog/static/548b054e096b5dbdd8ab61b79d1b93ba/5c416/renderFunc.png\"\n        srcset=\"/blog/static/548b054e096b5dbdd8ab61b79d1b93ba/5c416/renderFunc.png 218w\"\n        sizes=\"(max-width: 218px) 100vw, 218px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>走入ReactDOM.render()源码</h3>\n<p>首先定位到packages/react-dom/src/client/ReactDOM.js\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 698px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/ccc403ac7ab7468246c5721e902cf82e/487bb/domRender.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 98.39999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC+ElEQVQ4y52U226jVhSG8xSpOR+92YABY2OM8RHHsevJTNJeVDMv0Mve9P2lr2LbsWamSaXmYmn/WoKP9e/1i7tCuPz1lPL384h1HjDQDUxDR9cGGLqOaRhog3t0XVM9bTDAtCxs28a6nt/X3dBz6NoJz89n2v2RaFRQ1EvKdke53FMuO6abI+O6ZbJYU7UbQt+/Qf8FdBwHNxpR7r8we3yh2p+ZTmecn77y+9c/OTx84dPnb3x++cZ6vqTKCnzPe3M6BXQdmzAeKdDs8MTi199IkpSm27E6HZlv1tTLlkmaE3geA027wd607PseSVYg0gJfZgRxRuB6FGlMmkqyUUwcR5imqQC9o/dgCuh5Hkkimc8yUukxHUsSGTK4v0cf/II+GKBrGqauqWVdTuNN2MWy6+L7Lov1gqbbsz4eaPaPiKIiKmuicYUc5cSTOSKfIssamWZouoFhWuimiW6YGFcHasLeThSPWKx2tKst9apjsdqy7Q6sNlumVUW93NKstjTrjrqascgTkmFILocUckgyDHBd5zphEBB6LsXQo0kChGNQCJ9p5DOLh0jfJfYd8qFPGrgkoU9bJArW5AmLPGYkQoIg4M62HeJYUo5zTNslzKb4UYzjenhBiGFZKnOmZX+nLbSrzd7uRVsXy/3W4liQZxKR5pTro7onEUmiKMLqQf0Lhqmu5mdtXvXr1hVQiIgkjvF9H8+xiESAEAFShupjURSSxOLaG6rqezK6aCFC+vhdJ3QRUcSu65gvlhTjjNOpZbetOZ2WPDw0rFYVh8OCpinpujm7Xa16m81M6badqGszTbVlH8s0iIqK8fqAzMbomo6uG2iarupVX84fdX/21du+BduxbeJxRf34QvvpD/KqwbJMHMdW9V6If65bDm3LIi5nTHZHxqsHZvszkUywrl/9GHA8Y9qdKdsttm398ND/gd6Aspgy2R6pjy9Um0f6wP/XX+Vd4Gts0jRVge0D7Xr+h6ZTQCEERVGoJfSAS5kfmq4H/gP/FkIGbbuk8gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"domRender\"\n        title=\"domRender\"\n        src=\"/blog/static/ccc403ac7ab7468246c5721e902cf82e/487bb/domRender.png\"\n        srcset=\"/blog/static/ccc403ac7ab7468246c5721e902cf82e/63868/domRender.png 250w,\n/blog/static/ccc403ac7ab7468246c5721e902cf82e/0b533/domRender.png 500w,\n/blog/static/ccc403ac7ab7468246c5721e902cf82e/487bb/domRender.png 698w\"\n        sizes=\"(max-width: 698px) 100vw, 698px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n可以看到ReactDOM.render()方法将当前的ReactElement和Container信息传递给了legacyRenderSubtreeIntoContainer.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/b5582cb16e1290c05326982304c8019a/fe9e8/containerRender.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 98%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC7UlEQVQ4y4WU627bRhCF+RrlbS+8L6+iSNOUFCVV7LS1oaBFgwJtUPRX3/8RvmJXieE0sPzjYHbJmd2ZOWfWy7sZs/uZD3dv+fePO/5+XPl8vuHP8w2ff1v563zDPx9vOJ82ZHVNHEXEcfwivLSo2BxOtMuRat3R7ncM+1vaaUTnOTpN0UlKmiQUeeaCoiuHemnVsD58Yv/4iel0Yno4MT+8p+lbQt93wVEUOhuGIVH8WoZ5Sbe8oZlW6q5j2A70fUMcRkT/c74cfh1emqYorYlFjJQxSgqEEMQW9qCvayEQ8lvYGPEMdu/FIiIzkqJVZLWFJq0kaSXc3q6zWl6+lQKdCVQmSEpFUijS0vprZ3Wu8FSSUU8zm8OedhkxvaGdt/T7A808Uk8Tm+OR8d0b2mVHWXfU/UhRlERh+H0PE5ViTEO/rjRDjU4FUmuE1MSxLV8hVHKBTomFQn75FwQBQRA6svwgcNazuir7ATN0NDcL7e1CXtdUw0Q93TprNjNJXjJ0FduxYRgM89yx2dSs64ZpatluW4wp8UQckdcdy0+/sv7yO2aYEUIikxTbDqETtxZSkSSaNNXPrPrGKiXxpJQUWU5SGNKqJats2ZljWsYRWsQox6IgDC9afMk62SilaApDUvXIsiNvB8x2obJl5ylDldObgjzPrwr6iRR7c14lVI2mbjWllU4u0IVC55JYR0grk0o5nX0du5fGz7OCHfuG0/sfuf/4yP35gcPdB4ZlR9MNFE2PqQq0lmitXp9lIaXTU9FNjOuB5bBjOR7ZH3eM247tNDBPHePYMI4tyvo/y/L70UskF6Zbx/Jyf6a2MimqS6O/NP150NUedrV0t2ZlST3v6eadYzcMfIRzip7eQNvv1+DFscRKZx4WTFGiVeRko7McqbTTols/K/VqhtbRZlgPM90wMG1bqm7AjAt5VVN2I832ljTLnmb36vNl0zTGuOfH9318PyC0c+n7hGHgSg/8H1w/X2PYZvgf6TQ+Dh0+uR0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"containerRender\"\n        title=\"containerRender\"\n        src=\"/blog/static/b5582cb16e1290c05326982304c8019a/00d43/containerRender.png\"\n        srcset=\"/blog/static/b5582cb16e1290c05326982304c8019a/63868/containerRender.png 250w,\n/blog/static/b5582cb16e1290c05326982304c8019a/0b533/containerRender.png 500w,\n/blog/static/b5582cb16e1290c05326982304c8019a/00d43/containerRender.png 1000w,\n/blog/static/b5582cb16e1290c05326982304c8019a/fe9e8/containerRender.png 1146w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n由于是首次mount,这个时候还没有root节点并且是应用的根节点这里直接进行root节点的创建.最后调用root的render方法就开始进行页面的绘制.在legacyCreateRootFromDOMContainer方法中会对当前容器的内容进行清理.这里调用创建了ReactRoot节点.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 972px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/91680b2c143842cd0cbd5fb4f5cc6eca/7ae9c/createReactRoot.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABu0lEQVQoz22S3U7cMBCF9y0qNrFj52eT2InjkGQ37MLC0iJVAgoUbtqC+v5P8VUJVEUqF58851wcz2hmkZWOZneF333h9umJ+98v3Dw/8+3lF7c/f3Dz8MDd0yPXd/fcfH9ktz9Ha02SJB+y0HGCP/vM5usD/vQSvz2h3Y90hy3W14TLgCD4RxiGSCk/RAjBIs8L7G6L7ToK68hyQ2ksRWmQoeBoDgxZvnsn768OgiXB8mhm+mwRRQrbbmk25/SX1wxXtzQnF3TjiG8sTWNwrqRxhrouZz1RVQXWrChsRV635LUnzbIpUJKZgnocqNdrqnVHWZf4Y8N627DZeYbRMe5bfGvnYO/ta6DNKWxN7o4pXPsWqCKiKEDpACE+EakjIhUgY4FUIXKuJdFEEhHK8L+Rw/cjK61J64ayd7hxTb3uqfp+7nLlagrvSHNNvFJkJp5rKcW8ACHCN171tJiF1jGdP8VVA2ZzwOzPMYcD5WbAbS7mkzK+Jy0stjuhaHpMO7AyNbbf4sYzqmFH5TtUJFlkWUYcKZSMCIVEKInQEVIrdBwznZVOUlQcE2eruZ68WaerVy/NiJN07vAPulILAw+TO9QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"createReactRoot\"\n        title=\"createReactRoot\"\n        src=\"/blog/static/91680b2c143842cd0cbd5fb4f5cc6eca/7ae9c/createReactRoot.png\"\n        srcset=\"/blog/static/91680b2c143842cd0cbd5fb4f5cc6eca/63868/createReactRoot.png 250w,\n/blog/static/91680b2c143842cd0cbd5fb4f5cc6eca/0b533/createReactRoot.png 500w,\n/blog/static/91680b2c143842cd0cbd5fb4f5cc6eca/7ae9c/createReactRoot.png 972w\"\n        sizes=\"(max-width: 972px) 100vw, 972px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/c5e79bbf934850f9fe4c7198d42ec888/46e51/ReactRoot.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABFUlEQVQY052Qy1KDQBBF+QxlhsDAPCBAIA9CHkQqhIVa7nSvW///A44F2bi0XJyqvnfRt297WXtj2V75fDvw/bHn6/2CSS2RTgjDkCAIWCwWf8ZbX0Z2wwur00CxP1JeDuyer6y7FhVF/1jY3ajPA/l2R3U+sjk0ZM4RhSG+EEgpkVIghSCQckbO/p3fegr37LJEGUdiLdrEOJdgTIzWCqMV2mgSm5K4DJVolDbzHBtLrO3sTVpbN7/IM5seu2pohlfq9kw3jvRDx/npRD/2VFVJvj1S7jvSosKVNUVzIls3LOsdrqgo9h3ltiVWCi+MDcl04ZSS5ui8Ioo1odIokyJ8H+E/zszVxF1L378jBMJ/mL2p8g9NYa5liRgmAQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"reactRoot\"\n        title=\"reactRoot\"\n        src=\"/blog/static/c5e79bbf934850f9fe4c7198d42ec888/00d43/ReactRoot.png\"\n        srcset=\"/blog/static/c5e79bbf934850f9fe4c7198d42ec888/63868/ReactRoot.png 250w,\n/blog/static/c5e79bbf934850f9fe4c7198d42ec888/0b533/ReactRoot.png 500w,\n/blog/static/c5e79bbf934850f9fe4c7198d42ec888/00d43/ReactRoot.png 1000w,\n/blog/static/c5e79bbf934850f9fe4c7198d42ec888/46e51/ReactRoot.png 1003w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\ncreateContainer根据当前的container信息来创建根容器.\n定位到packages/react-reconciler/src/ReactFiberReconciler.js\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 983px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/d744dcb576c159192651c4712d527cc4/91b29/createContainer.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA+ElEQVQY04WNSU7DQAAE/Y3EM94nnsXbTOIosYMUCCCxiAMP4AT8/weFSCQOHOBQUnUfuqM8y5n6mdaNKH9FEa6Zxp7P54GPlw3vT56325a6KoiFJEmSP4mkWFI2geH0Sjvf0x0eqEOgPx0YjjOVUiwWS6RM/h07DyZSYMOIv3vETTNuv8VPW5zVFGmKiJdIESPiC1KIi4tf+dulJEqThLb37G5OjMcD++OO9brHuhprVihtUab5IS8VyraUtaHSlqJanfvaNmRZRpRmKXalaXONLSt8Z+g7QwgNfnCYzmP8iO7X1O1wPjDDBt2FM0o7zDDi/IaiKPkCswmTgkGvCxoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"createContainer\"\n        title=\"createContainer\"\n        src=\"/blog/static/d744dcb576c159192651c4712d527cc4/91b29/createContainer.png\"\n        srcset=\"/blog/static/d744dcb576c159192651c4712d527cc4/63868/createContainer.png 250w,\n/blog/static/d744dcb576c159192651c4712d527cc4/0b533/createContainer.png 500w,\n/blog/static/d744dcb576c159192651c4712d527cc4/91b29/createContainer.png 983w\"\n        sizes=\"(max-width: 983px) 100vw, 983px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n定位到packages/react-reconciler/src/ReactFiberRoot.js(Fiber !!!!!!)\n在createFiberRoot方法中,创建了根据当前的容器信息创建了FiberRoot并且创建了一个HostRootFiber进行相互引用.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/52525f7a291707863825ad97e39b8ba5/05fb0/createFiberRoot.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.400000000000006%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABr0lEQVQoz42S2WobQRRE5zeiWXvvHs2u0UhCXmMldggB61H//yEnjBYTCAY/FNW36S6KqhutlyNl6NDtFlONrH4d2byf2B5P7I4nlHUkSUKWZV9CVE13bF7fGb//pr17pnl5IEwjWSFIs+LLQh+Cy9XE8HSgmiaa7UjdVhgpSNOUNF6QxjHp4oIknrEgWSwuPM+Lb9f7mCSJiXwz0OwfGB8fqboWO7SoqsRYh/QNoq2QfYNctdiuo+wmQj8x/3PLlnLY4MqaUHf4UBLlhSAXkpmlEoRgcU4htUQYg/CawmkKr5HeoJxDeYtyFmU12nuMMxhrkEISSSMJg6OaPMsxEHpH6D1CC5TJcaXElQrnFb7SmKAwQV9QGpQt0EFQqPxcXqRDi2vX1NOOZrOnWu/o7w/4dqTuenZ3W1ZDxWqoz1w3DaGbcPVA2a3PruI4IU1vpYw7+oefdPcHxqc3Vk+vdPtnNm9Hph9/GO5fWPbrc+jnomZk6cf534bnOVJSY5VDWY9y/pxllucUc655TpamFEJ8uiY30RtHwQaC8tiyvixxHF8fJFcX2X9OPhOdBf8CLMQh8QdqEjAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"createFiberRoot\"\n        title=\"createFiberRoot\"\n        src=\"/blog/static/52525f7a291707863825ad97e39b8ba5/00d43/createFiberRoot.png\"\n        srcset=\"/blog/static/52525f7a291707863825ad97e39b8ba5/63868/createFiberRoot.png 250w,\n/blog/static/52525f7a291707863825ad97e39b8ba5/0b533/createFiberRoot.png 500w,\n/blog/static/52525f7a291707863825ad97e39b8ba5/00d43/createFiberRoot.png 1000w,\n/blog/static/52525f7a291707863825ad97e39b8ba5/05fb0/createFiberRoot.png 1138w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>ReactDOM.render()调用过程中的数据结构</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/14dbf1020c707361e3ce32d83f6c0dd5/f058b/renderStruct.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.999999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABIUlEQVQY032RXUvCcBjF95WDboIKyVCq267Eu6CQzMILTSovhLoLUpmpaep82XTa3KZD5/b/RYkVIh04nIcDzwvnkYQQrNMXPl+w50NS3RDJ1gHxyv633mphekaNXldF10bk9RTxcoBLOUBhmEbiH9jukIx2RLIVJCbvkWwuB+oThYXr4S+gbGZJd45Jt08oje+QPOb8UMzxhYdhGKiqSqfbRhlUsRZ9bG+A6fYZz1Q83/1dak7RtQ9MY8LUmiFdVw5JvAa5qYSIybtUjScc28W0xjiOgzvzNl6/iqeu5SkqOWr6M03jBemhEeH+PUK2GSVTP0Wx8hua/TWKpe8LHkdRLt62OC9tE2/sbM5w/Ul/vVW90lzzjFghwFUxREIO8wk517n0JFsJLQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"reactStruct\"\n        title=\"reactStruct\"\n        src=\"/blog/static/14dbf1020c707361e3ce32d83f6c0dd5/f058b/renderStruct.png\"\n        srcset=\"/blog/static/14dbf1020c707361e3ce32d83f6c0dd5/63868/renderStruct.png 250w,\n/blog/static/14dbf1020c707361e3ce32d83f6c0dd5/0b533/renderStruct.png 500w,\n/blog/static/14dbf1020c707361e3ce32d83f6c0dd5/f058b/renderStruct.png 630w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n通过启动最开始create-react-app创建的项目,可以看到以下的输出.<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/8bea5b913ac20f4f3d728869ac3041fd/2c0d3/showRenderStruct.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAmElEQVQY05XQywqDMBCFYd//HVvwUk3UxFzEadTmL0oXxVV74IMzMKtT6EYzjJFlEebZ4Zxlmgx2Moi37Gkh55382sj547tfFF3T4l0gycYqK9fkQ/5dcb/dUaqnqhrKskIpzTMlUkrs235+5T8UbdcxjCN13aD7HqU1xhi6h8HaQAiBGCMicjq6954QjpkSMYbznucFkZU3QZw2325BZlsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"showRenderStruct\"\n        title=\"showRenderStruct\"\n        src=\"/blog/static/8bea5b913ac20f4f3d728869ac3041fd/00d43/showRenderStruct.png\"\n        srcset=\"/blog/static/8bea5b913ac20f4f3d728869ac3041fd/63868/showRenderStruct.png 250w,\n/blog/static/8bea5b913ac20f4f3d728869ac3041fd/0b533/showRenderStruct.png 500w,\n/blog/static/8bea5b913ac20f4f3d728869ac3041fd/00d43/showRenderStruct.png 1000w,\n/blog/static/8bea5b913ac20f4f3d728869ac3041fd/aa440/showRenderStruct.png 1500w,\n/blog/static/8bea5b913ac20f4f3d728869ac3041fd/2c0d3/showRenderStruct.png 1849w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>后记</h2>\n<p>这篇文章只梳理了React在实际调用渲染函数之前的函数调用和数据结构.在这个过程中终于盼来了千呼万唤的fiber.之后的文章会继续深入react的渲染流程和fiber的实现来对react进行学习.</p>","fields":{"readingTime":{"text":"4 min read"}},"frontmatter":{"title":"React render流程梳理","date":"2019-05-10","tags":"React","path":"/react-render","top":null,"summary":null}}},{"node":{"id":"912d5b0a-962a-594b-b556-032a8ee38a39","html":"<h2>前言</h2>\n<p>在react最新的reconciliation使用的是Fiber架构.Fiber使用的增量渲染的模式,具体的实现是渲染的任务可以被拆分,在页面更新的时候具体的任务可以被打断,复用.这些特性无疑对页面交互是有很大的提升.下面通过React Fiber Architecture这篇文章来对Fiber有个大体的认识.之后的系列我会深入react的源码来仔细学习Fiber的具体实现.</p>\n<h2>基础知识</h2>\n<h3>What is reconciliation?</h3>\n<h4>reconciliation</h4>\n<p>react通过Virtual Dom和真实Dom之间建立缓冲,通过diff出变化前后virtual Dom的差异来将差异更新到真实Dom上.reconciliation正是对比Virtual Dom差异的实现.</p>\n<h4>update(更新)</h4>\n<p>渲染页面的数据发生变化导致页面更新</p>\n<p>在没有reconciliation(调和)的情况下,数据的变动将会导致整个页面重新绘制.通过Virtual Dom来代表将要渲染的页面,将Virtual Dom交给对应的renderer(react-dom, react native)来进行页面的绘制.在页面更新的时候通过调和来生成前后Virtual Dom树的差异来进行页面的更新.这样一定程度上提高了页面的性能.React的更新策略是在下面的假设下进行的:</p>\n<ol>\n<li>组件很少进行跨层级的移动</li>\n<li>不同类型的组件生成的结构是不同的</li>\n<li>相同类型的列表元素可以通过唯一的标识来进行复用</li>\n</ol>\n<h3>Scheduling(调度)</h3>\n<h4>scheduling</h4>\n<p>确定哪些更新的任务需要执行</p>\n<h4>work(更新任务)</h4>\n<p>需要执行的任务,通常是页面的更新\nReact的构建UI的库,它采取pull(拉)的模式来处理页面的更新交互.在push(推)的模式中数据(更新)推动整个页面的更新.React对更新的任务进行了一定的调度,来达到更好的页面交互.React采用这种策略主要有以下的原因:</p>\n<ol>\n<li>在处理UI界面的时候,通常上不是所有的更新都需要立刻被执行的.(可以类比图片的懒加载)</li>\n<li>不同的类型更新应该有优先级.为了更好的交互体验,通过优先级可以提供更好的页面交互.(比如动画的优先级更高,页面会更加流畅)</li>\n<li>push的模式需要开发者组织页面的更新,pull的模式使得React可以帮助开发者实现更好的页面交互.</li>\n</ol>\n<h2>what is Fiber?</h2>\n<p>通过Fiber使得React可以更好的调度任务.主要有以下的功能:</p>\n<ol>\n<li>暂停任务并且在之后继续执行</li>\n<li>对不同的任务设置优先级</li>\n<li>复用之前完成的任务的结果</li>\n<li>丢弃不需要的任务</li>\n</ol>\n<p>在这里可以简单的将fiber理解为需要做的任务.在进行页面绘制的时候组件更新和函数执行的任务都会被推进执行的栈结构.这种模式当太多任务需要执行的时候会导致页面的交互变的卡顿.浏览器提供了两个api来处理上面的问题.</p>\n<ol>\n<li>requestIdleCallback 通过requestIdleCallback可以在空闲的时候执行一个低优先级的任务</li>\n<li>requestAnimationFrame 可以在浏览器下次重绘之前执行一个较高优先级的任务</li>\n</ol>\n<p>为了利用上面的函数来实现页面的更新,就需要将渲染的任务拆分成多个任务.Fiber架构可以理解为重新实现的栈而fiber节点是一个虚拟的栈帧.Fiber架构通过调度帧的执行逻辑来完成页面的更新.</p>\n<h3>fiber结构</h3>\n<p>一个fiber节点代表一个栈帧,也代表一个组件的实例.下面是fiber结构一些重要的属性:</p>\n<h4>type  key</h4>\n<p>type和key对于fiber节点的作用跟type和key对React element的作用一致. type可以判断fiber节点对应的是React组件还是宿主环境的组件(div).key用于调和的时候复用fiber.</p>\n<h4>child sibling  return</h4>\n<p>fiber是通过单链表进行关联的.fiber节点的return指向它的parent.child指向fiber第一个子节点.sibling指向当前fiber节点的兄弟节点.</p>\n<pre><code>function Parent() {\n  return [&#x3C;Child1 />, &#x3C;Child2 />]\n}\n</code></pre>\n<p>上面的结构Child1是Parent的child,Child2是Child1的sibling,Parent是Child1和Child2的return.</p>\n<h4>pendingWorkPriority</h4>\n<p>优先级</p>\n<h3>alternate</h3>\n<p>一个组件至多有两个fiber结构与它对应: 当前的fiber(正在处理的fiber),flushed fiber(处理完毕,准备渲染(commit)的fiber), alternate(当前fiber的替身).</p>\n<h2>参考</h2>\n<p><a href=\"https://github.com/acdlite/react-fiber-architecture\">React Fiber Architecture</a>\n<a href=\"http://www.ayqy.net/blog/dive-into-react-fiber/\">完全理解React Fiber</a></p>","fields":{"readingTime":{"text":"6 min read"}},"frontmatter":{"title":"React Fiber Architecture(译)","date":"2019-05-09","tags":"React","path":"/react-fiber","top":null,"summary":null}}},{"node":{"id":"8095c680-f29b-500f-a6f9-84c1231b004a","html":"<h2>为什么使用容器技术</h2>\n<p>在传统的软件部署方式中，开发者需要在不同的主机之前同步配置来确保应用运行环境的一致性。通过容器技术能有效的优化集群环境的部署，极大的改变软件开发和发布的方式。下面从容器与传统的虚拟化技术对比来揭开容器的面纱。</p>\n<h3>docker与传统的虚拟机方案的对比</h3>\n<p><img src=\"./frontendtoolstatic/docker/different.png\" alt=\"different\"></p>\n<ol>\n<li>传统的虚拟机技术主要通过虚拟机监控器完成虚拟操作系统和宿主操作系统之间的交互.docker容器直接与宿主系统通信，减少了语言转换的过程,因此在启动速度和运行效率上更胜一筹.</li>\n<li>容器技术更加偏向于程序的移植和依赖的打包而虚拟机技术则是侧重于完全的虚拟出一个另一个虚拟环境。</li>\n<li>docker能提供更快的交付过程.通过合理的对宿主操作系统资源的划分,能有效地提高系统的资源利用率。</li>\n</ol>\n<h2>核心技术介绍</h2>\n<h3>namespace(隔离)</h3>\n<p>通过NameSpace技术可以修改容器的视图.</p>\n<pre><code>int clone(int (*fn)(void *), void *child_stack, int flags, void *arg);\n</code></pre>\n<p>在linux中可以通过系统调用clone来创建新的进程,当第三个参数flags指定CLONE_NEWNS就会在新的namespace下启动新进程.<br>\n<img src=\"./frontendtoolstatic/docker/namespace.png\" alt=\"namespace\"><br>\n在上面的例子中系统本身有已经运行的很多进程,通过运行镜像并且执行bin/sh进程可以进入容器的交互界面.在容器中只能看到root进程和ps进程.这样通过namespace技术就实现了不同进程间的隔离.</p>\n<h3>Control Groups(限制)</h3>\n<p>namespace创建的进程与其他进程之前对主机的资源是竞争关系的.Linux Control Group技术就是限制进程组能够使用资源上限的一种技术.通过对容器使用资源的上线进行设置能有效地使用主机的资源和防止资源的过渡占用。</p>\n<h3>联合文件系统(Union File System)</h3>\n<p>联合文件系统可以同时挂载不同的实际文件或者目录到同一目录.Docker基于联合文件系统提出AUFS(Advanced Union File System).AUFS通过将新的镜像层挂载到老的镜像层之上,通过共享基础镜像和增量更新可以使docker的镜像管理更加快速。</p>\n<h2>docker核心概念介绍</h2>\n<h3>镜像</h3>\n<p>镜像是封装了虚拟环境的运行内容的文件包,docker通过利用AUFS实现了增量的镜像结构.</p>\n<h3>容器</h3>\n<p>容器是隔离的虚拟环境,里面运行着docker镜像.容器有以下的运行状态:</p>\n<table>\n<thead>\n<tr>\n<th>状态</th>\n<th align=\"center\">含义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Created</td>\n<td align=\"center\">容器已经被创建资源已经就绪,应用程序未运行</td>\n</tr>\n<tr>\n<td>Running</td>\n<td align=\"center\">容器中的应用容器处于运行中</td>\n</tr>\n<tr>\n<td>Paused</td>\n<td align=\"center\">容器暂停</td>\n</tr>\n<tr>\n<td>Stopped</td>\n<td align=\"center\">容器停止</td>\n</tr>\n<tr>\n<td>Deleted</td>\n<td align=\"center\">容器被删除,占有的资源以及资源的的管理信息已经被删除</td>\n</tr>\n<tr>\n<td>### 数据卷</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td>docker运行时的持久化目录,通过将外部目录挂载到容器中,来实现数据的持久化.</td>\n<td align=\"center\"></td>\n</tr>\n</tbody>\n</table>\n<h3>docker engine</h3>\n<p><img src=\"./frontendtoolstatic/docker/dockerEngine.png\" alt=\"dockerEngine\">\ndocker engine是负责启动镜像的服务,通过docker client提供的指令调用docker server提供的接口来实现对镜像和容器的操作.</p>\n<h2>使用镜像</h2>\n<h3>启动指令</h3>\n<pre><code>docker run --name nginx -p 80:80 -d nginx // --name 执行容器名 -p 宿主端口:容器端口 将宿主端口映射到容器的端口 -d 后台的方式启动 \n\ndocker run --name myredis redis\ndocekr run --name test --link  myredis:redis debian  // --link Container:Alias 目标容器的名称:目标容器的别名 建立容器之间的链接\n</code></pre>\n<h3>操作容器指令</h3>\n<pre><code>docker ps -a // 查看所有的容器  \ndocker images // 查看所有本地镜像 \ndocker stop name/ID  // 停止某个容器 \ndocker rm name/ID // 删除容器\ndocker rm $(docker ps -aq) // 删除所有容器\ndocker rmi $(docker images -q) // 删除所有本地镜像\n</code></pre>\n<h3>使用docker创建一个hello world应用</h3>\n<h4>编写程序文件</h4>\n<p>创建一个目录结构如下:<br>\n<img src=\"./frontendtoolstatic/docker/category.png\" alt=\"category\"><br>\n在index.py中编写程序的主要功能如下:</p>\n<pre><code>from flask import Flask\napp = Flask(__name__)\n\n@app.route('/')\ndef hello_world():\n  return 'Hello world\\n'\n\nif __name__ == '__main__':\n  app.run(debug=True,host=\"0.0.0.0\") // 创建一个服务 在/路径下返回Hello world\n</code></pre>\n<h4>编写Dockerfile</h4>\n<p>镜像的构建可以通过Dockerfile和构建环境的上下文来完成.通过Dockerfile可以将镜像的构建过程持久化.</p>\n<pre><code>From python:3.4 // 从某一个基础镜像开始 From语句必须是Dockerfile的第一条语句\nRun pip install Flask==0.10.1 // 执行指定的指令  由于每次执行的执行都会行成新的镜像层,可以将多个指令进行合并\nWORKDIR /app // 执行Dockerfile指令执行的工作目录\nCOPY app /app  // src dest 这个指令将上下文的app目录复制到容器的app目录\nCMD python index.py // 容器启动时执行的指令\n</code></pre>\n<h4>构建镜像和启动容器</h4>\n<pre><code>docker build -t hello . //在当前目录的上下文上构建镜像\ndocker run --name haha -p 5000:5000 hello // 以haha容器名字启动helloword镜像 并且将容器的5000端口映射到外部的5000端口\n</code></pre>\n<p><img src=\"./frontendtoolstatic/docker/run.png\" alt=\"run\"></p>","fields":{"readingTime":{"text":"7 min read"}},"frontmatter":{"title":"docker入门","date":"2019-04-28","tags":"工程化","path":"/docker","top":null,"summary":null}}},{"node":{"id":"90a974f9-2094-555f-8e7b-5b57b6e455b7","html":"<h2>简介</h2>\n<p>　　WEB同构应用指的是通过代码的编译转换手段(通常借助于babel)来让代码在不同端client(浏览器), server(服务器)运行.同构的web应用主要有以下的优点:</p>\n<ol>\n<li>一套代码多处运行减少维护成本</li>\n<li>任务拆分,通过同构可以实现更多的功能(SSR, fetchData)</li>\n</ol>\n<p><img src=\"./javascriptbasestatic/isomorphism/isomorphism.png\" alt=\"isomorphism\"></p>\n<h2>简单的实现思路</h2>\n<ol>\n<li>将client端的代码转换成server可以执行的代码(es6 => commonjs).</li>\n<li>在两端组合出一套模式相同的代码逻辑.下面的例子中在server和client端使用不同的react-router提供的组件.</li>\n</ol>\n<p><img src=\"./javascriptbasestatic/isomorphism/app.png\" alt=\"App\"><br>\n3. server端路由匹配,组装资源(css, js, data), 可以通过不同的中间件根据请求信息来组装.<br>\n4. client端路由匹配,匹配资源(data, 检查页面渲染结果是否正确).</p>\n<h2>过程</h2>\n<h3>代码转换</h3>\n<p>　　在进行代码转换的时候,首先要明白代码转换的目的才能明确对不同文件的转换策略.比如为了实现同构将client端的代码转换成server端可以运行的代码,对不同类型CSS文件的不同处理策略.通常借助于webpack来实现代码的转换功能.webpack会根据入口文件依次的解析引用的各种文件类型,通过配置的webpack loader可以实现对应文件类型的转换.以下主要从不同类型文件处理的角度进行介绍:</p>\n<h4>javascript</h4>\n<p>转换的目标是client端的代码(排除node_modules).\n将client转换成server端可以运行的代码\n<img src=\"./javascriptbasestatic/isomorphism/srctolib.png\" alt=\"srcToLib\"></p>\n<h4>css</h4>\n<p>对于CSS可以有以下两种的处理方法:</p>\n<ol>\n<li>css-in-js (css-loader style-loader)处理,包括node_modules,client端不需要提取的CSS</li>\n<li>client端全局样式或者通过mini-css-extract-plugin提取的样式</li>\n</ol>\n<h4>代码转换优化</h4>\n<h5>公有代码提取</h5>\n<p>可以使用DllPlugin对使用的基础组件库进行统一的提取和引用.提取公有模块代码主要有以下的好处:</p>\n<ol>\n<li>通过DllPlugin对公有代码的提取,能一定程度上加快webpack构建代码的速度</li>\n<li>公有部分的逻辑相对来说是变化的较少,可以充分的利用缓存</li>\n<li>减少其他bundle的体积,页面加载的资源更少</li>\n</ol>\n<p><img src=\"./javascriptbasestatic/isomorphism/dll.png\" alt=\"dll\"></p>\n<h5>加快编译速度</h5>\n<p>可以使用happyPack加快编译速度,happyPack通过多进程的方式来加快代码的打包过程.\n使用happyPack的例子:\n<img src=\"./javascriptbasestatic/isomorphism/happy1.png\" alt=\"happyPack\">\n<img src=\"./javascriptbasestatic/isomorphism/happy2.png\" alt=\"happyPack\"></p>\n<h3>资源匹配</h3>\n<h4>静态资源(CSS js)</h4>\n<p>可以通过webpack-manifest-plugin生成资源的位置信息文件,然后通过该文件查找资源的位置.\n资源位置文件\n<img src=\"./javascriptbasestatic/isomorphism/manifest1.png\" alt=\"manifest\">\n通过manifest查找资源的位置\n<img src=\"./javascriptbasestatic/isomorphism/manifest2.png\" alt=\"manifest\"></p>\n<h4>data</h4>\n<ol>\n<li>server端执行匹配到组件的获取数据的方法(返回promise),primose执行完毕获取到最新的数据储存.将数据通过脚本挂载到window上的属性上.</li>\n<li>client端通过window属性的获取,生成存储数据.</li>\n</ol>\n<p>服务端获取数据和注入数据\n<img src=\"./javascriptbasestatic/isomorphism/serverStore.png\" alt=\"serverStore\">\nclient端提取数据\n<img src=\"./javascriptbasestatic/isomorphism/clientStore.png\" alt=\"clientStore\"></p>\n<h2>扩展性</h2>\n<h3>配置单页是否支持服务端渲染</h3>\n<p>通过中间项配置是否支持服务端渲染\n<img src=\"./javascriptbasestatic/isomorphism/configServerRender.png\" alt=\"configServerRender\"></p>\n<h2>思考</h2>\n<p>在是否在项目中使用同构应用的时候,还是要结合具体的场景.可以有以下的几点考虑:</p>\n<ol>\n<li>项目中是否需要进行服务端渲染 => 使用者角度</li>\n<li>是否有引入node中间层(api转发)的必要, 其他的替代方案是否可行(nginx) => 整体设计的角度</li>\n</ol>","fields":{"readingTime":{"text":"5 min read"}},"frontmatter":{"title":"如何构建一个WEB同构应用","date":"2019-04-24","tags":"工程化","path":"/iosmorphism","top":null,"summary":null}}},{"node":{"id":"8ffc1de2-ace1-5c44-a4a5-a422b43a1af7","html":"<h2>函数</h2>\n<h3>函数声明</h3>\n<p>函数声明包含函数的名字,形参列表,返回值列表(可选)以及函数体构成.</p>\n<pre><code>func name(parameter-list) (result-list) {\n  body\n}\n</code></pre>\n<p>需要注意一下几点:</p>\n<ol>\n<li>\n<p>函数的形参列表和返回值列表组成函数的签名,函数的签名会在函数被调用的时候做校验是否调用合法.</p>\n</li>\n<li>\n<p>参数的传递是按值传递的.当传递引用类型作为实参的时候,可能会修改实参变量.</p>\n</li>\n<li>\n<p>支持多返回值.</p>\n<p>func test(a [3]int) (int x, int y) {\nreturn x, y\n}\nfunc add(vals ...int) int {  // 变长参数声明\nsum := 0\nfor _, v := range vals {\nsum += v\n}\nreturn sum\n}</p>\n</li>\n</ol>\n<h4>函数变量声明</h4>\n<p>函数声明只能定义在包级别的作用域,函数变量声明可以在任何表达式内指定.函数变量生命能获取到整个词法环境(可以访问外部的变量)</p>\n<pre><code>func test() func(int) int {\n  x := 2\n  return func (y int) int {\n    return x * y\n  } // 这里的函数变量(匿名函数)可以访问到外部的x\n}\n</code></pre>\n<h3>函数流程控制</h3>\n<h4>defer</h4>\n<p>defer语句是普通的函数调用,defer语句能确保函数的return语句或函数执行完毕之后执行对应的defer函数.主要为了在函数的执行完毕后做特定的行为.</p>\n<pre><code>func test(x int) int {\n    defer func() { fmt.Print(x) }() // defer语句必须返回一个可执行的语句\n    return x\n} // 这个函数会在返回后打印入参\n</code></pre>\n<h2>方法</h2>\n<h3>方法声明</h3>\n<p>方法是声明特定类型(对象)上可以执行的函数. 通常可以使用如下的方式声明:</p>\n<pre><code>func (p structName) funcName(parameter-list) (result-list) {\n  body\n}  \n// 声明可以在p类型上调用funcName的方法 \nfunc (p Point) add() int {\n  return p.x + p.y\n}\np := Point{ 2, 3}\n  p.add()\n</code></pre>\n<p>注意:</p>\n<ol>\n<li>由于方法的调用是p.funcName和获取p结构体上的属性一致,要注意同一类型上的命名冲突.</li>\n</ol>\n<h3>指针接收者方法</h3>\n<p>由于方法会复制实参,当需要方法的调用对外界产生影响的时候,就需要通过指针类型来完成方法的声明,如下面的例子:</p>\n<pre><code>type Point struct {\n  x, y int\n}\n\nfunc (p *Point) ScaleBy(factor int) {\n  p.x *= factor\n  p.y *= factor\n}\n\nfunc main() {\n  p := &#x26;Point{10, 10} // 获取指针\n  p.ScaleBy(2) // p{20, 20}\n  q := Point{1,2}\n  q.ScaleBy(3)  // q{3,6} 当类型符合的时候,会进行隐式转换 相当于 (&#x26;q).ScaleBy(3)\n}  \n</code></pre>\n<h3>方法变量和方法表达式</h3>\n<h4>方法变量</h4>\n<p>可以将一个特定类型的方法赋值给一个变量,这个变量称为方法变量.该方法变量已绑定到特定的接收者上(caller),通过传递形参就可以完成方法的调用.通常用于绑定特定的接受者.</p>\n<pre><code>type Point struct {\n  x, y int\n}\n\nfunc (p *Point) ScaleBy(factor int) {\n  p.x *= factor\n  p.y *= factor\n}\n\nfunc main() {\n  p := &#x26;Point{10, 10}\n  scaleBy := p.ScaleBy\n  scaleBy(2) // p{20, 20}\n}  \n</code></pre>\n<h4>方法表达式</h4>\n<p>方便表达式必须在调用的时候,提供接受者.方法表达式是把对应结构的函数行为进行声明.</p>\n<pre><code>type Point struct {\n  x, y int\n}\n\nfunc (p *Point) ScaleBy(factor int) {\n  p.x *= factor\n  p.y *= factor\n}\n\nfunc main() {\n  p := &#x26;Point{10, 10}\n  scaleBy := (*Point).ScaleBy // 方法表达式\n  scaleBy(p,2)\n}\n</code></pre>","fields":{"readingTime":{"text":"5 min read"}},"frontmatter":{"title":"go语言入门之-函数和方法","date":"2019-04-19","tags":"Go","path":"/go-func","top":null,"summary":null}}}],"pathPrefix":"","first":false,"last":false,"index":12,"pageCount":15,"additionalContext":{"pageAllCount":89}}},"staticQueryHashes":[]}