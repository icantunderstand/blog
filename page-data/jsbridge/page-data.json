{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/jsbridge",
    "result": {"data":{"markdownRemark":{"html":"<p>Hybrid混合开发相对于单一的客户端开发有着开发周期短，迭代快的优势，但是Hybrid模式开发的页面存在着一定的缺陷，比如性能问题、缺乏客户端能力等。通过JSBridge这个桥梁可以实现客户端能力的打通，赋予了Hybrid应用更强的端能力。\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 838px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b3d8e916f6b411fbcf30d403e8bb1cde/a1dd2/JSBridge.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABcElEQVQ4y42U2Y7CMAxF+/8/SJ8qSksXukJXKNSjY8lVBmZEI0W249wb23HiDcMgZVlKVVVSFIX0fS+Px0Pn7XbT9bqudaKz3/xd121Y5DiO4qHgZCABLssi9/tdzuezbmY2TbPZz+dT/WDXdVUsNj7PNjAgAggxG06nk8zzLFEUSdu2moFLiG7DglFCiN4JIcqyTNI0VcnkAPxuhLsJAcRxLFZj6nm5XD5S/kpIagDQIbTakS4S+/V6bQT/ElJcZJ7neltERJqskT4AOgD/NE2qUw4G2A9CUiMy3/cVFIahBEGgAFKjRYjscDhs0aIzOByOj5St9wBatNfrVcuANNuyIf2vNWTRLuV4PCoZkZI+NSVaMqEMu2/Z6kZE2OyB2Ozdt8yi2zbUyYjQqes7ob2UX4TUjIF0Ce2FJEmipDQ2oL9eCmsbIRdBqwC2t2wp2+fAQdguoX0mdIhhPYAQ2qTH7DfhENoFEBP93e9i4foBsVCB7aDDCl4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"JS\"\n        title=\"JS\"\n        src=\"/static/b3d8e916f6b411fbcf30d403e8bb1cde/a1dd2/JSBridge.png\"\n        srcset=\"/static/b3d8e916f6b411fbcf30d403e8bb1cde/63868/JSBridge.png 250w,\n/static/b3d8e916f6b411fbcf30d403e8bb1cde/0b533/JSBridge.png 500w,\n/static/b3d8e916f6b411fbcf30d403e8bb1cde/a1dd2/JSBridge.png 838w\"\n        sizes=\"(max-width: 838px) 100vw, 838px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span><br>\nJSBridge作为客户端和H5的通信的桥梁，可以承接如下的能力:</p>\n<ul>\n<li>鉴权能力 JSBridge调用能力鉴权，白名单，黑名单等</li>\n<li>胶水能力 JSBridge兼容代码，做版本控制等调用透明</li>\n<li>测试能力 提供测试方法，方便测试</li>\n<li>Scope(配置)能力 能基于配置产出精简版、目标版本JSBridge</li>\n</ul>\n<p>下面以Android代码为例，介绍JSBridge的实现方式。</p>\n<h2>Js调用Native</h2>\n<p>Js调用Native通常有如下的方案:</p>\n<ul>\n<li>拦截请求(shouldOverrideUrlLoading/shouldInterceptRequest)</li>\n<li>拦截特定方法(prompt/alert/confirm)</li>\n<li>客户端注入JSBridge(addJavascriptInterface)</li>\n</ul>\n<h3>拦截请求</h3>\n<p>在安卓初始化Wevview的时候可以设定WebViewClient，WebViewClient主要功能是处理Webview加载时的通知和请求事件等。通过重写WebViewClient的shouldOverrideUrlLoading/shouldInterceptRequest就可以实现拦截h5的请求从而实现端能力调用。\n实现思路如下:</p>\n<ul>\n<li>定义JSBridge实现Jsb方法</li>\n<li>定义JSBManager管理Jsb的调用</li>\n<li>实现拦截方法的重写</li>\n<li>H5侧调用</li>\n</ul>\n<h4>定义JSBridge方法类</h4>\n<pre><code>// 以下例子均省略import语句 \npublic class JSBridge {\n  // 需要考虑callback和入参一致性问题\n  public void showToast(JSONObject jsonObject) {\n      try {\n          Toast.makeText(MainActivity.context, jsonObject.getString(\"content\"), Toast.LENGTH_LONG).show();\n      } catch(Exception e) {\n      }\n  }\n}\n</code></pre>\n<h4>定义JSBManager管理Jsb的调用</h4>\n<pre><code>public class JsbManager {\n  // 通过HashMap获取JSBridge定义的所有方法\n  public static Map&#x3C;String, Method> methodMap = new HashMap&#x3C;>();\n  public void init() {\n      Method[] methods = JSBridge.class.getDeclaredMethods();\n      for(Method method : methods) {\n          methodMap.put(method.getName(), method);\n      }\n  }\n}\n</code></pre>\n<h4>实现拦截方法的重写</h4>\n<p>以下以shouldOverrideUrlLoading方法的重写为例子。在例子中定义的通信协议是myjsb://method?params。通过在拦截方法中对请求进行解析就可以实现调用对应客户端method的逻辑。</p>\n<pre><code>public class CustomWebViewClient extends WebViewClient {\n    private JsbManager jsbManager = new JsbManager();\n    private JSBridge jsBridge = new JSBridge();\n    public void initJsb() {\n        // 初始jsbManager和jsBridge实例\n        jsbManager.init();\n        jsBridge = new JSBridge();\n    }\n    @Override\n    public boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request) {\n        // 处理jsb 协议情况  只拦截jsb协议的url 其他放行\n        Uri uri = request.getUrl();\n        String scheme = uri.getScheme();\n        if(scheme.equals(new String(\"myjsb\"))) {\n            // 获取方法名 入参\n            String methodName = uri.getAuthority();\n            String query = uri.getQuery();\n            try {\n                JSONObject jsonObject = new JSONObject(query);\n                Method method = jsbManager.methodMap.get(methodName);\n                // 调用对应的客户端逻辑\n                method.invoke(jsBridge,jsonObject);\n            } catch(Exception e) {\n                e.printStackTrace();\n            }\n        }\n        return super.shouldOverrideUrlLoading(view, request);\n    }\n}\n// 主活动代码逻辑\npublic class MainActivity extends AppCompatActivity {\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        // 创建WebViewClient\n        CustomWebViewClient webViewClient = new CustomWebViewClient();\n        // 调用JSBridge初始逻辑\n        webViewClient.initJsb();\n        WebView webView = (WebView) findViewById(R.id.webView);\n        // 设置WebViewClient处理webviewt通知，请求等\n        webView.setWebViewClient(webViewClient);\n        // 开启调试功能\n        webView.setWebContentsDebuggingEnabled(true);\n        WebSettings webSettings = webView.getSettings();\n        // 允许执行JS\n        webSettings.setJavaScriptEnabled(true);\n        // 这里加载项目本地的html文件方便调试\n        webView.loadUrl(\"file:///android_asset/index.html\");\n    }\n}\n</code></pre>\n<h4>H5侧调用</h4>\n<pre><code>    &#x3C;body>\n        &#x3C;div>this page test JSB&#x3C;/div>\n        &#x3C;script>\n          // 通过创建iframe发起JSBridge调用\n          function iframeCall(url) {\n            let iframe = document.createElement('iframe')\n            iframe.src = url\n            iframe.style.display = 'none'\n            document.documentElement.appendChild(iframe)\n            setTimeout(() => { document.documentElement.removeChild(iframe) })\n          }\n          function callJsb(method, params) {\n            let url = `myjsb://`\n            if(!method) {\n              return\n            }\n            url += `${method}`\n            if(!!params) {\n              url += `?${encodeURIComponent(JSON.stringify(params))}`\n            }\n            iframeCall(url)\n          }\n          callJsb('showToast', { content: 'xiaohong' })\n        &#x3C;/script>\n    &#x3C;/body>\n</code></pre>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 688px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/69c4f6e5f0ec62ff288282e3bb7c3890/ebf47/overrideUrlCall.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 196.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAnCAYAAAAPZ2gOAAAACXBIWXMAABYlAAAWJQFJUiTwAAADEklEQVRIx+1US09TQRQeGwh90Pb29kFppQ9BVAghGjfqQorFaNyZCCt3CBSoMa6IhkRiDCYmBqMxRU34ObSEFlalYCIkbuTRCra29N62n5nR2/SF1IorPMmXc+Y7c89jZs4lOl4DTq+AoUmL5pNGaHRyaHkldAYleKOS+ZpbeLQ4TeAMCuiMyiLwRhXbr9UrwPFqEDN/Gm36PrTqXWhvuoZzVjfOWtxw6lywq3tg1/TAoXHBoXUxuxA2dQ/aDL3otLlxpqkPdlM3SLuqH/dsn3DXGoK3O8zwuPcj7nBB9BE/bpIAblQA5am/nwth4moEE5c+w+2YArmoHsQDkoOH7GCUfIW3fpfpMbKLcdkuxk/8QqFdwNF9w2QH94kIt3wG5Hz9MJ5bgVeXU3h5QcSHWxk84gSMkTS8VWKcJPGQANfr34JcMQ/hRTvwrCOO6c4UpjtSeNqaxJQjiSlndXjijGP6FHDb+gZkaNADiMDulzTi21nEd7JIRLP4Hqse37YFQABez/hARsdGQSVLo9YoOWSYfvd+FsTj8bCFIIjIZXM1QRR+FjPrKwgoiiJyuVxNFdJvWcDZ/wGPacBS5B/vb5JVDJjJZA6ehEMqrxgwlUpBEASk02kGuml/fz8frOoKR0ZGsLm5iXA4jOXlZaytrWF1dRXr6+uMq7llqSrp7LLZ7N+1LJGlZ/fHLf+zWz7mo1eoDzrXwuSHXkrpDR80OZKuusJq7aqejfTYY7EYtra2GKLRKJLJZFkHZaNHhc4t/UEUIpFIYGNjA0tLSwyRSAR7e3tl+2hiKj6fD8Tr9eKoZG5uDmRgYID9DBYWFhAMBrG4uAi/389silAoxHyBQIDZEjc/P5//huqVlRVMTk6CKJVKEEKKwHFc0Voul0Or1RZxFosFKpWqiKurqwNpbGwsIx0ORxFnMplgs9mYLZPJmO7q6oLZbC5LTHQ6HdRqdR40AXVIa41GA4VCwThqS1xDQwNodxJHwTozGAwwGo1FoBUdxlXaQ2MRvV6PowSx2+3geZ5Fp5Ac0rqUK/UX8rTKH4LefgGruMzUAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"拦截请求实现调用\"\n        title=\"拦截请求实现调用\"\n        src=\"/static/69c4f6e5f0ec62ff288282e3bb7c3890/ebf47/overrideUrlCall.png\"\n        srcset=\"/static/69c4f6e5f0ec62ff288282e3bb7c3890/63868/overrideUrlCall.png 250w,\n/static/69c4f6e5f0ec62ff288282e3bb7c3890/0b533/overrideUrlCall.png 500w,\n/static/69c4f6e5f0ec62ff288282e3bb7c3890/ebf47/overrideUrlCall.png 688w\"\n        sizes=\"(max-width: 688px) 100vw, 688px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>使用iframe发送消息的方式会存在消息丢失，参数限制等问题，可以通过消息队列和拦截shouldInterceptRequest方法来实现。</p>\n<h3>拦截特定方法</h3>\n<p>在初始化WebView的时候可以同步设置WebChromeClient，WebChromeClient主要是辅助WebView处理Js对话框，标题等操作，通过拦截WebChromeClient相应的方法同样可以实现调用端能力。</p>\n<h4>实现WebChromeClient</h4>\n<pre><code>public class CustomWebChromeClient extends WebChromeClient {\n    @Override\n    public boolean onJsPrompt(WebView view, String url, String message, String defaultValue, JsPromptResult result) {\n        // 此处举例为主 直接弹端toast\n        // 实现上跟拦截url一致\n        Log.d(\"mesage\", message.startsWith(\"myjsb\")+ \"\");\n        if(message.startsWith(\"myjsb\")) {\n            Toast.makeText(MainActivity.context, \"PropmtCall\", Toast.LENGTH_LONG).show();\n            // 此时js调起了 需要JsPromptResult.confirm(result)\n            return true;\n        } else {\n            return super.onJsPrompt(view, url, message, defaultValue, result);\n        }\n    }\n}\n// 在初始化WebView的时候设置WebChromeClient\nCustomWebChromeClient webChromeClient = new CustomWebChromeClient();\nwebView.setWebChromeClient(webChromeClient);\n</code></pre>\n<h4>H5调用</h4>\n<pre><code>    window.prompt('myjsb://')\n</code></pre>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 688px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a06b5060a7a0c62f3aa004ed02d87c42/ebf47/overridePrompt.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 199.60000000000002%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAoCAYAAAD+MdrbAAAACXBIWXMAABYlAAAWJQFJUiTwAAADEklEQVRIx+2U309bVRzAD9BCgdv23tt7ewsKq6nIBnWLcWYJ0RfjlLin6UzmHjQLyWYcbcfMKsZkPvrj0YRAoegMITz45xAShiYGWGIMIUQEWlrbjzmnu3jpHIPFx57kk/P9fs/3+znn9qGipydOxLSJOd040S5sK4ptOVgRBzviYJlRumLPKWSsah5kb9SOKceLiT6EbnYSMv3YsTCmrdEZ8qOFW9GtNoxogLDVSnevTlePrmLDDih0+9F5JIAWaqUz7Cesa4g+4xIX7HFes8d486XPuTj4BW+dGedccIyBtgzJ9tsMtKUVycBtBgMZhayf8acZev4ub788zjsDX5FwhhCva99yvf0PPgr+Sjr+kNHeh2STv3PV9wvviQdcESsHvO9B5pfFA64bv3E3uc6XyR1etUYQ77ZPcS8E48ZfZLVd7nXvkRK7jDXtcaelcDS+Ahmxx6fiT+4IuKDdQlwUOb4+Bd+d3eOb0/t8P7RPShS5KQp8cmx2yAg43zaKuPFGjoVrMPvBLvevFvnhSpGfrp2MHz/c4eeP4dK5UcT9uVlqqwxUH8XVE1JWU2OfZRD5fE1YKpWpVDg5f1cp7deE6XQGMTtbE5bLZarV6jMhZ+XKZOqEz7IawoawIWwIG8JjCt1/YW9cT/3ZU4Xe/Umv8kqf+snuQKVSOUDW3Lhe+kSh95Pk4NbWFqurq6ytral9fX2d7e3to184MzOjkmKxqA5KpZLaZb6xscHKygqLi4ssLS2xvLzM5ubmQY9LoVBQjlQqhVhYWOD/WtlsFjEyMsLc3BzT09Pk83lyuRyTk5MqlsifROZTU1MqdusTExOHZubn5xkeHkYIIahH07RDeTAYxOfzHaolEonH5lRPR0cHLS0tKmlublYyx3FoamrC7/erPRaLYZqmimWfpL+/X/XKGZlLh7xYyEZd1xWGYRAOh9WBjN2aHAyFQgc1iXyI7PXWpEtYto1t21iWpbDr8uPW3FiYeu2WSCRyJLL5v2IX5TANxOmz54mf6sWy/r3NHfLiFdWfSV6Ix+kbfIV/AHs5ocTNraY7AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"重写Prompt方法调用\"\n        title=\"重写Prompt方法调用\"\n        src=\"/static/a06b5060a7a0c62f3aa004ed02d87c42/ebf47/overridePrompt.png\"\n        srcset=\"/static/a06b5060a7a0c62f3aa004ed02d87c42/63868/overridePrompt.png 250w,\n/static/a06b5060a7a0c62f3aa004ed02d87c42/0b533/overridePrompt.png 500w,\n/static/a06b5060a7a0c62f3aa004ed02d87c42/ebf47/overridePrompt.png 688w\"\n        sizes=\"(max-width: 688px) 100vw, 688px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>客户端注入JSBridge</h3>\n<p>通过<a href=\"https://developer.android.com/reference/android/webkit/WebView#addJavascriptInterface(java.lang.Object,%20java.lang.String)\">addJavascriptInterface</a>可以在初始化WebView的时候将客户端的调用逻辑暴露给H5。</p>\n<h4>实现JSInterface</h4>\n<pre><code>    public class JsInterface {\n        private Context context;\n        public JsInterface(Context context) {\n            this.context = context;\n        }\n        // JsInterface需要用@JavascriptInterface注解才可以被调用\n        @JavascriptInterface\n        public void showToast(String content) {\n            Toast.makeText(this.context, content, Toast.LENGTH_LONG).show();\n        }\n    }\n\n    // 在初始WebView的时候注入interface\n    webView.addJavascriptInterface(new JsInterface(context), \"myjsb\");\n</code></pre>\n<h4>H5调用</h4>\n<pre><code>    window.myjsb.showToast(\"Interface\")  \n</code></pre>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 688px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ed43999980c970f7b14ebacfdbb9cd6b/ebf47/callInterface.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 200.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAoCAYAAAD+MdrbAAAACXBIWXMAABYlAAAWJQFJUiTwAAADaklEQVRIx+2Vy09TQRTGB+jDK9D29j76UEyJIo9gfGCqJmowrtwQaMHIxoWJ8rJaCUaif4EL3oSFqAs3rliZCBFiXLKHiCECoRASiLzEtpT29jMz9dbyqoXgSif5Zc75euabczt3cslZ52UIvABZssJqOQJJlCGJFoYoUGTIkg1221EWx7Tf0DpZis1Wiw3EaMqEwawDL3Gw2HlkGjXIMupgEHTgZT2Mog6SPQs5uQJMkp7Bb5oPsfoskxYGEwdi54vhtD1AidyAi8fuo7TAi2uFXpRIDcjX16DocC0KuRoUHKpBIVcbp4irRYG+Bqf5elwv9uLq8Uacc1SBnDDcwF3Rh9vZX1F/bBqeXB+enJnDHWECZeQzXOTLrpSTMdzSj6Pp1AyeFH9DleMtyCmDC03aEJpNfjRxP/BM8sOr+YEHxI9GTQCPMnanMSMAb1oA9eQ7HpII3BnvQAp0LjRnRtB+IYTnRSF0X9nAUz6EeySIOhJEbQrUkQA8BKgg70Eu5bnwuiKMF2VBvCwPorcsiN7yIF651vGqIpgSvRUBvKkEHpe+B6m6WYnYUABE90mEOXz8NAhS6Y4ZKpEoFCWKqII9EwkrzOPDB2pY+cuQmkX3RyQS63BwMMFQ/XE/47/hP2uoKApjp/dM3XBPhsnGnzrfZri6uspYXFzE0tISVlZWWL6wsMC6TrXDvr4+ELfbjdnZWUxPT2NkZASTk5Ms9/l8GB8fjxenYtjf33+wjzw0NPQXD+X/TTlYw8Q52SGpcVLDVE51a82eOqTF6uukxls3/GOHanEoFML8/DympqbYDZqbm8Pa2lryjxS9elTc2NjYRDgcht/vx8zMDMbGxjA6OoqJiQksLy9vq11fX2eGAwMDINXV1TioMTw8DOJ0OtHd3Y2Ojg50dnayuaWlJZ53dXWhra2NaTSmGoXmra2tLG5vb0dPTw88Hg8Ix3EghGyC5/ltmiAIm3Kr1QqDwbCtjhiNRmg0mjharRYWiwV6vZ7l6enpbKHNZmOxTqdDWloacnJyWB2N6Rpay5qjO9OOEsnOzo7HZrMZdFOq0VjVaE43UjVVJ4IgQpIkiKIYZ2u+k0bzRI3FkgRilUWYTEaYzQL7n3aDLkqWsw55E0je+VLknczHEbt9x85UEo22IssyHA4HjucX4yfjfpxnxqZHBAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"interface调用\"\n        title=\"interface调用\"\n        src=\"/static/ed43999980c970f7b14ebacfdbb9cd6b/ebf47/callInterface.png\"\n        srcset=\"/static/ed43999980c970f7b14ebacfdbb9cd6b/63868/callInterface.png 250w,\n/static/ed43999980c970f7b14ebacfdbb9cd6b/0b533/callInterface.png 500w,\n/static/ed43999980c970f7b14ebacfdbb9cd6b/ebf47/callInterface.png 688w\"\n        sizes=\"(max-width: 688px) 100vw, 688px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Native调用Js</h2>\n<p>Nativa调用Js通常有如下的方案:</p>\n<ul>\n<li><a href=\"https://developer.android.com/reference/android/webkit/WebView#loadUrl(java.lang.String)\">loadUrl</a></li>\n<li><a href=\"https://developer.android.com/reference/android/webkit/WebView#evaluateJavascript(java.lang.String,%20android.webkit.ValueCallback%3Cjava.lang.String%3E)\">evaluateJavascript</a></li>\n</ul>\n<p>以下例子在H5中都定义了全局函数供Native调用</p>\n<pre><code>    function testNativeCall() {\n      console.log(\"nativeCallJs\")\n      return 'nativeCallJs'\n    }\n</code></pre>\n<h3><a href=\"https://developer.android.com/reference/android/webkit/WebView#loadUrl(java.lang.String)\">loadUrl</a></h3>\n<p>可以通过webView.loadUrl(\"javascript: testNativeCall()\")发起调用(需要等待Js执行完成)。loadUrl的方式会刷新页面且无法获取js的回调。</p>\n<h3><a href=\"https://developer.android.com/reference/android/webkit/WebView#evaluateJavascript(java.lang.String,%20android.webkit.ValueCallback%3Cjava.lang.String%3E)\">evaluateJavascript</a></h3>\n<pre><code>webView.evaluateJavascript(\"javascript: testNativeCall()\", new ValueCallback&#x3C;String>() {\n    @Override\n    public void onReceiveValue(String value) {\n        return;\n    }\n});\n</code></pre>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b941b4ef1b5f1a77e48fa6db88525cb3/1e043/evaluateJS.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 198.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAoCAYAAAD+MdrbAAAACXBIWXMAABYlAAAWJQFJUiTwAAADPUlEQVRIx+1US08TURi9hSK0DG3n1SkEgRYlKAoGVoqPhZqwAF0pJi6MC9EIGoGFBlpRsRF5FAqJEH6AUXGlfwVIWFgKBASBYELaTqFwzL3N1PIqj7AwkZucfI97vnPPdOaW5OblQ+BF2JQs2GxZkCQrZFmBJFoZREFGVmY2A821vgbKtcoKREGC3e4AsQgcMiypkBQzRNkMznQMnCkNFskAQTayaMvmkXmcZzkvG2Ng+6KR8TlzGkxmDqSAv4GrOe9RrrSg4pQbVefaUFXchjLuJYpTnChJdbGo5fEoSmrGlew3uFn6DpVFnTiTUwFSzr1GLf8b9wx+1Np+4rF1Bs8Lf+Gu3o/bxIfqBLhFfuA+N4mG/Bm8OLmMi0oDyHWDBy1mwKkE4FJCeJsfwjNdEPW6EBr1KhqTE0Cvop6EUEeW0UCAS8YmkMvEg1YFaC8Jwn0ijPbiMJ6SEGpICA/3jADqCHBe3wRSc82Db0+Ajw8C+PxIxacaFUO1Kr7WqRiqi8ZEoJwvtUF8rwfulDeDfBjoRXRFcPAVnX3V6gLxeqOCK+EI1iLrB8JqOCrocrpAenujgpFIBOvr6wcCnWWCrm0E97uOBP9rwdXV1W2/MW1op8O2CPb19e3qYF8OOzs7EQwGsbi4iLm5ORaXlpawsLDAsG+HHR0dbHB8fBzDw8OYmprC9PQ0/H4/Jicn/4FHPvSXcnRTDl9w84vYCfGcXR3uxWk8d88ON39Ka2trsd6eHWrkcDiM+fl5+Hy+GCYmJtjVXFlZ2Vmwp6eHFaqqstMpKCEQCGB2dhajo6MMIyMjGBsbY/ed3n3K0fj0cLqcTifI4OAgDmu53W6Q6upqDAwMoLu7G16vl8Wuri7Qn4LWNNLa4/HEehT0T0WboU/Z39+PyspKEEIINsNisWyozWYzDAbDhl5hYeGWueTkZJD09HSW6PV6JCUlwWg0wmq1spz2dDodZFmGIAgsT0lJYXsOhwMZGRkxHtXgOA6EEnmej4G6o0Stpvu0NplMiOdSI9R5/CzdJ5IkMweSJMWwXb1bT8uJKFBXPERRTAhKTrRHn4xqkdOlF2DPy91wmkaKx3a9v3sSHHY7Cs6W4Q880qCTlgwo4gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"evaluate调用js\"\n        title=\"evaluate调用js\"\n        src=\"/static/b941b4ef1b5f1a77e48fa6db88525cb3/1e043/evaluateJS.png\"\n        srcset=\"/static/b941b4ef1b5f1a77e48fa6db88525cb3/63868/evaluateJS.png 250w,\n/static/b941b4ef1b5f1a77e48fa6db88525cb3/0b533/evaluateJS.png 500w,\n/static/b941b4ef1b5f1a77e48fa6db88525cb3/1e043/evaluateJS.png 690w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>参考</h2>\n<p><a href=\"https://www.zoo.team/article/jsbridge\">小白必看，JSBridge 初探</a>\n<a href=\"https://juejin.cn/post/6844903840588759048\">跨端技能必备之JSBridge</a>\n<a href=\"https://juejin.cn/post/6844903856418062350\">从零开始写一个 JSBridge</a></p>","frontmatter":{"date":"2021-07-07","path":"/jsbridge","title":"Hybrid开发-JSBridge原理"}}},"pageContext":{"readingTime":"7 min read"}},
    "staticQueryHashes": []}