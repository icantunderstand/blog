{"componentChunkName":"component---src-templates-post-js","path":"/rn-list","result":{"data":{"markdownRemark":{"html":"<h2>前言</h2>\n<p>长列表优化是一个老生常谈问题,优化的方案也是相似的(减少内存占用,复用渲染结果,可视区域渲染,预渲染),在跨端开发的React Native中列表主要有FlatList和SectionList两种,以下主要通过对FlatList的介绍来了解React Native中的长列表.</p>\n<h2>FlatList</h2>\n<p>FlatList通过预渲染和可视区域渲染的方案,来降低列表渲染时候的内存占用从而提升页面的性能.下面从FlatList的基础使用来逐渐展开.</p>\n<h3>基本使用</h3>\n<pre><code>renderItem = ({ item, index }) => {\n  return &#x3C;View>&#x3C;Text style={{ color: 'white' }}>{item.name}&#x3C;/Text>&#x3C;/View>\n}\nrender() {\n  return (\n    &#x3C;FlatList\n      data={[{ name: 'a' }, { name: 'b' }, { name: 'c' }, { name: 'd' }]}\n      renderItem={this.renderItem}\n      keyExtractor={item => `${item.name}`}\n    />\n  )\n}\n</code></pre>\n<p>在上面的例子中通过设置data, renderItem(条目渲染函数)就完成了列表的渲染功能</p>\n<h3>结构</h3>\n<p>FlatList数据渲染的原理是通过数据项和底层容器ScrollView的布局事件计算出需要渲染的条目,在滚动过程中动态的更新渲染条目来完成列表的绘制.FlatList渲染的内部结构如下:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 523px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/537a1f30ce767d4c75b99f25fe28c847/3e286/flatList.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 157.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAAAsTAAALEwEAmpwYAAADeElEQVRIx6VWS4/TZhS1xKhQsUfqhkUXlUCCUhYUqZVaCQmVAv+jSEjdTIuEkKpu2k2X7T9ohbqoVAQbEBKLMu9h3knITDJ24vgR5+XxK4kd56BzwenAamJs3Xyfbfn43nPPd74ocRwjDEP0ej0cHBxIuK4r1/1+H3w+HA5lPEoofEnXdTQaDezt7WF/fx+1Wg31eh22bWM0Gk0HGAQBLMtCs9nE7u6uAJZKJZimKfdyATITZrm1tSVZbmxsCHir1UKSJNMBkj+WR2BmtrCwIOUzO8Mwps8wiiIpk80gCMHZEM7JZZqm+UrmwRdZImMwGAi3uThkNr7vo1gsolqtTjLOBUgOydV4PJaXGZyTitwcMivKJJMKM9M0TficmkNmSKBMLmzE+vr6pNPTlxyEMEwDcRqj8LKA+aV56JaOcBCiYTQmgEcJAfQDHx2zg9iJ4Rs+AjOA1/AQ2REcy0E6TpHEiZTO7mc8Z0GQTBkEVRABv1f+wJf2V7hu3cQ31re4Zt/AFfUqnqnPkIQJ3AMX7XZblECNZkZCE6G8OOczgioIgNv2d1AOn66Cr9cv4f7cX3ix+AJaTRN+V1ZWsLS0hLW1NSwvL2N1dVWkVigUZJkyY8nwzv5vUNyzONn9Ase7l3HCvYwZ+yIe1Z8iDRMM4oFkUC6XJ86kqqoogWBUyqGSQ/xY0aH4wAc+MOMBygBQemM81HRZQYM3HPKgRhnZnAcz+x8wDDGra1AwwgzIQYqPWgY+L23iz+f/QS3vouk42N7eFmnRQFgm3YjBe1y6XAT8qIIwwA81C8oYmEkh4ykPuGCGeLBdhKPr8IJAyqM+yeHc3JzwSF4XFxdRqVTE9UU26AN3yn9DMWdx0vwJH5r3cKz1M5TGXTzSVl6bRvJatFz35JJdJQCvOSeHmV6ly983b73dZZ4jBf9a/wAjIBpGb+nt3Ti870iXf1F/xengY3zqXcTZ3jmcDz7DJ60zeFx/AqRAf9g/0iqRDMMoRF2rQ91ToVZUtO02quUqtIoG0zDzb1JOy8Hm1iZ2Cjsoloroub332/W4nbJb7BxNwfM9caHcewplQfXTAzkSnKtiaj8kIMEycrnY+YAGkAuQJTuOg2w7pasw+KFcewqFSkACEJBzOkduQL5I26fiPc+bjLR/usrUJfOHWXY6nUl0u10Jfmzaf1+vACaDAH8XnMbBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"listSection\"\n        title=\"listSection\"\n        src=\"/blog/static/537a1f30ce767d4c75b99f25fe28c847/3e286/flatList.png\"\n        srcset=\"/blog/static/537a1f30ce767d4c75b99f25fe28c847/63868/flatList.png 250w,\n/blog/static/537a1f30ce767d4c75b99f25fe28c847/0b533/flatList.png 500w,\n/blog/static/537a1f30ce767d4c75b99f25fe28c847/3e286/flatList.png 523w\"\n        sizes=\"(max-width: 523px) 100vw, 523px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>FlatList性能优化</h3>\n<h4>减少更新时列表项总体数目和条目的重渲染,</h4>\n<ol>\n<li>列表条目使用PureComponent或者shouldComponentUpdate来减少条目的更新.</li>\n<li>调整windowSize大小(默认是21)</li>\n<li>调整maxToRenderPerBatch的大小,控制每次更新的最大条目</li>\n</ol>\n<h4>减少内存的占用</h4>\n<ol>\n<li>减少匿名函数的使用</li>\n<li>列表条目的渲染逻辑尽量简单</li>\n</ol>\n<h4>减少渲染过程中的计算</h4>\n<ol>\n<li>使用getItemLayout减少列表条目的计算过程</li>\n<li>调整滚动事件的触发频次(scrollEventThrottle)</li>\n<li>在列表项中合理的使用缓存</li>\n<li>渲染过程中减少与Native通信过程,可以使用InteractionManager优化</li>\n</ol>","frontmatter":{"date":"2020-03-22","path":"/rn-list","title":"聊聊React Native中的长列表"}}},"pageContext":{"readingTime":"3 min read"}},"staticQueryHashes":[]}