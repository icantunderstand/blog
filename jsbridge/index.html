<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/blog/styles.f6fe5c0d3468e828962d.css" data-identity="gatsby-global-css">.blog-post{width:100%}.blog-post-content{margin:0 auto;max-width:960px;padding:0 1.0875rem 1.45rem}.blog-footer{align-items:center;display:flex;flex-direction:column;justify-content:flex-start;margin-bottom:30px}.paginate-container{align-items:center;display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin-top:20px;padding-bottom:10px}.paginate-item,.top-post{margin-left:10px}.top-post{color:#1e80ff;display:inline-block;font-size:15px}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;box-sizing:border-box;font:112.5%/1.45em georgia,serif,sans-serif;overflow-y:scroll}body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;word-wrap:break-word;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt";color:rgba(0,0,0,.8);font-family:georgia,serif;font-kerning:normal;font-weight:400;margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{-webkit-text-decoration-skip:objects;background-color:transparent;text-decoration:none}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help;text-decoration:none}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}img{border-style:none;margin:0 0 1.45rem;max-width:100%;padding:0}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace;font-size:1em}hr{background:rgba(0,0,0,.2);border:none;box-sizing:content-box;height:1px;margin:0 0 calc(1.45rem - 1px);overflow:visible;padding:0}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}*,:after,:before{box-sizing:inherit}ol,ul{list-style-image:none;list-style-position:outside;margin:0 0 1.45rem 1.45rem}ol,p,ul{padding:0}p,pre{margin:0 0 1.45rem}pre{word-wrap:normal;background:rgba(0,0,0,.04);border-radius:3px;font-size:.85rem;line-height:1.42;overflow:auto;padding:1.45rem}table{border-collapse:collapse;font-size:1rem;line-height:1.45rem;margin:0 0 1.45rem;padding:0;width:100%}blockquote{margin:0 1.45rem 1.45rem;padding:0}form,noscript{margin:0 0 1.45rem;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:.725rem;margin-left:1.45rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}td,th,thead{text-align:left}td,th{font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";border-bottom:1px solid rgba(0,0,0,.12);padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{content:" ";letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}</style><meta name="generator" content="Gatsby 3.9.0"/><style data-emotion="mantine "></style><title data-react-helmet="true"></title><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="icon" href="/blog/favicon-32x32.png?v=1a4023285f20ec8ca43a96875f92c5b2" type="image/png"/><link rel="manifest" href="/blog/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/blog/icons/icon-48x48.png?v=1a4023285f20ec8ca43a96875f92c5b2"/><link rel="apple-touch-icon" sizes="72x72" href="/blog/icons/icon-72x72.png?v=1a4023285f20ec8ca43a96875f92c5b2"/><link rel="apple-touch-icon" sizes="96x96" href="/blog/icons/icon-96x96.png?v=1a4023285f20ec8ca43a96875f92c5b2"/><link rel="apple-touch-icon" sizes="144x144" href="/blog/icons/icon-144x144.png?v=1a4023285f20ec8ca43a96875f92c5b2"/><link rel="apple-touch-icon" sizes="192x192" href="/blog/icons/icon-192x192.png?v=1a4023285f20ec8ca43a96875f92c5b2"/><link rel="apple-touch-icon" sizes="256x256" href="/blog/icons/icon-256x256.png?v=1a4023285f20ec8ca43a96875f92c5b2"/><link rel="apple-touch-icon" sizes="384x384" href="/blog/icons/icon-384x384.png?v=1a4023285f20ec8ca43a96875f92c5b2"/><link rel="apple-touch-icon" sizes="512x512" href="/blog/icons/icon-512x512.png?v=1a4023285f20ec8ca43a96875f92c5b2"/><link as="script" rel="preload" href="/blog/webpack-runtime-cd2b8b170d1edfbc5bdd.js"/><link as="script" rel="preload" href="/blog/framework-3d02c8ebec6630f3dd7b.js"/><link as="script" rel="preload" href="/blog/app-1e724ae62e17afbb6a4a.js"/><link as="script" rel="preload" href="/blog/ef6529d7-5a6a50512fe36621eba5.js"/><link as="script" rel="preload" href="/blog/a26abbfb03f25b9cd2b611d1d937ab5e796b3999-aee6059b7da925927d7f.js"/><link as="script" rel="preload" href="/blog/a1bcc4c524c8e4b3dd399f438a1f77ebab5ca6a2-7a9d7554fbc318dfe3bd.js"/><link as="script" rel="preload" href="/blog/6ba5cc0c8669d68fb0f844125a981d8f12367a97-82630eaaa7421feb857b.js"/><link as="script" rel="preload" href="/blog/component---src-templates-post-js-fa41477def220f95ebf1.js"/><link as="fetch" rel="preload" href="/blog/page-data/jsbridge/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="mantine-AppShell-root mantine-1272lc7" data-barba="wrapper"><header class="mantine-Header-root mantine-1elgxm6"><a href="/blog/"><div class="mantine-1ln4pgh"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-ghost" width="30" height="30" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 11a7 7 0 0 1 14 0v7a1.78 1.78 0 0 1 -3.1 1.4a1.65 1.65 0 0 0 -2.6 0a1.65 1.65 0 0 1 -2.6 0a1.65 1.65 0 0 0 -2.6 0a1.78 1.78 0 0 1 -3.1 -1.4v-7"></path><line x1="10" y1="10" x2="10.01" y2="10"></line><line x1="14" y1="10" x2="14.01" y2="10"></line><path d="M10 14a3.5 3.5 0 0 0 4 0"></path></svg><div class="mantine-Text-root mantine-1pbxw0k">noodles的笔记本</div></div></a><style data-emotion="css-global nn3xf4">:root{--mantine-header-height:70px;}</style></header><div class="mantine-ibbm6b mantine-AppShell-body"><main class="mantine-d5iwcx mantine-AppShell-main"><div class="mantine-1w0809u"><div class="blog-post"><h1 class="blog-post-content">Hybrid开发-JSBridge原理</h1><div class="blog-post-content">7 min read</div><div class="blog-post-content"><p>Hybrid混合开发相对于单一的客户端开发有着开发周期短，迭代快的优势，但是Hybrid模式开发的页面存在着一定的缺陷，比如性能问题、缺乏客户端能力等。通过JSBridge这个桥梁可以实现客户端能力的打通，赋予了Hybrid应用更强的端能力。
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 838px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/blog/static/b3d8e916f6b411fbcf30d403e8bb1cde/a1dd2/JSBridge.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 75.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABcElEQVQ4y42U2Y7CMAxF+/8/SJ8qSksXukJXKNSjY8lVBmZEI0W249wb23HiDcMgZVlKVVVSFIX0fS+Px0Pn7XbT9bqudaKz3/xd121Y5DiO4qHgZCABLssi9/tdzuezbmY2TbPZz+dT/WDXdVUsNj7PNjAgAggxG06nk8zzLFEUSdu2moFLiG7DglFCiN4JIcqyTNI0VcnkAPxuhLsJAcRxLFZj6nm5XD5S/kpIagDQIbTakS4S+/V6bQT/ElJcZJ7neltERJqskT4AOgD/NE2qUw4G2A9CUiMy3/cVFIahBEGgAFKjRYjscDhs0aIzOByOj5St9wBatNfrVcuANNuyIf2vNWTRLuV4PCoZkZI+NSVaMqEMu2/Z6kZE2OyB2Ozdt8yi2zbUyYjQqes7ob2UX4TUjIF0Ce2FJEmipDQ2oL9eCmsbIRdBqwC2t2wp2+fAQdguoX0mdIhhPYAQ2qTH7DfhENoFEBP93e9i4foBsVCB7aDDCl4AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="JS"
        title="JS"
        src="/blog/static/b3d8e916f6b411fbcf30d403e8bb1cde/a1dd2/JSBridge.png"
        srcset="/blog/static/b3d8e916f6b411fbcf30d403e8bb1cde/63868/JSBridge.png 250w,
/blog/static/b3d8e916f6b411fbcf30d403e8bb1cde/0b533/JSBridge.png 500w,
/blog/static/b3d8e916f6b411fbcf30d403e8bb1cde/a1dd2/JSBridge.png 838w"
        sizes="(max-width: 838px) 100vw, 838px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span><br>
JSBridge作为客户端和H5的通信的桥梁，可以承接如下的能力:</p>
<ul>
<li>鉴权能力 JSBridge调用能力鉴权，白名单，黑名单等</li>
<li>胶水能力 JSBridge兼容代码，做版本控制等调用透明</li>
<li>测试能力 提供测试方法，方便测试</li>
<li>Scope(配置)能力 能基于配置产出精简版、目标版本JSBridge</li>
</ul>
<p>下面以Android代码为例，介绍JSBridge的实现方式。</p>
<h2>Js调用Native</h2>
<p>Js调用Native通常有如下的方案:</p>
<ul>
<li>拦截请求(shouldOverrideUrlLoading/shouldInterceptRequest)</li>
<li>拦截特定方法(prompt/alert/confirm)</li>
<li>客户端注入JSBridge(addJavascriptInterface)</li>
</ul>
<h3>拦截请求</h3>
<p>在安卓初始化Wevview的时候可以设定WebViewClient，WebViewClient主要功能是处理Webview加载时的通知和请求事件等。通过重写WebViewClient的shouldOverrideUrlLoading/shouldInterceptRequest就可以实现拦截h5的请求从而实现端能力调用。
实现思路如下:</p>
<ul>
<li>定义JSBridge实现Jsb方法</li>
<li>定义JSBManager管理Jsb的调用</li>
<li>实现拦截方法的重写</li>
<li>H5侧调用</li>
</ul>
<h4>定义JSBridge方法类</h4>
<pre><code>// 以下例子均省略import语句 
public class JSBridge {
  // 需要考虑callback和入参一致性问题
  public void showToast(JSONObject jsonObject) {
      try {
          Toast.makeText(MainActivity.context, jsonObject.getString("content"), Toast.LENGTH_LONG).show();
      } catch(Exception e) {
      }
  }
}
</code></pre>
<h4>定义JSBManager管理Jsb的调用</h4>
<pre><code>public class JsbManager {
  // 通过HashMap获取JSBridge定义的所有方法
  public static Map&#x3C;String, Method> methodMap = new HashMap&#x3C;>();
  public void init() {
      Method[] methods = JSBridge.class.getDeclaredMethods();
      for(Method method : methods) {
          methodMap.put(method.getName(), method);
      }
  }
}
</code></pre>
<h4>实现拦截方法的重写</h4>
<p>以下以shouldOverrideUrlLoading方法的重写为例子。在例子中定义的通信协议是myjsb://method?params。通过在拦截方法中对请求进行解析就可以实现调用对应客户端method的逻辑。</p>
<pre><code>public class CustomWebViewClient extends WebViewClient {
    private JsbManager jsbManager = new JsbManager();
    private JSBridge jsBridge = new JSBridge();
    public void initJsb() {
        // 初始jsbManager和jsBridge实例
        jsbManager.init();
        jsBridge = new JSBridge();
    }
    @Override
    public boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request) {
        // 处理jsb 协议情况  只拦截jsb协议的url 其他放行
        Uri uri = request.getUrl();
        String scheme = uri.getScheme();
        if(scheme.equals(new String("myjsb"))) {
            // 获取方法名 入参
            String methodName = uri.getAuthority();
            String query = uri.getQuery();
            try {
                JSONObject jsonObject = new JSONObject(query);
                Method method = jsbManager.methodMap.get(methodName);
                // 调用对应的客户端逻辑
                method.invoke(jsBridge,jsonObject);
            } catch(Exception e) {
                e.printStackTrace();
            }
        }
        return super.shouldOverrideUrlLoading(view, request);
    }
}
// 主活动代码逻辑
public class MainActivity extends AppCompatActivity {
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        // 创建WebViewClient
        CustomWebViewClient webViewClient = new CustomWebViewClient();
        // 调用JSBridge初始逻辑
        webViewClient.initJsb();
        WebView webView = (WebView) findViewById(R.id.webView);
        // 设置WebViewClient处理webviewt通知，请求等
        webView.setWebViewClient(webViewClient);
        // 开启调试功能
        webView.setWebContentsDebuggingEnabled(true);
        WebSettings webSettings = webView.getSettings();
        // 允许执行JS
        webSettings.setJavaScriptEnabled(true);
        // 这里加载项目本地的html文件方便调试
        webView.loadUrl("file:///android_asset/index.html");
    }
}
</code></pre>
<h4>H5侧调用</h4>
<pre><code>    &#x3C;body>
        &#x3C;div>this page test JSB&#x3C;/div>
        &#x3C;script>
          // 通过创建iframe发起JSBridge调用
          function iframeCall(url) {
            let iframe = document.createElement('iframe')
            iframe.src = url
            iframe.style.display = 'none'
            document.documentElement.appendChild(iframe)
            setTimeout(() => { document.documentElement.removeChild(iframe) })
          }
          function callJsb(method, params) {
            let url = `myjsb://`
            if(!method) {
              return
            }
            url += `${method}`
            if(!!params) {
              url += `?${encodeURIComponent(JSON.stringify(params))}`
            }
            iframeCall(url)
          }
          callJsb('showToast', { content: 'xiaohong' })
        &#x3C;/script>
    &#x3C;/body>
</code></pre>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 688px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/blog/static/69c4f6e5f0ec62ff288282e3bb7c3890/ebf47/overrideUrlCall.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 196.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAnCAYAAAAPZ2gOAAAACXBIWXMAABYlAAAWJQFJUiTwAAADEklEQVRIx+1US09TQRQeGwh90Pb29kFppQ9BVAghGjfqQorFaNyZCCt3CBSoMa6IhkRiDCYmBqMxRU34ObSEFlalYCIkbuTRCra29N62n5nR2/SF1IorPMmXc+Y7c89jZs4lOl4DTq+AoUmL5pNGaHRyaHkldAYleKOS+ZpbeLQ4TeAMCuiMyiLwRhXbr9UrwPFqEDN/Gm36PrTqXWhvuoZzVjfOWtxw6lywq3tg1/TAoXHBoXUxuxA2dQ/aDL3otLlxpqkPdlM3SLuqH/dsn3DXGoK3O8zwuPcj7nBB9BE/bpIAblQA5am/nwth4moEE5c+w+2YArmoHsQDkoOH7GCUfIW3fpfpMbKLcdkuxk/8QqFdwNF9w2QH94kIt3wG5Hz9MJ5bgVeXU3h5QcSHWxk84gSMkTS8VWKcJPGQANfr34JcMQ/hRTvwrCOO6c4UpjtSeNqaxJQjiSlndXjijGP6FHDb+gZkaNADiMDulzTi21nEd7JIRLP4Hqse37YFQABez/hARsdGQSVLo9YoOWSYfvd+FsTj8bCFIIjIZXM1QRR+FjPrKwgoiiJyuVxNFdJvWcDZ/wGPacBS5B/vb5JVDJjJZA6ehEMqrxgwlUpBEASk02kGuml/fz8frOoKR0ZGsLm5iXA4jOXlZaytrWF1dRXr6+uMq7llqSrp7LLZ7N+1LJGlZ/fHLf+zWz7mo1eoDzrXwuSHXkrpDR80OZKuusJq7aqejfTYY7EYtra2GKLRKJLJZFkHZaNHhc4t/UEUIpFIYGNjA0tLSwyRSAR7e3tl+2hiKj6fD8Tr9eKoZG5uDmRgYID9DBYWFhAMBrG4uAi/389silAoxHyBQIDZEjc/P5//huqVlRVMTk6CKJVKEEKKwHFc0Voul0Or1RZxFosFKpWqiKurqwNpbGwsIx0ORxFnMplgs9mYLZPJmO7q6oLZbC5LTHQ6HdRqdR40AXVIa41GA4VCwThqS1xDQwNodxJHwTozGAwwGo1FoBUdxlXaQ2MRvV6PowSx2+3geZ5Fp5Ac0rqUK/UX8rTKH4LefgGruMzUAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="拦截请求实现调用"
        title="拦截请求实现调用"
        src="/blog/static/69c4f6e5f0ec62ff288282e3bb7c3890/ebf47/overrideUrlCall.png"
        srcset="/blog/static/69c4f6e5f0ec62ff288282e3bb7c3890/63868/overrideUrlCall.png 250w,
/blog/static/69c4f6e5f0ec62ff288282e3bb7c3890/0b533/overrideUrlCall.png 500w,
/blog/static/69c4f6e5f0ec62ff288282e3bb7c3890/ebf47/overrideUrlCall.png 688w"
        sizes="(max-width: 688px) 100vw, 688px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p>使用iframe发送消息的方式会存在消息丢失，参数限制等问题，可以通过消息队列和拦截shouldInterceptRequest方法来实现。</p>
<h3>拦截特定方法</h3>
<p>在初始化WebView的时候可以同步设置WebChromeClient，WebChromeClient主要是辅助WebView处理Js对话框，标题等操作，通过拦截WebChromeClient相应的方法同样可以实现调用端能力。</p>
<h4>实现WebChromeClient</h4>
<pre><code>public class CustomWebChromeClient extends WebChromeClient {
    @Override
    public boolean onJsPrompt(WebView view, String url, String message, String defaultValue, JsPromptResult result) {
        // 此处举例为主 直接弹端toast
        // 实现上跟拦截url一致
        Log.d("mesage", message.startsWith("myjsb")+ "");
        if(message.startsWith("myjsb")) {
            Toast.makeText(MainActivity.context, "PropmtCall", Toast.LENGTH_LONG).show();
            // 此时js调起了 需要JsPromptResult.confirm(result)
            return true;
        } else {
            return super.onJsPrompt(view, url, message, defaultValue, result);
        }
    }
}
// 在初始化WebView的时候设置WebChromeClient
CustomWebChromeClient webChromeClient = new CustomWebChromeClient();
webView.setWebChromeClient(webChromeClient);
</code></pre>
<h4>H5调用</h4>
<pre><code>    window.prompt('myjsb://')
</code></pre>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 688px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/blog/static/a06b5060a7a0c62f3aa004ed02d87c42/ebf47/overridePrompt.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 199.60000000000002%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAoCAYAAAD+MdrbAAAACXBIWXMAABYlAAAWJQFJUiTwAAADEklEQVRIx+2U309bVRzAD9BCgdv23tt7ewsKq6nIBnWLcWYJ0RfjlLin6UzmHjQLyWYcbcfMKsZkPvrj0YRAoegMITz45xAShiYGWGIMIUQEWlrbjzmnu3jpHIPFx57kk/P9fs/3+znn9qGipydOxLSJOd040S5sK4ptOVgRBzviYJlRumLPKWSsah5kb9SOKceLiT6EbnYSMv3YsTCmrdEZ8qOFW9GtNoxogLDVSnevTlePrmLDDih0+9F5JIAWaqUz7Cesa4g+4xIX7HFes8d486XPuTj4BW+dGedccIyBtgzJ9tsMtKUVycBtBgMZhayf8acZev4ub788zjsDX5FwhhCva99yvf0PPgr+Sjr+kNHeh2STv3PV9wvviQdcESsHvO9B5pfFA64bv3E3uc6XyR1etUYQ77ZPcS8E48ZfZLVd7nXvkRK7jDXtcaelcDS+Ahmxx6fiT+4IuKDdQlwUOb4+Bd+d3eOb0/t8P7RPShS5KQp8cmx2yAg43zaKuPFGjoVrMPvBLvevFvnhSpGfrp2MHz/c4eeP4dK5UcT9uVlqqwxUH8XVE1JWU2OfZRD5fE1YKpWpVDg5f1cp7deE6XQGMTtbE5bLZarV6jMhZ+XKZOqEz7IawoawIWwIG8JjCt1/YW9cT/3ZU4Xe/Umv8kqf+snuQKVSOUDW3Lhe+kSh95Pk4NbWFqurq6ytral9fX2d7e3to184MzOjkmKxqA5KpZLaZb6xscHKygqLi4ssLS2xvLzM5ubmQY9LoVBQjlQqhVhYWOD/WtlsFjEyMsLc3BzT09Pk83lyuRyTk5MqlsifROZTU1MqdusTExOHZubn5xkeHkYIIahH07RDeTAYxOfzHaolEonH5lRPR0cHLS0tKmlublYyx3FoamrC7/erPRaLYZqmimWfpL+/X/XKGZlLh7xYyEZd1xWGYRAOh9WBjN2aHAyFQgc1iXyI7PXWpEtYto1t21iWpbDr8uPW3FiYeu2WSCRyJLL5v2IX5TANxOmz54mf6sWy/r3NHfLiFdWfSV6Ix+kbfIV/AHs5ocTNraY7AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="重写Prompt方法调用"
        title="重写Prompt方法调用"
        src="/blog/static/a06b5060a7a0c62f3aa004ed02d87c42/ebf47/overridePrompt.png"
        srcset="/blog/static/a06b5060a7a0c62f3aa004ed02d87c42/63868/overridePrompt.png 250w,
/blog/static/a06b5060a7a0c62f3aa004ed02d87c42/0b533/overridePrompt.png 500w,
/blog/static/a06b5060a7a0c62f3aa004ed02d87c42/ebf47/overridePrompt.png 688w"
        sizes="(max-width: 688px) 100vw, 688px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3>客户端注入JSBridge</h3>
<p>通过<a href="https://developer.android.com/reference/android/webkit/WebView#addJavascriptInterface(java.lang.Object,%20java.lang.String)">addJavascriptInterface</a>可以在初始化WebView的时候将客户端的调用逻辑暴露给H5。</p>
<h4>实现JSInterface</h4>
<pre><code>    public class JsInterface {
        private Context context;
        public JsInterface(Context context) {
            this.context = context;
        }
        // JsInterface需要用@JavascriptInterface注解才可以被调用
        @JavascriptInterface
        public void showToast(String content) {
            Toast.makeText(this.context, content, Toast.LENGTH_LONG).show();
        }
    }

    // 在初始WebView的时候注入interface
    webView.addJavascriptInterface(new JsInterface(context), "myjsb");
</code></pre>
<h4>H5调用</h4>
<pre><code>    window.myjsb.showToast("Interface")  
</code></pre>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 688px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/blog/static/ed43999980c970f7b14ebacfdbb9cd6b/ebf47/callInterface.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 200.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAoCAYAAAD+MdrbAAAACXBIWXMAABYlAAAWJQFJUiTwAAADaklEQVRIx+2Vy09TQRTGB+jDK9D29j76UEyJIo9gfGCqJmowrtwQaMHIxoWJ8rJaCUaif4EL3oSFqAs3rliZCBFiXLKHiCECoRASiLzEtpT29jMz9dbyqoXgSif5Zc75euabczt3cslZ52UIvABZssJqOQJJlCGJFoYoUGTIkg1221EWx7Tf0DpZis1Wiw3EaMqEwawDL3Gw2HlkGjXIMupgEHTgZT2Mog6SPQs5uQJMkp7Bb5oPsfoskxYGEwdi54vhtD1AidyAi8fuo7TAi2uFXpRIDcjX16DocC0KuRoUHKpBIVcbp4irRYG+Bqf5elwv9uLq8Uacc1SBnDDcwF3Rh9vZX1F/bBqeXB+enJnDHWECZeQzXOTLrpSTMdzSj6Pp1AyeFH9DleMtyCmDC03aEJpNfjRxP/BM8sOr+YEHxI9GTQCPMnanMSMAb1oA9eQ7HpII3BnvQAp0LjRnRtB+IYTnRSF0X9nAUz6EeySIOhJEbQrUkQA8BKgg70Eu5bnwuiKMF2VBvCwPorcsiN7yIF651vGqIpgSvRUBvKkEHpe+B6m6WYnYUABE90mEOXz8NAhS6Y4ZKpEoFCWKqII9EwkrzOPDB2pY+cuQmkX3RyQS63BwMMFQ/XE/47/hP2uoKApjp/dM3XBPhsnGnzrfZri6uspYXFzE0tISVlZWWL6wsMC6TrXDvr4+ELfbjdnZWUxPT2NkZASTk5Ms9/l8GB8fjxenYtjf33+wjzw0NPQXD+X/TTlYw8Q52SGpcVLDVE51a82eOqTF6uukxls3/GOHanEoFML8/DympqbYDZqbm8Pa2lryjxS9elTc2NjYRDgcht/vx8zMDMbGxjA6OoqJiQksLy9vq11fX2eGAwMDINXV1TioMTw8DOJ0OtHd3Y2Ojg50dnayuaWlJZ53dXWhra2NaTSmGoXmra2tLG5vb0dPTw88Hg8Ix3EghGyC5/ltmiAIm3Kr1QqDwbCtjhiNRmg0mjharRYWiwV6vZ7l6enpbKHNZmOxTqdDWloacnJyWB2N6Rpay5qjO9OOEsnOzo7HZrMZdFOq0VjVaE43UjVVJ4IgQpIkiKIYZ2u+k0bzRI3FkgRilUWYTEaYzQL7n3aDLkqWsw55E0je+VLknczHEbt9x85UEo22IssyHA4HjucX4yfjfpxnxqZHBAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="interface调用"
        title="interface调用"
        src="/blog/static/ed43999980c970f7b14ebacfdbb9cd6b/ebf47/callInterface.png"
        srcset="/blog/static/ed43999980c970f7b14ebacfdbb9cd6b/63868/callInterface.png 250w,
/blog/static/ed43999980c970f7b14ebacfdbb9cd6b/0b533/callInterface.png 500w,
/blog/static/ed43999980c970f7b14ebacfdbb9cd6b/ebf47/callInterface.png 688w"
        sizes="(max-width: 688px) 100vw, 688px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h2>Native调用Js</h2>
<p>Nativa调用Js通常有如下的方案:</p>
<ul>
<li><a href="https://developer.android.com/reference/android/webkit/WebView#loadUrl(java.lang.String)">loadUrl</a></li>
<li><a href="https://developer.android.com/reference/android/webkit/WebView#evaluateJavascript(java.lang.String,%20android.webkit.ValueCallback%3Cjava.lang.String%3E)">evaluateJavascript</a></li>
</ul>
<p>以下例子在H5中都定义了全局函数供Native调用</p>
<pre><code>    function testNativeCall() {
      console.log("nativeCallJs")
      return 'nativeCallJs'
    }
</code></pre>
<h3><a href="https://developer.android.com/reference/android/webkit/WebView#loadUrl(java.lang.String)">loadUrl</a></h3>
<p>可以通过webView.loadUrl("javascript: testNativeCall()")发起调用(需要等待Js执行完成)。loadUrl的方式会刷新页面且无法获取js的回调。</p>
<h3><a href="https://developer.android.com/reference/android/webkit/WebView#evaluateJavascript(java.lang.String,%20android.webkit.ValueCallback%3Cjava.lang.String%3E)">evaluateJavascript</a></h3>
<pre><code>webView.evaluateJavascript("javascript: testNativeCall()", new ValueCallback&#x3C;String>() {
    @Override
    public void onReceiveValue(String value) {
        return;
    }
});
</code></pre>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/blog/static/b941b4ef1b5f1a77e48fa6db88525cb3/1e043/evaluateJS.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 198.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAoCAYAAAD+MdrbAAAACXBIWXMAABYlAAAWJQFJUiTwAAADPUlEQVRIx+1US08TURi9hSK0DG3n1SkEgRYlKAoGVoqPhZqwAF0pJi6MC9EIGoGFBlpRsRF5FAqJEH6AUXGlfwVIWFgKBASBYELaTqFwzL3N1PIqj7AwkZucfI97vnPPdOaW5OblQ+BF2JQs2GxZkCQrZFmBJFoZREFGVmY2A821vgbKtcoKREGC3e4AsQgcMiypkBQzRNkMznQMnCkNFskAQTayaMvmkXmcZzkvG2Ng+6KR8TlzGkxmDqSAv4GrOe9RrrSg4pQbVefaUFXchjLuJYpTnChJdbGo5fEoSmrGlew3uFn6DpVFnTiTUwFSzr1GLf8b9wx+1Np+4rF1Bs8Lf+Gu3o/bxIfqBLhFfuA+N4mG/Bm8OLmMi0oDyHWDBy1mwKkE4FJCeJsfwjNdEPW6EBr1KhqTE0Cvop6EUEeW0UCAS8YmkMvEg1YFaC8Jwn0ijPbiMJ6SEGpICA/3jADqCHBe3wRSc82Db0+Ajw8C+PxIxacaFUO1Kr7WqRiqi8ZEoJwvtUF8rwfulDeDfBjoRXRFcPAVnX3V6gLxeqOCK+EI1iLrB8JqOCrocrpAenujgpFIBOvr6wcCnWWCrm0E97uOBP9rwdXV1W2/MW1op8O2CPb19e3qYF8OOzs7EQwGsbi4iLm5ORaXlpawsLDAsG+HHR0dbHB8fBzDw8OYmprC9PQ0/H4/Jicn/4FHPvSXcnRTDl9w84vYCfGcXR3uxWk8d88ON39Ka2trsd6eHWrkcDiM+fl5+Hy+GCYmJtjVXFlZ2Vmwp6eHFaqqstMpKCEQCGB2dhajo6MMIyMjGBsbY/ed3n3K0fj0cLqcTifI4OAgDmu53W6Q6upqDAwMoLu7G16vl8Wuri7Qn4LWNNLa4/HEehT0T0WboU/Z39+PyspKEEIINsNisWyozWYzDAbDhl5hYeGWueTkZJD09HSW6PV6JCUlwWg0wmq1spz2dDodZFmGIAgsT0lJYXsOhwMZGRkxHtXgOA6EEnmej4G6o0Stpvu0NplMiOdSI9R5/CzdJ5IkMweSJMWwXb1bT8uJKFBXPERRTAhKTrRHn4xqkdOlF2DPy91wmkaKx3a9v3sSHHY7Cs6W4Q880qCTlgwo4gAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="evaluate调用js"
        title="evaluate调用js"
        src="/blog/static/b941b4ef1b5f1a77e48fa6db88525cb3/1e043/evaluateJS.png"
        srcset="/blog/static/b941b4ef1b5f1a77e48fa6db88525cb3/63868/evaluateJS.png 250w,
/blog/static/b941b4ef1b5f1a77e48fa6db88525cb3/0b533/evaluateJS.png 500w,
/blog/static/b941b4ef1b5f1a77e48fa6db88525cb3/1e043/evaluateJS.png 690w"
        sizes="(max-width: 690px) 100vw, 690px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h2>参考</h2>
<p><a href="https://www.zoo.team/article/jsbridge">小白必看，JSBridge 初探</a>
<a href="https://juejin.cn/post/6844903840588759048">跨端技能必备之JSBridge</a>
<a href="https://juejin.cn/post/6844903856418062350">从零开始写一个 JSBridge</a></p></div><div class="blog-footer"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:344px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;344&#x27; width=&#x27;344&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="/blog/static/fea72b8bb6c1352a510a256c539d4702/ff4dd/qrcode.webp 86w,/blog/static/fea72b8bb6c1352a510a256c539d4702/d6c07/qrcode.webp 172w,/blog/static/fea72b8bb6c1352a510a256c539d4702/0f0fa/qrcode.webp 344w" sizes="(min-width: 344px) 344px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 344px) 344px, 100vw" decoding="async" loading="lazy" data-src="/blog/static/fea72b8bb6c1352a510a256c539d4702/6ee52/qrcode.jpg" data-srcset="/blog/static/fea72b8bb6c1352a510a256c539d4702/8025c/qrcode.jpg 86w,/blog/static/fea72b8bb6c1352a510a256c539d4702/15bb5/qrcode.jpg 172w,/blog/static/fea72b8bb6c1352a510a256c539d4702/6ee52/qrcode.jpg 344w" alt=""/></picture><noscript><picture><source type="image/webp" srcSet="/blog/static/fea72b8bb6c1352a510a256c539d4702/ff4dd/qrcode.webp 86w,/blog/static/fea72b8bb6c1352a510a256c539d4702/d6c07/qrcode.webp 172w,/blog/static/fea72b8bb6c1352a510a256c539d4702/0f0fa/qrcode.webp 344w" sizes="(min-width: 344px) 344px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 344px) 344px, 100vw" decoding="async" loading="lazy" src="/blog/static/fea72b8bb6c1352a510a256c539d4702/6ee52/qrcode.jpg" srcSet="/blog/static/fea72b8bb6c1352a510a256c539d4702/8025c/qrcode.jpg 86w,/blog/static/fea72b8bb6c1352a510a256c539d4702/15bb5/qrcode.jpg 172w,/blog/static/fea72b8bb6c1352a510a256c539d4702/6ee52/qrcode.jpg 344w" alt=""/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div><div>欢迎大家关注我的公众号-前端小板凳 一起学习进步！</div></div><div style="width:700px;margin:0 auto" id="vcomment"></div><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8259624032507561" crossorigin="anonymous"></script></div></div></main></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/jsbridge";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-d6c7346d8d747bdad6f5.js"],"app":["/app-1e724ae62e17afbb6a4a.js"],"component---src-pages-404-js":["/component---src-pages-404-js-00021fda23318a3b62e5.js"],"component---src-pages-category-js":["/component---src-pages-category-js-267550ce456a4d5d39e9.js"],"component---src-templates-category-detail-js":["/component---src-templates-category-detail-js-5c532244ff3b9901a5f4.js"],"component---src-templates-index-js":["/component---src-templates-index-js-1c9f9ec501224e9f1abc.js"],"component---src-templates-post-js":["/component---src-templates-post-js-fa41477def220f95ebf1.js"]};/*]]>*/</script><script src="/blog/polyfill-d6c7346d8d747bdad6f5.js" nomodule=""></script><script src="/blog/component---src-templates-post-js-fa41477def220f95ebf1.js" async=""></script><script src="/blog/6ba5cc0c8669d68fb0f844125a981d8f12367a97-82630eaaa7421feb857b.js" async=""></script><script src="/blog/a1bcc4c524c8e4b3dd399f438a1f77ebab5ca6a2-7a9d7554fbc318dfe3bd.js" async=""></script><script src="/blog/a26abbfb03f25b9cd2b611d1d937ab5e796b3999-aee6059b7da925927d7f.js" async=""></script><script src="/blog/ef6529d7-5a6a50512fe36621eba5.js" async=""></script><script src="/blog/app-1e724ae62e17afbb6a4a.js" async=""></script><script src="/blog/framework-3d02c8ebec6630f3dd7b.js" async=""></script><script src="/blog/webpack-runtime-cd2b8b170d1edfbc5bdd.js" async=""></script></body></html>