<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/blog/styles.4705bef5c6bce8450df3.css" data-identity="gatsby-global-css">.blog-post{width:100%}.blog-post-content{margin:0 auto;max-width:960px;padding:0 1.0875rem 1.45rem}.blog-footer{align-items:center;display:flex;flex-direction:column;justify-content:flex-start;margin-bottom:30px}.paginate-container{align-items:center;display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;margin-top:20px;padding-bottom:10px}.paginate-item,.top-post{margin-left:10px}.top-post{color:#1e80ff;display:inline-block;font-size:15px}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;box-sizing:border-box;font:112.5%/1.45em georgia,serif,sans-serif;overflow-y:scroll}body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;word-wrap:break-word;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt";color:rgba(0,0,0,.8);font-family:georgia,serif;font-kerning:normal;font-weight:400;margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{-webkit-text-decoration-skip:objects;background-color:transparent;text-decoration:none}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help;text-decoration:none}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}img{border-style:none;margin:0 0 1.45rem;max-width:100%;padding:0}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace;font-size:1em}hr{background:rgba(0,0,0,.2);border:none;box-sizing:content-box;height:1px;margin:0 0 calc(1.45rem - 1px);overflow:visible;padding:0}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}*,:after,:before{box-sizing:inherit}ol,ul{list-style-image:none;list-style-position:outside;margin:0 0 1.45rem 1.45rem}ol,p,ul{padding:0}p,pre{margin:0 0 1.45rem}pre{word-wrap:normal;background:rgba(0,0,0,.04);border-radius:3px;font-size:.85rem;line-height:1.42;overflow:auto;padding:1.45rem}table{border-collapse:collapse;font-size:1rem;line-height:1.45rem;margin:0 0 1.45rem;padding:0;width:100%}blockquote{margin:0 1.45rem 1.45rem;padding:0}form,noscript{margin:0 0 1.45rem;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:.725rem;margin-left:1.45rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}td,th,thead{text-align:left}td,th{font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";border-bottom:1px solid rgba(0,0,0,.12);padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{content:" ";letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}</style><meta name="generator" content="Gatsby 3.15.0"/><style data-emotion="mantine "></style><title data-react-helmet="true"></title><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="icon" href="/blog/favicon-32x32.png?v=1a4023285f20ec8ca43a96875f92c5b2" type="image/png"/><link rel="manifest" href="/blog/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/blog/icons/icon-48x48.png?v=1a4023285f20ec8ca43a96875f92c5b2"/><link rel="apple-touch-icon" sizes="72x72" href="/blog/icons/icon-72x72.png?v=1a4023285f20ec8ca43a96875f92c5b2"/><link rel="apple-touch-icon" sizes="96x96" href="/blog/icons/icon-96x96.png?v=1a4023285f20ec8ca43a96875f92c5b2"/><link rel="apple-touch-icon" sizes="144x144" href="/blog/icons/icon-144x144.png?v=1a4023285f20ec8ca43a96875f92c5b2"/><link rel="apple-touch-icon" sizes="192x192" href="/blog/icons/icon-192x192.png?v=1a4023285f20ec8ca43a96875f92c5b2"/><link rel="apple-touch-icon" sizes="256x256" href="/blog/icons/icon-256x256.png?v=1a4023285f20ec8ca43a96875f92c5b2"/><link rel="apple-touch-icon" sizes="384x384" href="/blog/icons/icon-384x384.png?v=1a4023285f20ec8ca43a96875f92c5b2"/><link rel="apple-touch-icon" sizes="512x512" href="/blog/icons/icon-512x512.png?v=1a4023285f20ec8ca43a96875f92c5b2"/><link as="script" rel="preload" href="/blog/webpack-runtime-f615e9fd15f959a50bc7.js"/><link as="script" rel="preload" href="/blog/framework-30c1cbcd4309881b11c5.js"/><link as="script" rel="preload" href="/blog/app-4b62d492ee1645380565.js"/><link as="script" rel="preload" href="/blog/ef6529d7-5809e26836cfb9703dbc.js"/><link as="script" rel="preload" href="/blog/a26abbfb03f25b9cd2b611d1d937ab5e796b3999-976c7162f0c1b8304de6.js"/><link as="script" rel="preload" href="/blog/6ba5cc0c8669d68fb0f844125a981d8f12367a97-f9ea3b3dbbe28c42596b.js"/><link as="script" rel="preload" href="/blog/component---src-templates-post-js-3bee0697db9b9af656a6.js"/><link as="fetch" rel="preload" href="/blog/page-data/webpack-tapable/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="mantine-AppShell-root mantine-1272lc7" data-barba="wrapper"><header class="mantine-Header-root mantine-1elgxm6"><a href="/blog/"><div class="mantine-1ln4pgh"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-ghost" width="30" height="30" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 11a7 7 0 0 1 14 0v7a1.78 1.78 0 0 1 -3.1 1.4a1.65 1.65 0 0 0 -2.6 0a1.65 1.65 0 0 1 -2.6 0a1.65 1.65 0 0 0 -2.6 0a1.78 1.78 0 0 1 -3.1 -1.4v-7"></path><line x1="10" y1="10" x2="10.01" y2="10"></line><line x1="14" y1="10" x2="14.01" y2="10"></line><path d="M10 14a3.5 3.5 0 0 0 4 0"></path></svg><div class="mantine-Text-root mantine-1pbxw0k">noodles的笔记本</div></div></a><style data-emotion="css-global nn3xf4">:root{--mantine-header-height:70px;}</style></header><div class="mantine-ibbm6b mantine-AppShell-body"><main class="mantine-d5iwcx mantine-AppShell-main"><div class="mantine-1w0809u"><div class="blog-post"><h1 class="blog-post-content">深入浅出webpack-Tapable</h1><div class="blog-post-content">6 min read</div><div class="blog-post-content"><p>webpack是前端代码的打包工具,熟悉webpack的的工作流程和相关配置有利于在业务开发中更好的组织业务代码和实现一些特定的功能.webpack主要基于loader和plugin来实现代码打包过程:</p>
<ul>
<li>loader 主要提供了非js文件的处理能力 通过loader依次对目标文件进行编译</li>
<li>plugin 主要通过webpack在编译期间的钩子来对编译过程进行干预</li>
</ul>
<p>webpack的钩子触发逻辑都是基于Tapable这个库来完成的,在深入浅出webpack这个系列文章中我们先从Tapable的源码开始逐步深入到webpack的源码中来了解webpack.</p>
<h2>Tapable的简单使用</h2>
<p>Tapabel提供了多种类型的钩子和订阅钩子的触发方式,这里以SyncHook来梳理一个简单的钩子使用方式.</p>
<pre><code>const { SyncHook } = require('tapable')
class Car {
  constructor() {
    this.hooks = {
      // 定义一个同步钩子 钩子的构造函数接受多个入参
      accelerate: new SyncHook(["newSpeed"])
    }
  }
  // 定义设置速度函数
  setSpeed(newSpeed) {
    this.hooks.accelerate.call(newSpeed)
  }
}
// 实例化
const myCar = new Car()
// 监听钩子accelerate的触发 
myCar.hooks.accelerate.tap('acceletePlugin', (newSpeed) => { if(newSpeed > 100) {
  console.log('不能开太快呀')
} })
// 调用实例方法 设置速度 设置200的时候 会触发提示
myCar.setSpeed(200)
myCar.setSpeed(100)
</code></pre>
<p>通过上面的例子可以看到钩子的触发的逻辑是:</p>
<ul>
<li>创建钩子,定义钩子参数</li>
<li>订阅相应钩子的触发和拦截功能</li>
<li>触发钩子</li>
</ul>
<p>通过钩子的触发逻辑可以看出Tapable的实现逻辑可能是基于发布订阅的方式实现的,但是它里面对订阅的处理是怎么处理的呢、如何高效的触发呢? 这些都是成为一个优秀的库所必须要考虑的事情,我们就带着这些疑问来看Tapble的实现逻辑</p>
<h2>源码逻辑</h2>
<p>以下源码梳理以SyncHook钩子为切入点,分为以下三个模块梳理:</p>
<ul>
<li>钩子的构造过程</li>
<li>订阅过程</li>
<li>触发阶段</li>
</ul>
<h3>钩子的构造过程</h3>
<p>在通过new实例化<a href="https://github.com/webpack/tapable/blob/acd0a66d3769120b1e9e5b66823475043237f30b/lib/SyncHook.js#L35">SyncHook</a>的时候在SyncHook的构造函数创建了底层Hook的实例并且重写了Hook的方法过滤了SyncHook不支持的功能
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 469px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 48.800000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABxElEQVQoz32SSY7bMBREfY1Y1ERNlijTFiXLmmxJnhKgk00WuUZWOf8L7E660Y1OFgUQxK+Hqk8u3CBGbjv8dY1UhrbZchgq5qlmW7eo5kiSpmy1Jsk15fUbySolyEuCckRu9sSmoygLXM9l4fk+wSoiUCGrMmFdJ2z6DDMr1D5l3WvWfUpWRbiehxeEOI6D4/k4foDjSVxfIgP5uF/4novMNkhdI7VBtmdilSFzg78tCcYa1dQU841YrVl3I6Y/EvgeQljYto1tC4QQj/PCc10C0xH2F/L2gBou5N2EPpxJdIGpNNNpz/XzgX7Y4cmAeyvXdZ+TvtPCv1dOQpIyYXdYsW8jmj5GlRGqStkeFc3FkOsUyxI4tv1ivkPf61E5NB1+c+HHmPHru+bn14xOh+Q65zTXXK8tT08jSq2Q0vsw2WvC+w5Ni9ec6dqC26nidtoxDAZjNoxTzTTVzHPN+dxQGI1lWQ/z8/7eauE6NnHRkrY3mn3F/GWi7mviKGIYSo5jRbXbYNsuy6WFEPYL7MOEURyhVzllskFFGW45EBV7HCFYWuIPRLwx/Qv2AKb3LxIGfLKWj+d3xBJbWB8O/w/0F/gbfDImzfUplnYAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="同步钩子构造函数"
        title="同步钩子构造函数"
        src="/blog/static/fabb95efaaa8baad0c7438753b657a71/5f759/SyncHookCon.png"
        srcset="/blog/static/fabb95efaaa8baad0c7438753b657a71/63868/SyncHookCon.png 250w,
/blog/static/fabb95efaaa8baad0c7438753b657a71/5f759/SyncHookCon.png 469w"
        sizes="(max-width: 469px) 100vw, 469px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span>
在底层<a href="https://github.com/webpack/tapable/blob/acd0a66d3769120b1e9e5b66823475043237f30b/lib/Hook.js#L25">Hook的构造函数</a>中主要做了如下的处理:</p>
<ol>
<li>入参存储</li>
<li>创建不同方式钩子调起(call)逻辑</li>
<li>创建不同方式钩子的监听(tap)逻辑</li>
</ol>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 441px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/blog/static/cddadaa923563693da8a82c7e4708f08/efc6e/hookCon.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 142.00000000000003%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE4klEQVRIx32Va2/bRhaG/Su6tkRyOJzh/X4RKVE3y5bt2AnSdNMWbrPtdi/AFtgW7WL/P56CZOzYTdoPQ1Eg9eg9533PzInjCFSUoeoddtVivX2H+eZ7rLf/QNz/G+v1t3h+iMoaVLNB1z1xVRPGEfXVHUW7xPc8TNPEsixOdDTDsmykKwkWAclFRXJRk143xJcNwa4kqD2izifbx8TLgKj1iVcB6SbGVjamMcFGoJucYZk2UgvCxiXZBgQLl6DSlGvNcq8JKxcv14RLH+FKTNtCSIElLUzLxDIn2KDyREUzxKDQ17iFR7UOyDKNqnz6VnHff0YSCYLaJ4wduo1Pe5kSLXzKfYxynecKhZhuVFKj05Yvzhu+2mf4YUTVLFjUJU0V0+9aXl8t+PlKsS89FklEEwdEUfSobgSapoW0bXI/oY0bSi9CJxVeWvHjpcPrlY/2Q+K2pz0/Eo+K5pjvIQ+gR4VybhBE0ahobhqYtj2+LCwL25ghzPn7HxoYhsHcMBhEDN/N8f7hc4Kf+FIivRDVHJB5jdr3uHWF7wcIpbFsOVYgpcSWDo52EWIwxEEoD0sqbEePzyeFjsIZoFGBqrbItEWmS8K6p9ofSboNeVGQJAlh1VLsjrieh5MvccoembX45YogCBC2zYmQJkLY2EIgkxKvrMg3K8rDBa7rElUteb8fWzCW9qS8T5aswik2trRxAhe/DsjPc+IuRjoOUnsMVVi/a/4frZPhMvTEHvqUL1FpQ7m/Jm3XYyQWl7dEefloyhjkJzH5CDg4ZttiKrnoUcmC+vCCvD+Q5hVNt0YqjS0kruthDYb8GdB2jKmHg8I4I6grkvWSaN1THg/k5zv8siCIPepFgRAm89n8EfpRDp/30MMtfYqFZrMOiBpNdShotgXlRUN+XpOsKpwnu8vjGuAPJYuhZFvgFD0yafnuWPOf64IoCvnrv95x//OP3Pz0X27+9yuf//8Xiq5hfno6Tcx8Nq330JPBkMkUgcy60ZQfLhO+2ccUfc/du3t2X37F9d9/4Oa7b9n/7Z/4VYepPOwwRQQJdhB/UPjBZTG67GQt7y4Lfvp8SXN5S7hYE4c+3x9i7voUsXmF3r1E7+5Qhze4118TLvdYQx4/AmZL3Kzhy13Ky5sD2e6aqKgo6obXdwfK7QG5uUX3R9QA3b5AVSuUF2AY84fYmGNkRpezDp0tSDYXlMdX5Os9URzhbF4gr+9R+1cjxL38An14Q7DYYM1OHw0aJ+V5sDvcoiNtl2TdmqDdobMGvbnF21xjJTVm1mHlHU65QvnhM9h0pszNyeUh2HmPSgfghrha4lZb3GyJLLZ4SU2ReGSxRxzqyVnD+JDHx/1Qz6ccDgrDiKDJyHct5dU5+bokyofjoMQtY7bHhtW2oijS8f1PTcuJ4z0BDhttnZL0FWHu4jcxelFTtQHdNsVQJmfGjL98djrO9cPx8RT8YZbHHk6zXO5vKPoD3tCrICetGqplTxS4VFVCloW4rub0dDaCn/XwwZTh34ZJ0XlLc7yle/mW5uoVebdCRxkiX1N0S+7uNty93LLdLWiaDKUUxtNTb7gM27fneQgdYGsfPyvw0gI/K/HSEuVIbDfAVMMp540Kk8SnLJNPA4dyhwfmfD7O53x29riMYRnmNLfDs/mc2WxaZ2cfl/wbpkc9NezuXmIAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="底层钩子构造函数"
        title="底层钩子构造函数"
        src="/blog/static/cddadaa923563693da8a82c7e4708f08/efc6e/hookCon.png"
        srcset="/blog/static/cddadaa923563693da8a82c7e4708f08/63868/hookCon.png 250w,
/blog/static/cddadaa923563693da8a82c7e4708f08/efc6e/hookCon.png 441w"
        sizes="(max-width: 441px) 100vw, 441px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3>订阅过程</h3>
<p>在钩子实例化的过程中返回的实例绑定了不同监听钩子触发的监听函数,这里我们调用<a href="https://github.com/webpack/tapable/blob/acd0a66d3769120b1e9e5b66823475043237f30b/lib/Hook.js#L77">tap</a>函数的时候,会调用内部_tap函数并且传入绑定的sync参数和入参.在_tap函数中对入参进行了处理和过滤器处理
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 513px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 34.400000000000006%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABR0lEQVQoz4WRSY7bMBBF+xqtkRLF4iSKtGTHQ3eCbHKF3P8mLzDjAEE2WTyABImHX/Xf3ruRH8fEz+8Of/9G2Av545P8+IqEhIkZEUvXtnRNQ9e1L7rf9+a9vvV9zzAMvI3DwLws+GNnvV/wJeIfG3LPaDFsybGuDhHBxA0tFm0dWmtk3ZBUMC4wjkOVVuGkNf44SB8X1mvCPRLDFtFW2DZPzhHrPPb0BW0Ds3gWI8i2Y/OODZFx6P8R7gfpcSFeInJKqMXjRHM+J0qJpOQ4ZVcTn0qgZE9cYxW6cmB9oO+6vxMW4m3Hl4Bkj44BMZqcQ5V5b/BeKs8VBG+wIWCeY8fEYswr4fgULqhYkOi43jeut0S+3vDnB36/Ms8zTdvStl2laf6cX0W1TS2plqKUqgvvR8U0zUxKMQ4jappR8wul6uf/8Uz4CwkaymFOFPmPAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="_tap函数"
        title="_tap函数"
        src="/blog/static/b003abad27e92cd6307a316a5118d62a/267f6/tap.png"
        srcset="/blog/static/b003abad27e92cd6307a316a5118d62a/63868/tap.png 250w,
/blog/static/b003abad27e92cd6307a316a5118d62a/0b533/tap.png 500w,
/blog/static/b003abad27e92cd6307a316a5118d62a/267f6/tap.png 513w"
        sizes="(max-width: 513px) 100vw, 513px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span><br>
在<a href="https://github.com/webpack/tapable/blob/acd0a66d3769120b1e9e5b66823475043237f30b/lib/Hook.js#L136">_insert</a>中会根据当前监听项的信息将它插入到taps的正确位置.
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 423px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 43.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABj0lEQVQoz3WSyW7bMBiE9RyRuGshRcm2YsubrDhxXNSXPkRPPff9D18huU2CtD0MBvxJDmcGTISU5Eqwrx4YQkbvJcYVaFdQliXGGLI0Q2SCLBWICdkHCIGUcuYJSSoUbS75cTH8/Ob5fqtZDgOPX270xx2+9Ugr0U5hvcGUGu002qp5pox6E52QTAvnHMYZbHAUq5ywzml2BbEvWY6R9hCIm4r1taV7bQl9SdE4/Logj252+i4oJcZoTFFh1yNlu2S3W/B07nl+2XK97jmeHhnPG8ZxQ7fscMaRPqT/jJ8IKbDW4gqD85ru2rK6xPn1ZvAsn2sW55rVayQePUpLtNVz1AlzdHuvQCpJMtl01uEKhws58RBYnCO+K2n2gXYI1NtA2FSzcL2tCJuSuq8IfUU8eBZPNe0pYJy+R3bWYkuP7QZ819O9fGV9OtP1W6pqEh7pL7e5mrkrJVHqzn+6e+swS1Ni2xDbSJoJlNZoY2dWSv0WuM8+fo//IZn6a5pmvvy+kf19OMuY+v7s6LPDXzgWA4uhdV6tAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="_tap函数"
        title="_tap函数"
        src="/blog/static/44794c72173ba543b2450d5ba600480b/f687d/insert.png"
        srcset="/blog/static/44794c72173ba543b2450d5ba600480b/63868/insert.png 250w,
/blog/static/44794c72173ba543b2450d5ba600480b/f687d/insert.png 423w"
        sizes="(max-width: 423px) 100vw, 423px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<h3>触发过程</h3>
<p>在触发过程中是通过调用hook实例上的call方法,这里我们先梳理出call的实现过程然后在从源码的进行分析
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 313px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 363.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCABJABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDAQX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHu4IVAFRkLGAqUmVNDJvIuAKtNMAP/xAAaEAEBAQADAQAAAAAAAAAAAAABABACESAx/9oACAEBAAEFAtYxjEgiYj4vULjGNxx9f//EABQRAQAAAAAAAAAAAAAAAAAAADD/2gAIAQMBAT8BL//EABQRAQAAAAAAAAAAAAAAAAAAADD/2gAIAQIBAT8BL//EABoQAAEFAQAAAAAAAAAAAAAAACAAATFAQeH/2gAIAQEABj8CW0nkuD//xAAgEAACAQQCAwEAAAAAAAAAAAABEQAQITFBUWEggaGR/9oACAEBAAE/ITkRlP6FDULLvfuic/JtkX4gLjCbQhJ2MWlgm+GtxHruYIpLz9ppmL7K2LvtZppPY8X/2gAMAwEAAgADAAAAEKPMDHPHPOPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAMP/aAAgBAwEBPxAv/8QAFBEBAAAAAAAAAAAAAAAAAAAAMP/aAAgBAgEBPxAv/8QAIBABAQACAwADAAMAAAAAAAAAAREAIRAxQVGBkWHR8P/aAAgBAQABPxC4CltmUYRJoDgAKWV7SfmGoR3EdDhJmid9sJKjpt7D3AFNmKin42TFZ0KhHeBgk24RdhCfZym0m3QN56PgxKH8rlXoV2Or5xHbbyFxIqAZ/tcCh9ncwJYZ/Y47rXu0uNfTfQh/eDn/2Q=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="call梳理"
        title="call梳理"
        src="/blog/static/542d374ac0a67cda1e65467eec38cd64/aa65c/call.jpg"
        srcset="/blog/static/542d374ac0a67cda1e65467eec38cd64/0479a/call.jpg 250w,
/blog/static/542d374ac0a67cda1e65467eec38cd64/aa65c/call.jpg 313w"
        sizes="(max-width: 313px) 100vw, 313px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span><br>
<a href="https://github.com/webpack/tapable/blob/acd0a66d3769120b1e9e5b66823475043237f30b/lib/SyncHook.js#L40">SyncHook</a>实现的父类的抽象方法compile,compile方法也是基于基础类HookCodeFactory组装实现的<br>
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 513px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 111.20000000000002%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD4ElEQVQ4y32U2Y7bRhBF9RW2h71xF/d9FSmNZvPEAZz8RZ7y/68nIEcTO3bgh4smC+RBVd/CPZTGotWKNjC0vqHbTk/TeJr+aDOmzl6vjdrfh8Shj20qJSnlN9VCkEnJYYju8H2bqA/IzzHZFJIOIVHtUV0TsvlI0gckQ0D1GFE9pCRViJISJSRaSqSU2FpTbcDKlgRZQ1DVHE8l4bknvPQEa0+wtDhNgVtkBO1AOJwI+u27CW9o8YYGp8oJqoLAcSmE4JBakjEP+ftLyl+fE7qhJT4/k5+vpF1HebnSPX/hWLRk8xPpfE/x8Ey2vp3JMFG0Db7jkFsWh21+zyjqKOKxbinSFL+aqOqSeel5eFqZ14HLpWUaG45RhOuH2LaN0QatNUopbKXeOtyArrHRts14OTHfL0RRiOd5uMeYME5Qjk/TZDRNSl7mxGWD7/v73WmtUPoHoGcbjO1QnJ+pH38n7WaOZcuxqPHjFCUFQsibBFKIvautu71Drb8BN2dcrUnTjLSoCOKEY1YSFTVR2RCmOVopjNY/a4MqtQOdd+C2O47vYYchd0ryUVi7Plh3uz5aFp+U+kkft1NrrJs26A58UIoXz2eyBJPQTNKwSMWqNItSLEZx0jcZvZ+LVlyMYbUsKiFItuUWYn8+zJakKWfKpOJyWlgvj/R5QRVXlPVA2bd060y7znSXE+3YUdUFfZ4xbstsWbhKEdycPhTblhcDqj5RLyPLWjNNOV41IIoZp5op718p719ImgHbdZFK82EzU0oiKbnTGnkb+1BYFqHr0/XPRNlMNC401weyfqIbW9brQvv0heb6Qtl0uxnvRhyl3McVt9qmQ2s0WRzjGwfPGKQbINwQ2/UIQ5cg9HCDI05wxA+PGGP2lRFKvQGF+Be41Q+1lHTGkAuxp0YrLRolaLY0sSTFpztqsV2+RXF3t2tPGG1opSIxNsqYtw63kZU2OHmP16x45ch0mblcek7nifLxM/E476NGeUX3+idlP+EXPW454pTTXncdB/kO1ErihAled49fjQTr6x4Ex/ZMWJfU547L05VxPRFVHXk77FG1xdf27x5jN9g+8lY0SYmzvNIsC+vTme58Iq47/GYmP63Uz6/UTY4WFsKydkP0D3qHHmwlKYKYopq51Blfl5IvU8GahvRVRzE9U51+Izm94hVvLv8f8F2HUAimIKYcn3gcWr4+zdy3BUue8Me142XpGJOYRjto17u5+QugYzStF3CftJyOGVU702QVqRSkWpEpSSYFgbCQars3/RZZ36XNf4C242B7HpYUWEphybcdE0q/vSu975n8Lqp+1eE/vS2C791tVqkAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="compile实现方式"
        title="compile实现方式"
        src="/blog/static/f40c6fcf44a8453f6214b5593c81ed49/267f6/compile.png"
        srcset="/blog/static/f40c6fcf44a8453f6214b5593c81ed49/63868/compile.png 250w,
/blog/static/f40c6fcf44a8453f6214b5593c81ed49/0b533/compile.png 500w,
/blog/static/f40c6fcf44a8453f6214b5593c81ed49/267f6/compile.png 513w"
        sizes="(max-width: 513px) 100vw, 513px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span><br>
在<a href="https://github.com/webpack/tapable/blob/acd0a66d3769120b1e9e5b66823475043237f30b/lib/HookCodeFactory.js#L14">HookCodeFactory的create</a>方法中通过调用contentWithInterceptors进而调用子类SyncHookCodeFactory的content方法,在子类SyncHookCodeFactory的content绑定的SyncHook的实现逻辑callTapsSeries.
在<a href="https://github.com/webpack/tapable/blob/acd0a66d3769120b1e9e5b66823475043237f30b/lib/HookCodeFactory.js#L276">callTapsSeries</a>中主要完成了订阅数组taps的代码串联逻辑最后返回new Function完成call的调用逻辑<br>
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 655px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 122.39999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAADa0lEQVQ4y5WV627jNhCF/RitLVHiRSJFibr6GifeptldYIGiKAr0/R/lK0gnzgZFiuTHgQiSOpzhnDlcKaXwbcfXv/7h659/c3n6zjjNyLIkrkkpP4WVMYY8z/H7e/rLN+owIoqSXIg0/1kkwqIoaKYd7e6ErmqkUmTZBiHEp7HSWqdBOF2Yf/9Bf7pg+xFVO4TIbxvj6R8jlIpI2oQB03RU7UDle1TdkG3yhDzL35D+H/mqrhWllOjGY6eJZmhxjaSQG5Qt0F6hrLyRvoeXQ1bG6nSHhbVUweP3M37bMTwcafc92pdoF4uUkeeb2+VnWUaeZdfvT5GvjPOJ0DWeZhkJ91u6Q093f2C4HGiPI+1xoLsb03osWCkVta3RRqO1SXJ5jbC5EtbKUHUNuvPo1lIvge64xS89buzwu57utOC3Djc4jKnQlblp9ZWwqilETlk5yn6LP90x320ZdiPd3R3NsqCsRZoYmaCQAlGKW8ovV3BLOZ6Q7lAqnBs43J25/PjO/nRgbGfm3Zkm9Gk97kvFyd8vTNJh3Ki0ojOeYEfGZWKeR6y2iHVGvsnI1hnZJkuESU7r6/hnXGXTKIQo0EZhWoX2IsH0Ejtr6tlgOo2dDHaucEuNaTXNrqYeDFXQ2NFgvEqkqzpqrigolUKFhvow4M4Lfudx+8Bw3zHsPOHY4cYK7SV20tjZIKQgFzmFLCjK4m3KhdQs+y2H8xE7H6jCgmpGjseZ03GinxZcmFGuo/AzXduw3/XMU0CWr8K/mUMhBNPUcv94xg89sfrxxKIQqafTuCwoohOV16ykjBYn33bKS4RlWaZKbp/+YDg9Mi0LztW3+VJphFQJRkuqSif9Zdk7sok/loWgqxucrGl9zTg2WGeJ3WTDgIym4QPj0LDdBrrg35dNTC0czkwPj7hhojt9oRm3NF1PGZYk4s2vv5BnG9brKzabDVnC+r8pR0LTtAwPT4xfvjFenhjOv+G8p3INxkdrC0itqesKbQzKVM+WF27tl4oSmWtr8WHADjMueqMPVOMOG0aqqkqE8XlQxmBiD+tnwuf58oUwRliWRbJ+04brJqUQpUK4QOkCItrVZk22XqcefkGyr+f5W8rx9CiZYXuiDSPjPLDsBtq2SUTxp4++JynCl+fPGXfFMKco3xJFaXzskfoX5gqrdJg+CAsAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="callTapsSeries"
        title="callTapsSeries"
        src="/blog/static/0a6bef843d8f38a95e315423b2739054/ae6b7/callTapsSeries.png"
        srcset="/blog/static/0a6bef843d8f38a95e315423b2739054/63868/callTapsSeries.png 250w,
/blog/static/0a6bef843d8f38a95e315423b2739054/0b533/callTapsSeries.png 500w,
/blog/static/0a6bef843d8f38a95e315423b2739054/ae6b7/callTapsSeries.png 655w"
        sizes="(max-width: 655px) 100vw, 655px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>以上梳理了tapable中从生成钩子到触发钩子整个过程,可以看到在实现上tapable许多比较巧妙的安排</p>
<ol>
<li>Hook基类实现了所有钩子的创建方式 子类可以通过组合或者过滤对应的实现来实现不同的钩子</li>
<li>在HookCodeFactory基类定义的工厂函数的不同组装方式,子类通过父类的接口自定义了不同的实现方式</li>
<li>在实现call方法的时候 会使用上一次创建的结果函数</li>
</ol></div><div class="blog-footer"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:344px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;344&#x27; width=&#x27;344&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="/blog/static/fea72b8bb6c1352a510a256c539d4702/ff4dd/qrcode.webp 86w,/blog/static/fea72b8bb6c1352a510a256c539d4702/d6c07/qrcode.webp 172w,/blog/static/fea72b8bb6c1352a510a256c539d4702/0f0fa/qrcode.webp 344w" sizes="(min-width: 344px) 344px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 344px) 344px, 100vw" decoding="async" loading="lazy" data-src="/blog/static/fea72b8bb6c1352a510a256c539d4702/6ee52/qrcode.jpg" data-srcset="/blog/static/fea72b8bb6c1352a510a256c539d4702/8025c/qrcode.jpg 86w,/blog/static/fea72b8bb6c1352a510a256c539d4702/15bb5/qrcode.jpg 172w,/blog/static/fea72b8bb6c1352a510a256c539d4702/6ee52/qrcode.jpg 344w" alt=""/></picture><noscript><picture><source type="image/webp" srcSet="/blog/static/fea72b8bb6c1352a510a256c539d4702/ff4dd/qrcode.webp 86w,/blog/static/fea72b8bb6c1352a510a256c539d4702/d6c07/qrcode.webp 172w,/blog/static/fea72b8bb6c1352a510a256c539d4702/0f0fa/qrcode.webp 344w" sizes="(min-width: 344px) 344px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 344px) 344px, 100vw" decoding="async" loading="lazy" src="/blog/static/fea72b8bb6c1352a510a256c539d4702/6ee52/qrcode.jpg" srcSet="/blog/static/fea72b8bb6c1352a510a256c539d4702/8025c/qrcode.jpg 86w,/blog/static/fea72b8bb6c1352a510a256c539d4702/15bb5/qrcode.jpg 172w,/blog/static/fea72b8bb6c1352a510a256c539d4702/6ee52/qrcode.jpg 344w" alt=""/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div><div>欢迎大家关注我的公众号-前端小板凳 一起学习进步！</div></div><div style="width:700px;margin:0 auto" id="vcomment"></div><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8259624032507561" crossorigin="anonymous"></script></div></div></main></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/webpack-tapable";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-4b62d492ee1645380565.js"],"component---src-pages-404-js":["/component---src-pages-404-js-ac9e0c200e4b3806caa8.js"],"component---src-pages-category-js":["/component---src-pages-category-js-73e978b017ffb816af19.js"],"component---src-templates-category-detail-js":["/component---src-templates-category-detail-js-1887a8ea3ac79138d03b.js"],"component---src-templates-index-js":["/component---src-templates-index-js-e507aa66ee477ce7547c.js"],"component---src-templates-post-js":["/component---src-templates-post-js-3bee0697db9b9af656a6.js"]};/*]]>*/</script><script src="/blog/component---src-templates-post-js-3bee0697db9b9af656a6.js" async=""></script><script src="/blog/6ba5cc0c8669d68fb0f844125a981d8f12367a97-f9ea3b3dbbe28c42596b.js" async=""></script><script src="/blog/a26abbfb03f25b9cd2b611d1d937ab5e796b3999-976c7162f0c1b8304de6.js" async=""></script><script src="/blog/ef6529d7-5809e26836cfb9703dbc.js" async=""></script><script src="/blog/app-4b62d492ee1645380565.js" async=""></script><script src="/blog/framework-30c1cbcd4309881b11c5.js" async=""></script><script src="/blog/webpack-runtime-f615e9fd15f959a50bc7.js" async=""></script></body></html>